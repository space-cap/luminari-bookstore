# 2단계: 개념적 데이터 모델링 (Conceptual Data Modeling)

## 목차
1. [개념적 데이터 모델링 개요](#1-개념적-데이터-모델링-개요)
2. [도메인 분석 및 경계 설정](#2-도메인-분석-및-경계-설정)
3. [엔티티 상세 정의](#3-엔티티-상세-정의)
4. [속성 정의](#4-속성-정의)
5. [관계 정의](#5-관계-정의)
6. [카디널리티 분석](#6-카디널리티-분석)
7. [개념적 ERD](#7-개념적-erd)
8. [비즈니스 규칙 반영](#8-비즈니스-규칙-반영)
9. [데이터 무결성 규칙](#9-데이터-무결성-규칙)
10. [검증 및 리뷰](#10-검증-및-리뷰)

---

## 1. 개념적 데이터 모델링 개요

### 1.1 개념적 데이터 모델링이란?

개념적 데이터 모델링은 **요구사항 분석에서 추출한 엔티티와 속성을 바탕으로, 데이터 간의 관계를 정의하고 큰 그림을 그리는 단계**입니다. 이 단계에서는 기술적인 세부사항보다는 **비즈니스 관점에서 데이터 구조**를 이해하는 데 중점을 둡니다.

### 1.2 목표
- 비즈니스 요구사항을 반영한 데이터 구조 설계
- 엔티티 간의 관계(Relationship) 명확히 정의
- 데이터의 의미와 제약사항 문서화
- 이해관계자와의 의사소통 도구 제공

### 1.3 결과물
- 엔티티 정의서
- 속성 정의서
- 관계 정의서
- 개념적 ERD (Entity-Relationship Diagram)
- 비즈니스 규칙 문서

### 1.4 표기법
본 문서에서는 **Chen 표기법**과 **Crow's Foot 표기법**을 혼용하여 사용합니다.

**관계 표기법**:
- `1:1` (One-to-One): 일대일 관계
- `1:N` (One-to-Many): 일대다 관계
- `N:M` (Many-to-Many): 다대다 관계

**참여 제약 표기법**:
- **필수 참여**: 반드시 관계에 참여해야 함 (실선)
- **선택 참여**: 선택적으로 관계에 참여 (점선)

---

## 2. 도메인 분석 및 경계 설정

### 2.1 도메인 주도 설계(DDD) 접근

Luminari Bookstore 프로젝트는 여러 개의 **서브도메인(Subdomain)**으로 구성됩니다. 각 도메인은 명확한 책임과 경계를 가지며, 향후 마이크로서비스 아키텍처로 전환 시에도 활용될 수 있습니다.

### 2.2 도메인 맵

```
┌─────────────────────────────────────────────────────────────┐
│                    Luminari Bookstore                        │
│                     (온라인 서점 플랫폼)                      │
└─────────────────────────────────────────────────────────────┘
                              │
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│ 회원 도메인   │      │ 상품 도메인   │      │ 주문 도메인   │
│  (Member)    │      │  (Product)   │      │  (Order)     │
└──────────────┘      └──────────────┘      └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│커뮤니티 도메인│      │프로모션 도메인│      │ 배송 도메인   │
│ (Community)  │      │ (Promotion)  │      │ (Shipment)   │
└──────────────┘      └──────────────┘      └──────────────┘
```

### 2.3 도메인별 핵심 엔티티

#### 2.3.1 회원 도메인 (Member Domain)
**책임**: 사용자 계정 관리, 인증/인가, 프로필 관리

**핵심 엔티티**:
- `Member` (회원)
- `Address` (배송지)
- `Authority` (권한)

**핵심 비즈니스 규칙**:
- 이메일은 중복될 수 없음
- 닉네임은 중복될 수 없음
- 회원은 여러 배송지를 가질 수 있음
- 기본 배송지는 최소 1개 필수

---

#### 2.3.2 상품 도메인 (Product Domain)
**책임**: 도서 정보 관리, 카테고리 관리, 재고 관리

**핵심 엔티티**:
- `Book` (책)
- `Author` (저자)
- `Publisher` (출판사)
- `Category` (카테고리)
- `Book_Category` (책-카테고리 연결)

**핵심 비즈니스 규칙**:
- ISBN은 국제 표준 도서 번호 (고유값)
- 책은 여러 카테고리에 속할 수 있음
- 재고가 0인 책은 품절 상태
- 가격은 0보다 커야 함

---

#### 2.3.3 주문 도메인 (Order Domain)
**책임**: 장바구니 관리, 주문 처리, 결제 관리

**핵심 엔티티**:
- `Cart` (장바구니)
- `CartItem` (장바구니 항목)
- `Order` (주문)
- `OrderItem` (주문 항목)
- `Payment` (결제)

**핵심 비즈니스 규칙**:
- 회원만 장바구니를 가질 수 있음
- 주문은 회원만 할 수 있음
- 하나의 주문에는 하나의 결제 정보
- 주문 금액 = (상품 금액 - 할인 금액) + 배송비

---

#### 2.3.4 배송 도메인 (Shipment Domain)
**책임**: 배송 정보 관리, 배송 상태 추적

**핵심 엔티티**:
- `Shipment` (배송)

**핵심 비즈니스 규칙**:
- 하나의 주문에는 하나의 배송 정보
- 배송 상태: 배송 준비 → 배송 중 → 배송 완료

---

#### 2.3.5 프로모션 도메인 (Promotion Domain)
**책임**: 쿠폰 관리, 포인트 관리

**핵심 엔티티**:
- `Coupon` (쿠폰)
- `UserCoupon` (사용자 보유 쿠폰)
- `PointHistory` (포인트 내역)

**핵심 비즈니스 규칙**:
- 쿠폰은 유효기간이 있음
- 1개 주문에 1개 쿠폰만 적용
- 포인트는 적립일로부터 1년 유효
- 포인트는 100P 단위로 사용

---

#### 2.3.6 커뮤니티 도메인 (Community Domain)
**책임**: 리뷰 관리, 독서 모임 관리, 게이미피케이션

**핵심 엔티티**:
- `Review` (리뷰)
- `ReviewLike` (리뷰 좋아요)
- `BookClub` (독서 모임)
- `ClubMember` (모임 멤버)
- `Achievement` (업적/배지)
- `UserAchievement` (사용자 획득 업적)
- `Bookshelf` (가상 서재)
- `BookshelfItem` (서재 아이템)

**핵심 비즈니스 규칙**:
- 구매한 도서만 리뷰 작성 가능
- 1권당 1개 리뷰만 작성 가능
- 본인 리뷰에는 좋아요 불가
- 독서 모임은 최대 인원 제한이 있음

---

## 3. 엔티티 상세 정의

### 3.1 엔티티 정의 원칙

1. **엔티티 명명 규칙**:
   - 단수형 명사 사용 (예: `Member`, `Book`)
   - 명확하고 간결한 이름
   - 영문 PascalCase 사용

2. **엔티티 식별 기준**:
   - 독립적으로 존재할 수 있는 객체
   - 고유하게 식별 가능한 속성(식별자) 보유
   - 비즈니스적으로 의미 있는 정보

3. **엔티티 유형**:
   - **강한 엔티티(Strong Entity)**: 독립적으로 존재 (예: `Member`, `Book`)
   - **약한 엔티티(Weak Entity)**: 다른 엔티티에 종속 (예: `OrderItem`, `CartItem`)

---

### 3.2 회원 도메인 엔티티

#### 3.2.1 Member (회원)

**정의**: 플랫폼에 가입한 사용자

**역할**: 
- 도서 구매
- 리뷰 작성
- 커뮤니티 참여
- 보상 획득

**식별자**: `member_id` (Primary Key)

**핵심 속성**:
- 인증 정보: `email`, `password`
- 기본 정보: `name`, `nickname`, `phone`
- 프로필 정보: `profile_image`, `bio`, `birth_date`, `gender`
- 활동 정보: `level`, `rxp` (Reading Experience Points)
- 계정 정보: `join_date`, `last_login`, `status`

**비즈니스 규칙**:
- 이메일은 고유해야 함 (UNIQUE)
- 닉네임은 고유해야 함 (UNIQUE)
- 비밀번호는 암호화하여 저장
- `status`: ACTIVE(활성), INACTIVE(휴면), SUSPENDED(정지), WITHDRAWN(탈퇴)

---

#### 3.2.2 Address (배송지)

**정의**: 회원의 배송지 주소 정보

**역할**: 주문 시 배송지 선택

**식별자**: `address_id` (Primary Key)

**핵심 속성**:
- `member_id` (Foreign Key → Member)
- `alias` (배송지 별칭: "집", "회사" 등)
- `recipient` (수령인)
- `postal_code` (우편번호)
- `address` (기본 주소)
- `detail_address` (상세 주소)
- `phone` (연락처)
- `is_default` (기본 배송지 여부)

**비즈니스 규칙**:
- 회원당 최대 10개 배송지
- 기본 배송지는 최소 1개 필수
- 배송지 삭제 시 주문 내역은 유지

---

#### 3.2.3 Authority (권한)

**정의**: 회원의 시스템 권한

**역할**: 접근 제어 및 권한 관리

**식별자**: `authority_id` (Primary Key)

**핵심 속성**:
- `member_id` (Foreign Key → Member)
- `role` (역할: ROLE_MEMBER, ROLE_ADMIN)

**비즈니스 규칙**:
- 회원 가입 시 ROLE_MEMBER 자동 부여
- 관리자는 ROLE_ADMIN 추가 부여
- 하나의 회원이 여러 역할을 가질 수 있음 (1:N)

---

### 3.3 상품 도메인 엔티티

#### 3.3.1 Book (책)

**정의**: 판매하는 도서 상품

**역할**: 
- 도서 정보 제공
- 판매 대상 상품
- 리뷰 및 평점 대상

**식별자**: `book_id` (Primary Key)

**핵심 속성**:
- 식별 정보: `isbn` (ISBN-13), `isbn10` (ISBN-10)
- 기본 정보: `title`, `subtitle`, `description`
- 저자/출판사: `author_id` (FK), `publisher_id` (FK)
- 출판 정보: `publish_date`, `pages`, `dimensions`, `weight`
- 가격 정보: `price`, `discount_rate`, `final_price`
- 이미지: `cover_image`, `detail_images`
- 콘텐츠: `table_of_contents`, `preview_pages`
- 재고 정보: `stock`, `sales_count`
- 상태: `status` (AVAILABLE, OUT_OF_STOCK, DISCONTINUED)
- 통계: `rating_avg`, `review_count`

**비즈니스 규칙**:
- ISBN은 고유해야 함 (UNIQUE)
- 가격은 0보다 커야 함
- 할인율은 0~100% 범위
- 최종 가격 = 정가 × (1 - 할인율)
- 재고가 0이면 품절 상태로 자동 전환

---

#### 3.3.2 Author (저자)

**정의**: 도서의 저자 정보

**역할**: 도서 저자 정보 제공

**식별자**: `author_id` (Primary Key)

**핵심 속성**:
- `name` (저자명)
- `bio` (약력)
- `photo` (사진)
- `nationality` (국적)

**비즈니스 규칙**:
- 저자명은 필수
- 한 명의 저자는 여러 책을 쓸 수 있음 (1:N)
- 한 권의 책은 여러 저자가 있을 수 있음 (공저) → N:M 관계 (추후 고려)

---

#### 3.3.3 Publisher (출판사)

**정의**: 도서의 출판사 정보

**역할**: 도서 출판사 정보 제공

**식별자**: `publisher_id` (Primary Key)

**핵심 속성**:
- `name` (출판사명)
- `description` (소개)
- `website` (웹사이트)
- `contact` (연락처)

**비즈니스 규칙**:
- 출판사명은 필수
- 하나의 출판사는 여러 책을 출판할 수 있음 (1:N)

---

#### 3.3.4 Category (카테고리)

**정의**: 도서의 장르/주제 분류 체계

**역할**: 도서 탐색 및 분류

**식별자**: `category_id` (Primary Key)

**핵심 속성**:
- `name` (카테고리명)
- `parent_category_id` (FK → Category, 상위 카테고리)
- `depth` (계층 깊이: 1, 2, 3)
- `display_order` (표시 순서)
- `description` (설명)

**비즈니스 규칙**:
- 최대 3단계 계층 구조
- 루트 카테고리의 `parent_category_id`는 NULL
- Depth 1: 대분류 (예: 소설)
- Depth 2: 중분류 (예: 한국소설)
- Depth 3: 소분류 (예: 현대소설)

**계층 구조 예시**:
```
소설 (depth=1, parent=NULL)
  ├─ 한국소설 (depth=2, parent=1)
  │   ├─ 현대소설 (depth=3, parent=2)
  │   └─ 고전소설 (depth=3, parent=2)
  ├─ 외국소설 (depth=2, parent=1)
  │   ├─ 영미소설 (depth=3, parent=3)
  │   └─ 일본소설 (depth=3, parent=3)
  └─ SF/판타지 (depth=2, parent=1)
```

---

#### 3.3.5 Book_Category (책-카테고리 연결)

**정의**: 책과 카테고리의 다대다(N:M) 관계를 해소하는 연결 테이블

**역할**: 책이 속한 카테고리 정보 관리

**식별자**: `book_category_id` (Primary Key)

**핵심 속성**:
- `book_id` (FK → Book)
- `category_id` (FK → Category)
- `is_main` (주 카테고리 여부)

**비즈니스 규칙**:
- 하나의 책은 여러 카테고리에 속할 수 있음
- 주 카테고리는 책당 1개만 지정 가능
- 동일한 책-카테고리 조합은 중복 불가 (UNIQUE)

---

### 3.4 주문 도메인 엔티티

#### 3.4.1 Cart (장바구니)

**정의**: 회원의 장바구니

**역할**: 구매 전 도서 임시 보관

**식별자**: `cart_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member, UNIQUE)
- `created_date` (생성일)
- `updated_date` (최종 수정일)

**비즈니스 규칙**:
- 회원당 1개의 장바구니 (1:1)
- 비회원은 세션 기반 임시 장바구니 (DB 저장 안 함)
- 장바구니는 회원 가입 시 자동 생성

---

#### 3.4.2 CartItem (장바구니 항목)

**정의**: 장바구니에 담긴 개별 도서

**역할**: 장바구니 상품 관리

**식별자**: `cart_item_id` (Primary Key)

**핵심 속성**:
- `cart_id` (FK → Cart)
- `book_id` (FK → Book)
- `quantity` (수량)
- `added_date` (담은 날짜)

**비즈니스 규칙**:
- 수량은 1~99 범위
- 동일한 책은 수량만 증가
- 재고 부족 시 담기 불가

---

#### 3.4.3 Order (주문)

**정의**: 회원의 도서 주문 정보

**역할**: 주문 마스터 정보 관리

**식별자**: `order_id` (Primary Key)

**핵심 속성**:
- `order_number` (주문번호, UNIQUE, 예: ORD20250119123456)
- `member_id` (FK → Member)
- `order_date` (주문일시)
- `status` (주문 상태)
- 가격 정보:
  - `total_product_price` (총 상품 금액)
  - `shipping_fee` (배송비)
  - `discount_amount` (할인 금액)
  - `point_used` (사용 포인트)
  - `final_price` (최종 결제 금액)
- 배송 정보:
  - `recipient` (수령인)
  - `postal_code` (우편번호)
  - `address` (주소)
  - `detail_address` (상세 주소)
  - `phone` (연락처)
  - `delivery_request` (배송 요청사항)

**주문 상태(Status)**:
- `PENDING`: 결제 대기
- `PAYMENT_COMPLETED`: 결제 완료
- `PREPARING`: 배송 준비
- `SHIPPING`: 배송 중
- `DELIVERED`: 배송 완료
- `CONFIRMED`: 구매 확정
- `CANCELLED`: 취소
- `REFUNDED`: 환불 완료

**비즈니스 규칙**:
- 주문번호는 "ORD" + 연월일시분초 형식
- 배송비: 30,000원 이상 무료, 미만 3,000원
- 최종 결제 금액 = 총 상품 금액 + 배송비 - 할인 금액 - 사용 포인트

---

#### 3.4.4 OrderItem (주문 항목)

**정의**: 주문에 포함된 개별 도서

**역할**: 주문 상품 상세 정보 관리

**식별자**: `order_item_id` (Primary Key)

**핵심 속성**:
- `order_id` (FK → Order)
- `book_id` (FK → Book)
- `quantity` (수량)
- `price` (주문 당시 가격)
- `discount_rate` (주문 당시 할인율)
- `subtotal` (소계: 가격 × 수량 × (1 - 할인율))

**비즈니스 규칙**:
- 주문 당시의 가격 정보 저장 (가격 변동 영향 없음)
- 수량은 1 이상

---

#### 3.4.5 Payment (결제)

**정의**: 주문에 대한 결제 정보

**역할**: 결제 처리 및 내역 관리

**식별자**: `payment_id` (Primary Key)

**핵심 속성**:
- `order_id` (FK → Order, UNIQUE)
- `payment_method` (결제 수단)
- `payment_date` (결제일시)
- `amount` (결제 금액)
- `pg_provider` (PG사: TOSS, IAMPORT 등)
- `pg_transaction_id` (PG 거래 ID)
- `status` (결제 상태)

**결제 수단(Payment Method)**:
- `CARD`: 신용카드
- `BANK_TRANSFER`: 계좌이체
- `KAKAO_PAY`: 카카오페이
- `NAVER_PAY`: 네이버페이
- `TOSS`: 토스

**결제 상태(Status)**:
- `PENDING`: 결제 대기
- `COMPLETED`: 결제 완료
- `FAILED`: 결제 실패
- `CANCELLED`: 결제 취소
- `REFUNDED`: 환불 완료

**비즈니스 규칙**:
- 하나의 주문에 하나의 결제 (1:1)
- 결제 정보는 PG사를 통해 처리
- 카드 정보는 서버에 저장하지 않음 (PCI-DSS 준수)

---

### 3.5 배송 도메인 엔티티

#### 3.5.1 Shipment (배송)

**정의**: 주문에 대한 배송 정보

**역할**: 배송 처리 및 추적

**식별자**: `shipment_id` (Primary Key)

**핵심 속성**:
- `order_id` (FK → Order, UNIQUE)
- `courier` (택배사: CJ대한통운, 우체국택배 등)
- `tracking_number` (송장번호)
- `shipped_date` (발송일)
- `delivered_date` (배송 완료일)
- `status` (배송 상태)

**배송 상태(Status)**:
- `PREPARING`: 배송 준비
- `SHIPPED`: 발송 완료
- `IN_TRANSIT`: 배송 중
- `OUT_FOR_DELIVERY`: 배송 출발
- `DELIVERED`: 배송 완료
- `RETURNED`: 반송

**비즈니스 규칙**:
- 하나의 주문에 하나의 배송 (1:1)
- 배송 완료 후 3일 뒤 자동 구매 확정

---

### 3.6 프로모션 도메인 엔티티

#### 3.6.1 Coupon (쿠폰)

**정의**: 할인 쿠폰 마스터 정보

**역할**: 주문 시 할인 적용

**식별자**: `coupon_id` (Primary Key)

**핵심 속성**:
- `code` (쿠폰 코드, UNIQUE)
- `name` (쿠폰명)
- `type` (쿠폰 유형)
- `discount_value` (할인 값: 금액 또는 비율)
- `min_order_amount` (최소 주문 금액)
- `max_discount_amount` (최대 할인 금액, 정률 쿠폰용)
- `start_date` (사용 시작일)
- `end_date` (사용 종료일)
- `total_quantity` (총 발행 수량)
- `issued_quantity` (발급된 수량)
- `target_category_id` (FK → Category, 카테고리 쿠폰용, NULL 가능)
- `target_book_id` (FK → Book, 도서 쿠폰용, NULL 가능)

**쿠폰 유형(Type)**:
- `FIXED`: 정액 할인 (예: 3,000원 할인)
- `PERCENT`: 정률 할인 (예: 10% 할인)
- `FREE_SHIPPING`: 배송비 무료

**비즈니스 규칙**:
- 쿠폰 코드는 고유해야 함
- 유효기간 내에만 사용 가능
- 발급 수량 제한 (총 수량 ≥ 발급 수량)

---

#### 3.6.2 UserCoupon (사용자 보유 쿠폰)

**정의**: 회원이 보유한 쿠폰

**역할**: 회원-쿠폰 N:M 관계 해소

**식별자**: `user_coupon_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member)
- `coupon_id` (FK → Coupon)
- `issued_date` (발급일)
- `used_date` (사용일, NULL 가능)
- `order_id` (FK → Order, NULL 가능)
- `status` (상태)

**상태(Status)**:
- `AVAILABLE`: 사용 가능
- `USED`: 사용 완료
- `EXPIRED`: 기간 만료

**비즈니스 규칙**:
- 쿠폰은 1회만 사용 가능
- 사용한 쿠폰은 취소 시 복구
- 기간 만료 시 자동으로 EXPIRED 상태로 변경

---

#### 3.6.3 PointHistory (포인트 내역)

**정의**: 회원의 포인트 적립/사용 이력

**역할**: 포인트 트랜잭션 로그

**식별자**: `point_history_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member)
- `type` (유형)
- `amount` (금액, 적립은 +, 사용은 -)
- `reason` (사유)
- `order_id` (FK → Order, NULL 가능)
- `created_date` (발생일시)
- `balance` (거래 후 잔액)
- `expires_date` (만료일)

**유형(Type)**:
- `EARN`: 적립
- `USE`: 사용
- `CANCEL`: 취소 복구
- `EXPIRE`: 만료

**비즈니스 규칙**:
- 포인트는 적립일로부터 1년 유효
- 포인트 변동 시마다 레코드 생성 (Audit Trail)
- Member 테이블의 현재 포인트는 집계값

---

### 3.7 커뮤니티 도메인 엔티티

#### 3.7.1 Review (리뷰)

**정의**: 도서에 대한 회원의 리뷰

**역할**: 도서 평가 및 의견 공유

**식별자**: `review_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member)
- `book_id` (FK → Book)
- `order_id` (FK → Order, 구매 확인용)
- `rating` (별점: 1.0~5.0, 0.5 단위)
- `content` (리뷰 내용)
- `photos` (사진 URL 목록, JSON)
- `created_date` (작성일)
- `updated_date` (수정일, NULL 가능)
- `like_count` (좋아요 수)
- `status` (상태)

**상태(Status)**:
- `ACTIVE`: 정상
- `HIDDEN`: 숨김 (신고 누적)
- `DELETED`: 삭제

**비즈니스 규칙**:
- 구매한 도서만 리뷰 작성 가능
- 1권당 1개 리뷰만 작성 가능 (member_id + book_id UNIQUE)
- 리뷰 내용은 최소 20자, 최대 2,000자
- 사진은 최대 5장
- 수정 시 `updated_date` 갱신

---

#### 3.7.2 ReviewLike (리뷰 좋아요)

**정의**: 리뷰에 대한 회원의 좋아요

**역할**: 리뷰 유용성 평가

**식별자**: `review_like_id` (Primary Key)

**핵심 속성**:
- `review_id` (FK → Review)
- `member_id` (FK → Member)
- `created_date` (좋아요 누른 날짜)

**비즈니스 규칙**:
- 회원당 리뷰당 1회만 좋아요 가능 (review_id + member_id UNIQUE)
- 본인 리뷰에는 좋아요 불가 (애플리케이션 레벨에서 검증)

---

#### 3.7.3 BookClub (독서 모임)

**정의**: 독서 모임 마스터 정보

**역할**: 독서 모임 관리

**식별자**: `club_id` (Primary Key)

**핵심 속성**:
- `title` (모임명)
- `book_id` (FK → Book)
- `creator_id` (FK → Member, 생성자)
- `description` (모임 소개)
- `start_date` (시작일)
- `end_date` (종료일)
- `max_members` (최대 인원)
- `current_members` (현재 인원)
- `status` (상태)

**상태(Status)**:
- `RECRUITING`: 모집 중
- `IN_PROGRESS`: 진행 중
- `COMPLETED`: 종료
- `CANCELLED`: 취소

**비즈니스 규칙**:
- 최대 인원 초과 시 참여 불가
- 모임 기간 종료 시 자동으로 COMPLETED 상태로 변경

---

#### 3.7.4 ClubMember (모임 멤버)

**정의**: 독서 모임 참여 회원

**역할**: 회원-독서모임 N:M 관계 해소

**식별자**: `club_member_id` (Primary Key)

**핵심 속성**:
- `club_id` (FK → BookClub)
- `member_id` (FK → Member)
- `joined_date` (가입일)
- `role` (역할)
- `status` (상태)

**역할(Role)**:
- `LEADER`: 모임장
- `MEMBER`: 일반 멤버

**상태(Status)**:
- `ACTIVE`: 활동 중
- `WITHDRAWN`: 탈퇴

**비즈니스 규칙**:
- 회원은 동일 모임에 중복 참여 불가 (club_id + member_id UNIQUE)
- 모임장은 1명 (creator_id와 동일)

---

#### 3.7.5 Achievement (업적/배지)

**정의**: 획득 가능한 업적/칭호/배지 마스터 정보

**역할**: 게이미피케이션 보상 정의

**식별자**: `achievement_id` (Primary Key)

**핵심 속성**:
- `type` (유형)
- `name` (업적명)
- `description` (설명)
- `condition` (달성 조건, JSON)
- `icon` (아이콘 이미지 URL)
- `reward_rxp` (보상 RXP)
- `reward_item` (보상 아이템, JSON, NULL 가능)

**유형(Type)**:
- `BADGE`: 배지 (수집형)
- `TITLE`: 칭호 (프로필 표시용)

**비즈니스 규칙**:
- 업적명은 고유해야 함
- 조건은 JSON 형식으로 저장 (예: `{"review_count": 10}`)

---

#### 3.7.6 UserAchievement (사용자 획득 업적)

**정의**: 회원이 획득한 업적

**역할**: 회원-업적 N:M 관계 해소

**식별자**: `user_achievement_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member)
- `achievement_id` (FK → Achievement)
- `acquired_date` (획득일)
- `is_displayed` (프로필 표시 여부, 칭호용)

**비즈니스 규칙**:
- 동일한 업적은 1회만 획득 가능 (member_id + achievement_id UNIQUE)
- 칭호는 1개만 대표로 표시 가능

---

#### 3.7.7 Bookshelf (가상 서재)

**정의**: 회원의 가상 서재

**역할**: 개인화된 서재 공간 제공

**식별자**: `bookshelf_id` (Primary Key)

**핵심 속성**:
- `member_id` (FK → Member, UNIQUE)
- `theme` (테마)
- `background` (배경 이미지)
- `is_public` (공개 여부)
- `visit_count` (방문자 수)
- `like_count` (좋아요 수)

**비즈니스 규칙**:
- 회원당 1개의 서재 (1:1)
- 구매한 도서는 자동으로 서재에 추가

---

#### 3.7.8 BookshelfItem (서재 아이템)

**정의**: 서재에 배치된 아이템

**역할**: 서재 꾸미기 아이템 관리

**식별자**: `item_id` (Primary Key)

**핵심 속성**:
- `bookshelf_id` (FK → Bookshelf)
- `item_type` (아이템 유형)
- `item_code` (아이템 코드)
- `position_x` (X 좌표)
- `position_y` (Y 좌표)
- `rotation` (회전 각도)
- `scale` (크기 배율)

**아이템 유형(Item Type)**:
- `BOOK`: 구매한 도서
- `FURNITURE`: 가구
- `DECORATION`: 소품
- `BACKGROUND`: 배경

**비즈니스 규칙**:
- 아이템은 포인트로 구매하거나 보상으로 획득
- 좌표계는 서재 캔버스 기준

---

## 4. 속성 정의

### 4.1 속성 정의 원칙

1. **속성 명명 규칙**:
   - 소문자 snake_case 사용 (예: `member_id`, `created_date`)
   - 명확하고 간결한 이름
   - 약어는 최소화

2. **속성 유형**:
   - **단순 속성(Simple)**: 더 이상 나눌 수 없는 속성 (예: `email`)
   - **복합 속성(Composite)**: 여러 하위 속성으로 구성 (예: `address` → `postal_code`, `address`, `detail_address`)
   - **단일값 속성(Single-valued)**: 하나의 값만 가짐 (예: `name`)
   - **다중값 속성(Multi-valued)**: 여러 값을 가짐 (예: `photos` → JSON 배열)
   - **유도 속성(Derived)**: 다른 속성으로부터 계산 (예: `age` ← `birth_date`)

3. **속성 제약사항**:
   - `NOT NULL`: 필수 속성
   - `UNIQUE`: 고유값
   - `DEFAULT`: 기본값
   - 도메인 제약: 허용되는 값의 범위

### 4.2 주요 엔티티 속성 상세

#### 4.2.1 Member 속성

| 속성명 | 데이터 타입 | 제약사항 | 설명 |
|:------|:-----------|:---------|:-----|
| member_id | BIGINT | PK, AUTO_INCREMENT | 회원 ID (식별자) |
| email | VARCHAR(100) | UNIQUE, NOT NULL | 이메일 (로그인 ID) |
| password | VARCHAR(255) | NOT NULL | 암호화된 비밀번호 |
| name | VARCHAR(50) | NOT NULL | 이름 |
| nickname | VARCHAR(20) | UNIQUE, NOT NULL | 닉네임 |
| phone | VARCHAR(20) | NOT NULL | 휴대폰 번호 |
| profile_image | VARCHAR(500) | NULL | 프로필 사진 URL |
| bio | VARCHAR(500) | NULL | 자기소개 |
| birth_date | DATE | NULL | 생년월일 |
| gender | ENUM | NULL | 성별 (M, F, OTHER) |
| level | INT | NOT NULL, DEFAULT 1 | 레벨 |
| rxp | INT | NOT NULL, DEFAULT 0 | 경험치 |
| point | INT | NOT NULL, DEFAULT 0 | 보유 포인트 |
| join_date | DATETIME | NOT NULL | 가입일시 |
| last_login | DATETIME | NULL | 최근 로그인 일시 |
| status | ENUM | NOT NULL, DEFAULT 'ACTIVE' | 상태 |

**유도 속성**:
- `age` ← `YEAR(CURDATE()) - YEAR(birth_date)` (쿼리 시 계산)

---

#### 4.2.2 Book 속성

| 속성명 | 데이터 타입 | 제약사항 | 설명 |
|:------|:-----------|:---------|:-----|
| book_id | BIGINT | PK, AUTO_INCREMENT | 책 ID |
| isbn | VARCHAR(13) | UNIQUE, NOT NULL | ISBN-13 |
| isbn10 | VARCHAR(10) | NULL | ISBN-10 |
| title | VARCHAR(200) | NOT NULL | 제목 |
| subtitle | VARCHAR(200) | NULL | 부제 |
| author_id | BIGINT | FK (Author), NOT NULL | 저자 ID |
| publisher_id | BIGINT | FK (Publisher), NOT NULL | 출판사 ID |
| publish_date | DATE | NOT NULL | 출간일 |
| pages | INT | NULL | 페이지 수 |
| dimensions | VARCHAR(50) | NULL | 크기 (예: "150x220mm") |
| weight | INT | NULL | 무게 (g) |
| price | DECIMAL(10, 2) | NOT NULL | 정가 |
| discount_rate | DECIMAL(5, 2) | NOT NULL, DEFAULT 0 | 할인율 (0~100) |
| final_price | DECIMAL(10, 2) | NOT NULL | 최종 가격 |
| cover_image | VARCHAR(500) | NOT NULL | 표지 이미지 URL |
| detail_images | TEXT | NULL | 상세 이미지 URL (JSON) |
| description | TEXT | NULL | 책 소개 |
| table_of_contents | TEXT | NULL | 목차 |
| preview_pages | TEXT | NULL | 미리보기 페이지 (JSON) |
| stock | INT | NOT NULL, DEFAULT 0 | 재고 수량 |
| sales_count | INT | NOT NULL, DEFAULT 0 | 판매 수량 |
| rating_avg | DECIMAL(3, 2) | NULL | 평균 평점 |
| review_count | INT | NOT NULL, DEFAULT 0 | 리뷰 수 |
| status | ENUM | NOT NULL, DEFAULT 'AVAILABLE' | 상태 |
| created_date | DATETIME | NOT NULL | 등록일 |
| updated_date | DATETIME | NULL | 수정일 |

**유도 속성**:
- `final_price` ← `price * (1 - discount_rate / 100)`
- `rating_avg` ← 리뷰 평점의 평균 (집계)
- `review_count` ← 리뷰 개수 (집계)

---

#### 4.2.3 Order 속성

| 속성명 | 데이터 타입 | 제약사항 | 설명 |
|:------|:-----------|:---------|:-----|
| order_id | BIGINT | PK, AUTO_INCREMENT | 주문 ID |
| order_number | VARCHAR(20) | UNIQUE, NOT NULL | 주문번호 |
| member_id | BIGINT | FK (Member), NOT NULL | 회원 ID |
| order_date | DATETIME | NOT NULL | 주문일시 |
| status | ENUM | NOT NULL | 주문 상태 |
| total_product_price | DECIMAL(10, 2) | NOT NULL | 총 상품 금액 |
| shipping_fee | DECIMAL(10, 2) | NOT NULL | 배송비 |
| discount_amount | DECIMAL(10, 2) | NOT NULL, DEFAULT 0 | 할인 금액 |
| point_used | INT | NOT NULL, DEFAULT 0 | 사용 포인트 |
| final_price | DECIMAL(10, 2) | NOT NULL | 최종 결제 금액 |
| recipient | VARCHAR(50) | NOT NULL | 수령인 |
| postal_code | VARCHAR(10) | NOT NULL | 우편번호 |
| address | VARCHAR(200) | NOT NULL | 주소 |
| detail_address | VARCHAR(100) | NULL | 상세 주소 |
| phone | VARCHAR(20) | NOT NULL | 연락처 |
| delivery_request | VARCHAR(200) | NULL | 배송 요청사항 |

**유도 속성**:
- `final_price` ← `total_product_price + shipping_fee - discount_amount - point_used`

---

## 5. 관계 정의

### 5.1 관계 정의 원칙

관계(Relationship)는 두 개 이상의 엔티티 간의 연관성을 나타냅니다.

**관계 요소**:
1. **관계명**: 두 엔티티 간의 관계를 설명하는 동사/동사구
2. **참여 엔티티**: 관계에 참여하는 엔티티들
3. **카디널리티**: 관계의 수량 비율 (1:1, 1:N, N:M)
4. **참여 제약**: 필수(Mandatory) 또는 선택(Optional) 참여

### 5.2 회원 도메인 관계

#### R1: Member - Address
- **관계명**: "소유하다 (owns)"
- **설명**: 회원은 여러 배송지를 소유한다
- **카디널리티**: `1:N` (일대다)
- **참여 제약**:
  - Member → Address: 선택 참여 (배송지가 없을 수 있음, 가입 직후)
  - Address → Member: 필수 참여 (배송지는 반드시 회원에게 속함)
- **표기**: `Member (1) ---- (N) Address`

---

#### R2: Member - Authority
- **관계명**: "가지다 (has)"
- **설명**: 회원은 하나 이상의 권한을 가진다
- **카디널리티**: `1:N` (일대다)
- **참여 제약**:
  - Member → Authority: 필수 참여 (회원은 최소 1개 권한 필요)
  - Authority → Member: 필수 참여
- **표기**: `Member (1) ==== (N) Authority`

---

#### R3: Member - Cart
- **관계명**: "소유하다 (owns)"
- **설명**: 회원은 하나의 장바구니를 소유한다
- **카디널리티**: `1:1` (일대일)
- **참여 제약**:
  - Member → Cart: 선택 참여 (회원 가입 시 자동 생성, 논리적으로 필수)
  - Cart → Member: 필수 참여
- **표기**: `Member (1) ==== (1) Cart`

---

#### R4: Member - Order
- **관계명**: "주문하다 (places)"
- **설명**: 회원은 여러 주문을 한다
- **카디널리티**: `1:N` (일대다)
- **참여 제약**:
  - Member → Order: 선택 참여 (주문이 없을 수 있음)
  - Order → Member: 필수 참여 (주문은 반드시 회원이 함)
- **표기**: `Member (1) ---- (N) Order`

---

#### R5: Member - Review
- **관계명**: "작성하다 (writes)"
- **설명**: 회원은 여러 리뷰를 작성한다
- **카디널리티**: `1:N` (일대다)
- **참여 제약**:
  - Member → Review: 선택 참여 (리뷰가 없을 수 있음)
  - Review → Member: 필수 참여 (리뷰는 반드시 회원이 작성)
- **표기**: `Member (1) ---- (N) Review`

---

#### R6: Member - ReviewLike
- **관계명**: "좋아하다 (likes)"
- **설명**: 회원은 여러 리뷰에 좋아요를 누른다
- **카디널리티**: `N:M` → 연결 테이블 `ReviewLike`로 해소
- **표기**: `Member (1) ---- (N) ReviewLike (N) ---- (1) Review`

---

#### R7: Member - BookClub
- **관계명**: "참여하다 (participates)"
- **설명**: 회원은 여러 독서 모임에 참여한다
- **카디널리티**: `N:M` → 연결 테이블 `ClubMember`로 해소
- **표기**: `Member (1) ---- (N) ClubMember (N) ---- (1) BookClub`

---

#### R8: Member - Achievement
- **관계명**: "획득하다 (acquires)"
- **설명**: 회원은 여러 업적을 획득한다
- **카디널리티**: `N:M` → 연결 테이블 `UserAchievement`로 해소
- **표기**: `Member (1) ---- (N) UserAchievement (N) ---- (1) Achievement`

---

#### R9: Member - Coupon
- **관계명**: "보유하다 (holds)"
- **설명**: 회원은 여러 쿠폰을 보유한다
- **카디널리티**: `N:M` → 연결 테이블 `UserCoupon`로 해소
- **표기**: `Member (1) ---- (N) UserCoupon (N) ---- (1) Coupon`

---

#### R10: Member - PointHistory
- **관계명**: "발생하다 (generates)"
- **설명**: 회원은 여러 포인트 내역을 가진다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Member (1) ---- (N) PointHistory`

---

#### R11: Member - Bookshelf
- **관계명**: "소유하다 (owns)"
- **설명**: 회원은 하나의 서재를 소유한다
- **카디널리티**: `1:1` (일대일)
- **표기**: `Member (1) ==== (1) Bookshelf`

---

### 5.3 상품 도메인 관계

#### R12: Book - Author
- **관계명**: "집필하다 (writes)"
- **설명**: 저자는 여러 책을 집필한다
- **카디널리티**: `1:N` (일대다)
- **참고**: 공저는 별도 테이블로 확장 가능 (N:M)
- **표기**: `Author (1) ---- (N) Book`

---

#### R13: Book - Publisher
- **관계명**: "출판하다 (publishes)"
- **설명**: 출판사는 여러 책을 출판한다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Publisher (1) ---- (N) Book`

---

#### R14: Book - Category
- **관계명**: "분류되다 (categorized)"
- **설명**: 책은 여러 카테고리에 속한다
- **카디널리티**: `N:M` → 연결 테이블 `Book_Category`로 해소
- **표기**: `Book (1) ---- (N) Book_Category (N) ---- (1) Category`

---

#### R15: Category - Category (Self-Referencing)
- **관계명**: "포함하다 (contains)"
- **설명**: 카테고리는 하위 카테고리를 포함한다
- **카디널리티**: `1:N` (일대다, 계층 구조)
- **표기**: `Category (1) ---- (N) Category`

---

#### R16: Book - Review
- **관계명**: "받다 (receives)"
- **설명**: 책은 여러 리뷰를 받는다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Book (1) ---- (N) Review`

---

#### R17: Book - CartItem
- **관계명**: "담기다 (contained in)"
- **설명**: 책은 여러 장바구니 항목에 담긴다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Book (1) ---- (N) CartItem`

---

#### R18: Book - OrderItem
- **관계명**: "주문되다 (ordered in)"
- **설명**: 책은 여러 주문 항목에 포함된다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Book (1) ---- (N) OrderItem`

---

#### R19: Book - BookClub
- **관계명**: "대상이 되다 (target of)"
- **설명**: 책은 여러 독서 모임의 대상이 된다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Book (1) ---- (N) BookClub`

---

### 5.4 주문 도메인 관계

#### R20: Cart - CartItem
- **관계명**: "포함하다 (contains)"
- **설명**: 장바구니는 여러 장바구니 항목을 포함한다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Cart (1) ---- (N) CartItem`

---

#### R21: Order - OrderItem
- **관계명**: "포함하다 (contains)"
- **설명**: 주문은 여러 주문 항목을 포함한다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Order (1) ==== (N) OrderItem`

---

#### R22: Order - Payment
- **관계명**: "결제되다 (paid by)"
- **설명**: 주문은 하나의 결제 정보를 가진다
- **카디널리티**: `1:1` (일대일)
- **표기**: `Order (1) ==== (1) Payment`

---

#### R23: Order - Shipment
- **관계명**: "배송되다 (shipped by)"
- **설명**: 주문은 하나의 배송 정보를 가진다
- **카디널리티**: `1:1` (일대일)
- **표기**: `Order (1) ==== (1) Shipment`

---

#### R24: Order - Review
- **관계명**: "발생시키다 (generates)"
- **설명**: 주문은 여러 리뷰를 발생시킨다 (구매 확인용)
- **카디널리티**: `1:N` (일대다)
- **표기**: `Order (1) ---- (N) Review`

---

### 5.5 커뮤니티 도메인 관계

#### R25: Review - ReviewLike
- **관계명**: "받다 (receives)"
- **설명**: 리뷰는 여러 좋아요를 받는다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Review (1) ---- (N) ReviewLike`

---

#### R26: BookClub - ClubMember
- **관계명**: "가지다 (has)"
- **설명**: 독서 모임은 여러 멤버를 가진다
- **카디널리티**: `1:N` (일대다)
- **표기**: `BookClub (1) ---- (N) ClubMember`

---

#### R27: Bookshelf - BookshelfItem
- **관계명**: "포함하다 (contains)"
- **설명**: 서재는 여러 아이템을 포함한다
- **카디널리티**: `1:N` (일대다)
- **표기**: `Bookshelf (1) ---- (N) BookshelfItem`

---

## 6. 카디널리티 분석

### 6.1 카디널리티 표

| 관계 | 왼쪽 엔티티 | 카디널리티 | 오른쪽 엔티티 | 비고 |
|:-----|:-----------|:----------|:-------------|:-----|
| R1 | Member | 1:N | Address | 회원은 여러 배송지 |
| R2 | Member | 1:N | Authority | 회원은 여러 권한 |
| R3 | Member | 1:1 | Cart | 회원당 1개 장바구니 |
| R4 | Member | 1:N | Order | 회원은 여러 주문 |
| R5 | Member | 1:N | Review | 회원은 여러 리뷰 |
| R6 | Member | N:M | Review | ReviewLike 테이블로 해소 |
| R7 | Member | N:M | BookClub | ClubMember 테이블로 해소 |
| R8 | Member | N:M | Achievement | UserAchievement 테이블로 해소 |
| R9 | Member | N:M | Coupon | UserCoupon 테이블로 해소 |
| R10 | Member | 1:N | PointHistory | 회원은 여러 포인트 내역 |
| R11 | Member | 1:1 | Bookshelf | 회원당 1개 서재 |
| R12 | Author | 1:N | Book | 저자는 여러 책 |
| R13 | Publisher | 1:N | Book | 출판사는 여러 책 |
| R14 | Book | N:M | Category | Book_Category 테이블로 해소 |
| R15 | Category | 1:N | Category | 계층 구조 (Self-Join) |
| R16 | Book | 1:N | Review | 책은 여러 리뷰 |
| R17 | Book | 1:N | CartItem | 책은 여러 장바구니 항목 |
| R18 | Book | 1:N | OrderItem | 책은 여러 주문 항목 |
| R19 | Book | 1:N | BookClub | 책은 여러 독서 모임 대상 |
| R20 | Cart | 1:N | CartItem | 장바구니는 여러 항목 |
| R21 | Order | 1:N | OrderItem | 주문은 여러 항목 |
| R22 | Order | 1:1 | Payment | 주문당 1개 결제 |
| R23 | Order | 1:1 | Shipment | 주문당 1개 배송 |
| R24 | Order | 1:N | Review | 주문은 여러 리뷰 (구매 확인) |
| R25 | Review | 1:N | ReviewLike | 리뷰는 여러 좋아요 |
| R26 | BookClub | 1:N | ClubMember | 모임은 여러 멤버 |
| R27 | Bookshelf | 1:N | BookshelfItem | 서재는 여러 아이템 |

---

## 7. 개념적 ERD

### 7.1 전체 ERD 개요

```
┌─────────────────────────────────────────────────────────────────┐
│                        Luminari Bookstore                        │
│                      개념적 ERD (Conceptual ERD)                 │
└─────────────────────────────────────────────────────────────────┘

[회원 도메인]
    Member (1) ──── (N) Address
       │
       ├─── (N) Authority
       │
       ├─── (1) Cart ──── (N) CartItem ──── (N) Book
       │
       ├─── (N) Order ──── (1) Payment
       │       │          └─ (1) Shipment
       │       └── (N) OrderItem ──── (N) Book
       │
       ├─── (N) PointHistory
       │
       ├─── (N) UserCoupon ──── (N) Coupon
       │
       ├─── (N) Review ──── (N) Book
       │       └── (N) ReviewLike
       │
       ├─── (N) ClubMember ──── (N) BookClub ──── (1) Book
       │
       ├─── (N) UserAchievement ──── (N) Achievement
       │
       └─── (1) Bookshelf ──── (N) BookshelfItem

[상품 도메인]
    Book ──── (1) Author
      │
      ├─── (1) Publisher
      │
      └─── (N) Book_Category ──── (N) Category
                                      │
                                      └─ (Self) Category (계층)

[주문 도메인]
    Order ──── (N) Member
      │
      ├─── (N) OrderItem ──── (N) Book
      │
      ├─── (1) Payment
      │
      └─── (1) Shipment

[커뮤니티 도메인]
    BookClub ──── (N) ClubMember ──── (N) Member
      │
      └─── (1) Book

    Achievement ──── (N) UserAchievement ──── (N) Member

    Bookshelf ──── (N) BookshelfItem
      │
      └─── (1) Member
```

---

### 7.2 도메인별 상세 ERD

#### 7.2.1 회원 도메인 ERD

```
┌──────────────┐
│   Member     │
├──────────────┤
│ PK member_id │
│    email     │
│    password  │
│    nickname  │
│    level     │
│    rxp       │
└──────┬───────┘
       │ 1
       │
       │ N
┌──────┴───────┐      ┌─────────────┐      ┌─────────────┐
│   Address    │      │  Authority  │      │    Cart     │
├──────────────┤      ├─────────────┤      ├─────────────┤
│PK address_id │      │PK authority │      │PK cart_id   │
│FK member_id  │      │FK member_id │      │FK member_id │
│   recipient  │      │   role      │      │  created_dt │
│   address    │      └─────────────┘      └──────┬──────┘
│  is_default  │                                   │ 1
└──────────────┘                                   │
                                                   │ N
                                           ┌───────┴──────┐
                                           │   CartItem   │
                                           ├──────────────┤
                                           │PK item_id    │
                                           │FK cart_id    │
                                           │FK book_id    │
                                           │   quantity   │
                                           └──────────────┘
```

---

#### 7.2.2 상품 도메인 ERD

```
┌─────────────┐        ┌──────────────┐        ┌─────────────┐
│   Author    │   1    │     Book     │   N    │Book_Category│
├─────────────┤────────├──────────────┤────────├─────────────┤
│PK author_id │        │PK book_id    │        │PK bc_id     │
│    name     │        │   isbn       │        │FK book_id   │
│    bio      │        │   title      │        │FK category_id│
└─────────────┘        │FK author_id  │        │  is_main    │
                       │FK publisher_id│        └──────┬──────┘
┌─────────────┐        │   price      │               │ N
│  Publisher  │   1    │discount_rate │               │
├─────────────┤────────│   stock      │               │ 1
│PK publishr_id│       │   status     │        ┌──────┴──────┐
│    name     │        └──────────────┘        │  Category   │
│  website    │                                ├─────────────┤
└─────────────┘                                │PK category_id│
                                               │    name     │
                                               │FK parent_id │◄─┐
                                               │    depth    │  │
                                               └─────────────┘  │
                                                      │         │
                                                      └─────────┘
                                                   (Self-Referencing)
```

---

#### 7.2.3 주문 도메인 ERD

```
┌──────────────┐
│    Member    │
└──────┬───────┘
       │ 1
       │
       │ N
┌──────┴───────┐        ┌─────────────┐
│    Order     │   1    │  OrderItem  │
├──────────────┤────────├─────────────┤
│PK order_id   │        │PK item_id   │
│  order_number│        │FK order_id  │
│FK member_id  │        │FK book_id   │
│  order_date  │        │   quantity  │
│    status    │        │   price     │
│ final_price  │        └─────────────┘
└──────┬───────┘
       │ 1
       ├──────────────────┐
       │ 1                │ 1
┌──────┴───────┐  ┌───────┴──────┐
│   Payment    │  │   Shipment   │
├──────────────┤  ├──────────────┤
│PK payment_id │  │PK shipment_id│
│FK order_id   │  │FK order_id   │
│   method     │  │   courier    │
│   amount     │  │tracking_num  │
│   status     │  │   status     │
└──────────────┘  └──────────────┘
```

---

#### 7.2.4 커뮤니티 도메인 ERD

```
┌──────────────┐        ┌─────────────┐
│    Member    │   1    │   Review    │
└──────┬───────┘────────├─────────────┤
       │                │PK review_id │
       │                │FK member_id │
       │                │FK book_id   │
       │                │   rating    │
       │                │  content    │
       │                └──────┬──────┘
       │                       │ 1
       │                       │
       │                       │ N
       │                ┌──────┴──────┐
       │                │ ReviewLike  │
       │                ├─────────────┤
       │                │PK like_id   │
       │                │FK review_id │
       │                │FK member_id │
       │                └─────────────┘
       │
       │ N
┌──────┴───────┐        ┌─────────────┐        ┌─────────────┐
│ ClubMember   │   N    │  BookClub   │   1    │    Book     │
├──────────────┤────────├─────────────┤────────└─────────────┘
│PK cm_id      │        │PK club_id   │
│FK club_id    │        │   title     │
│FK member_id  │        │FK book_id   │
│  joined_date │        │  max_members│
│    role      │        │   status    │
└──────────────┘        └─────────────┘

┌──────────────┐        ┌──────────────┐
│    Member    │   1    │UserAchievemnt│   N   ┌─────────────┐
└──────┬───────┘────────├──────────────┤───────│ Achievement │
       │                │PK ua_id      │       ├─────────────┤
       │                │FK member_id  │       │PK achiev_id │
       │                │FK achiev_id  │       │    type     │
       │                │acquired_date │       │    name     │
       │                └──────────────┘       │  reward_rxp │
       │                                       └─────────────┘
       │ 1
┌──────┴───────┐
│  Bookshelf   │
├──────────────┤
│PK shelf_id   │
│FK member_id  │
│    theme     │
│  is_public   │
└──────┬───────┘
       │ 1
       │
       │ N
┌──────┴───────┐
│BookshelfItem │
├──────────────┤
│PK item_id    │
│FK shelf_id   │
│  item_type   │
│  position_x  │
│  position_y  │
└──────────────┘
```

---

## 8. 비즈니스 규칙 반영

### 8.1 도메인 규칙

#### 8.1.1 회원 관련 규칙
1. **이메일 고유성**: `Member.email`은 UNIQUE 제약조건
2. **닉네임 고유성**: `Member.nickname`은 UNIQUE 제약조건
3. **기본 배송지 필수**: 최소 1개의 `Address.is_default = TRUE`
4. **휴면 계정 전환**: 1년간 `last_login` 없으면 `status = 'INACTIVE'`

#### 8.1.2 도서 관련 규칙
1. **ISBN 고유성**: `Book.isbn`은 UNIQUE 제약조건
2. **가격 양수**: `Book.price > 0`
3. **할인율 범위**: `0 <= Book.discount_rate <= 100`
4. **재고 품절**: `Book.stock = 0` → `Book.status = 'OUT_OF_STOCK'`

#### 8.1.3 주문 관련 규칙
1. **배송비 정책**: `Order.total_product_price >= 30000` → `shipping_fee = 0`, 아니면 `3000`
2. **최종 가격 계산**: `final_price = total_product_price + shipping_fee - discount_amount - point_used`
3. **주문번호 형식**: `'ORD' + YYYYMMDDHHMMSS`
4. **주문 취소 제한**: `status = 'PAYMENT_COMPLETED'` 또는 `'PREPARING'`일 때만 취소 가능

#### 8.1.4 리뷰 관련 규칙
1. **구매자만 작성**: `Review.member_id`와 `Review.order_id` 연계 검증
2. **중복 방지**: `(Review.member_id, Review.book_id)` 조합 UNIQUE
3. **본인 좋아요 방지**: `ReviewLike.member_id != Review.member_id` (애플리케이션 레벨)

#### 8.1.5 포인트 관련 규칙
1. **유효기간**: `PointHistory.created_date + 1년 = expires_date`
2. **사용 제한**: `amount >= 1000`, `amount % 100 = 0`, `amount <= final_price * 0.5`

#### 8.1.6 쿠폰 관련 규칙
1. **유효기간**: `CURDATE() BETWEEN Coupon.start_date AND Coupon.end_date`
2. **발행 수량**: `Coupon.issued_quantity <= Coupon.total_quantity`
3. **중복 사용 불가**: 1개 주문에 1개 쿠폰

---

## 9. 데이터 무결성 규칙

### 9.1 개체 무결성 (Entity Integrity)

**정의**: 모든 엔티티는 고유한 식별자(Primary Key)를 가져야 하며, NULL이 될 수 없음

**적용**:
- 모든 테이블의 PK는 `NOT NULL`, `UNIQUE`
- 대부분의 PK는 `AUTO_INCREMENT` (시퀀스)

---

### 9.2 참조 무결성 (Referential Integrity)

**정의**: Foreign Key는 참조하는 테이블의 Primary Key 값만 가져야 하며, NULL이거나 유효한 값이어야 함

**적용 원칙**:
1. **CASCADE**: 부모 삭제 시 자식도 함께 삭제
   - 예: `Order` 삭제 → `OrderItem`, `Payment`, `Shipment` 함께 삭제
2. **RESTRICT**: 자식이 있으면 부모 삭제 불가
   - 예: `Member` 삭제 시 `Order`가 있으면 삭제 불가
3. **SET NULL**: 부모 삭제 시 자식의 FK를 NULL로 설정
   - 예: `Author` 삭제 → `Book.author_id = NULL` (단, NULL 허용 시)

**주요 FK 제약**:
- `Address.member_id` → `Member.member_id` (ON DELETE CASCADE)
- `Order.member_id` → `Member.member_id` (ON DELETE RESTRICT)
- `OrderItem.order_id` → `Order.order_id` (ON DELETE CASCADE)
- `Review.member_id` → `Member.member_id` (ON DELETE CASCADE)
- `Book.author_id` → `Author.author_id` (ON DELETE RESTRICT)

---

### 9.3 도메인 무결성 (Domain Integrity)

**정의**: 속성의 값은 정의된 도메인(데이터 타입, 범위, 형식) 내에 있어야 함

**적용**:
- `Member.email`: 이메일 형식 검증 (정규표현식)
- `Book.price`: `DECIMAL(10, 2)`, `CHECK (price > 0)`
- `Book.discount_rate`: `CHECK (discount_rate >= 0 AND discount_rate <= 100)`
- `Review.rating`: `CHECK (rating >= 1.0 AND rating <= 5.0)`
- `Member.status`: `ENUM('ACTIVE', 'INACTIVE', 'SUSPENDED', 'WITHDRAWN')`

---

### 9.4 업무 규칙 무결성 (Business Rule Integrity)

**정의**: 비즈니스 로직에 따른 제약사항

**적용 방법**:
1. **CHECK 제약조건**: 데이터베이스 레벨
2. **트리거(Trigger)**: 자동화된 규칙 적용
3. **애플리케이션 레벨**: 복잡한 비즈니스 로직

**예시**:
- **재고 검증**: 주문 시 `Book.stock >= OrderItem.quantity` 확인
- **포인트 잔액 검증**: `Member.point >= Order.point_used`
- **쿠폰 유효성 검증**: 쿠폰 사용 가능 기간, 최소 주문 금액 등

---

## 10. 검증 및 리뷰

### 10.1 모델 검증 체크리스트

#### 10.1.1 완전성 (Completeness)
- [x] 모든 요구사항이 엔티티와 관계로 표현되었는가?
- [x] 누락된 엔티티나 속성은 없는가?
- [x] 모든 비즈니스 규칙이 반영되었는가?

#### 10.1.2 정확성 (Correctness)
- [x] 엔티티와 관계가 비즈니스 요구사항을 정확히 반영하는가?
- [x] 카디널리티가 올바르게 설정되었는가?
- [x] 참여 제약이 적절한가?

#### 10.1.3 일관성 (Consistency)
- [x] 명명 규칙이 일관되게 적용되었는가?
- [x] 동일한 개념에 대해 동일한 표현을 사용하는가?

#### 10.1.4 최소성 (Minimality)
- [x] 중복된 엔티티나 속성은 없는가?
- [x] 불필요한 관계는 없는가?

#### 10.1.5 이해가능성 (Understandability)
- [x] 모델이 이해관계자에게 명확한가?
- [x] 문서화가 충분한가?

---

### 10.2 이해관계자 리뷰

#### 10.2.1 비즈니스 팀 리뷰
- **확인 사항**: 비즈니스 규칙 반영 여부, 요구사항 충족 여부
- **리뷰 포인트**: "이 모델이 우리의 비즈니스를 정확히 표현하는가?"

#### 10.2.2 개발팀 리뷰
- **확인 사항**: 구현 가능성, 성능 고려사항, 확장성
- **리뷰 포인트**: "이 모델을 실제 데이터베이스로 구현할 수 있는가?"

#### 10.2.3 DBA 리뷰
- **확인 사항**: 정규화 수준, 인덱스 전략, 성능 최적화
- **리뷰 포인트**: "이 모델이 효율적으로 운영될 수 있는가?"

---

### 10.3 개선 제안 사항

#### 10.3.1 성능 고려사항
1. **역정규화 검토**:
   - `Book.rating_avg`, `Book.review_count`: 집계값 저장 (비정규화)
   - `Member.point`: 현재 포인트 잔액 저장 (PointHistory 집계 대신)

2. **인덱스 전략** (3단계에서 상세):
   - `Book.isbn`, `Member.email`, `Order.order_number`: UNIQUE INDEX
   - `Book.title`, `Book.author_id`, `Order.member_id`: INDEX

#### 10.3.2 확장성 고려사항
1. **공저 지원**: `Book_Author` 연결 테이블 추가 (N:M)
2. **다국어 지원**: `Book_Translation` 테이블 추가
3. **교환/환불 처리**: `OrderReturn` 테이블 추가
4. **쿠폰 사용 로그**: `CouponUsageHistory` 테이블 추가

---

## 11. 다음 단계 안내

2단계 개념적 데이터 모델링이 완료되었습니다. 이제 다음 단계로 진행할 수 있습니다:

### **3단계: 논리적 데이터 모델링**
- 개념적 모델을 관계형 데이터베이스 구조로 변환
- 정규화(Normalization) 수행
- 모든 속성의 데이터 타입 정의
- 제약조건 상세 정의
- 논리적 ERD 작성
- 테이블 명세서 작성

### **4단계: 물리적 데이터 모델링**
- 실제 DBMS(MySQL, PostgreSQL 등)에 맞춘 DDL 작성
- 인덱스 설계 및 생성
- 파티셔닝 전략
- 스토리지 엔진 선택
- 성능 최적화
- 실제 데이터베이스 생성 및 테스트

---

## 12. 결론

이 문서는 **Luminari Bookstore 프로젝트**의 **2단계 개념적 데이터 모델링**을 상세히 다루었습니다.

### 주요 성과:
1. **도메인 분석**: 6개 서브도메인으로 명확히 분리
2. **엔티티 정의**: 30개 이상의 엔티티 상세 정의
3. **관계 정의**: 27개의 관계와 카디널리티 분석
4. **개념적 ERD**: 도메인별 상세 ERD 작성
5. **비즈니스 규칙**: 모든 업무 규칙을 모델에 반영
6. **무결성 규칙**: 4가지 유형의 데이터 무결성 정의

### 핵심 성과물:
- ✅ 엔티티 정의서 (30+ 엔티티)
- ✅ 속성 정의서 (주요 엔티티별 상세 속성)
- ✅ 관계 정의서 (27개 관계)
- ✅ 개념적 ERD (전체 및 도메인별)
- ✅ 비즈니스 규칙 문서
- ✅ 데이터 무결성 규칙

이 개념적 모델은 다음 단계인 **논리적 데이터 모델링**의 기반이 되며, 최종적으로 실제 데이터베이스 구축으로 이어집니다.

---

**작성 정보**:
- **문서명**: 2단계: 개념적 데이터 모델링
- **프로젝트**: Luminari Bookstore
- **작성일**: 2025-11-19
- **버전**: 1.0
- **이전 단계**: 1단계 - 요구사항 분석
- **다음 단계**: 3단계 - 논리적 데이터 모델링
