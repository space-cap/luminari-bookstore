# 4단계: 물리적 데이터 모델링 (Physical Data Modeling)

## 목차
1. [물리적 데이터 모델링 개요](#1-물리적-데이터-모델링-개요)
2. [DBMS 환경 설정](#2-dbms-환경-설정)
3. [데이터베이스 생성](#3-데이터베이스-생성)
4. [DDL 스크립트](#4-ddl-스크립트)
5. [인덱스 생성 스크립트](#5-인덱스-생성-스크립트)
6. [제약조건 추가 스크립트](#6-제약조건-추가-스크립트)
7. [트리거 및 프로시저](#7-트리거-및-프로시저)
8. [초기 데이터 삽입](#8-초기-데이터-삽입)
9. [데이터베이스 검증](#9-데이터베이스-검증)
10. [백업 및 복구 전략](#10-백업-및-복구-전략)
11. [성능 튜닝](#11-성능-튜닝)
12. [배포 가이드](#12-배포-가이드)

---

## 1. 물리적 데이터 모델링 개요

### 1.1 물리적 데이터 모델링이란?

물리적 데이터 모델링은 **논리적 모델을 실제 DBMS에 구현**하는 최종 단계입니다. 이 단계에서는 특정 DBMS의 특성을 고려하여 DDL을 작성하고, 성능 최적화를 위한 물리적 설정을 수행합니다.

### 1.2 목표
- MySQL 8.0 기반 DDL 스크립트 작성
- 데이터베이스 및 테이블 생성
- 인덱스 및 제약조건 적용
- 트리거 및 스토어드 프로시저 작성
- 초기 데이터 삽입
- 성능 최적화 및 검증

### 1.3 DBMS 선택

**선택**: **MySQL 8.0**

**선택 이유**:
1. **오픈소스**: 무료 사용 가능
2. **안정성**: 검증된 RDBMS
3. **성능**: 대용량 트래픽 처리 가능
4. **생태계**: 풍부한 도구 및 라이브러리
5. **Spring Boot 호환성**: JPA/Hibernate 최적화

**대안**:
- PostgreSQL (더 강력한 기능, 복잡한 쿼리에 유리)
- MariaDB (MySQL 호환, 일부 추가 기능)

---

### 1.4 물리적 설계 원칙

1. **스토리지 엔진**: InnoDB (트랜잭션, 외래키 지원)
2. **문자셋**: UTF8MB4 (이모지 지원)
3. **Collation**: utf8mb4_unicode_ci (대소문자 구분 없음)
4. **파티셔닝**: 추후 필요 시 적용
5. **인덱스 전략**: 쿼리 패턴 기반 최적화

---

## 2. DBMS 환경 설정

### 2.1 MySQL 8.0 설치 (참고)

#### Windows
```bash
# MySQL Installer 다운로드
https://dev.mysql.com/downloads/installer/

# 또는 Chocolatey 사용
choco install mysql
```

#### Linux (Ubuntu)
```bash
sudo apt update
sudo apt install mysql-server

# 보안 설정
sudo mysql_secure_installation
```

#### macOS
```bash
brew install mysql
brew services start mysql
```

---

### 2.2 MySQL 설정 파일 (my.cnf / my.ini)

```ini
[mysqld]
# 기본 설정
port = 3306
default-storage-engine = INNODB
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# InnoDB 설정
innodb_buffer_pool_size = 2G          # 전체 메모리의 70~80%
innodb_log_file_size = 256M
innodb_flush_log_at_trx_commit = 1    # 트랜잭션 안정성 최대
innodb_file_per_table = 1             # 테이블별 파일 생성

# 연결 설정
max_connections = 500
max_connect_errors = 100

# 쿼리 캐시 (MySQL 8.0에서는 제거됨, 참고용)
# query_cache_size = 0

# 로그 설정
general_log = 0                       # 프로덕션에서는 OFF
slow_query_log = 1                    # 슬로우 쿼리 로그 활성화
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2                   # 2초 이상 쿼리 기록

# 바이너리 로그 (복제 및 백업용)
log_bin = /var/log/mysql/mysql-bin.log
expire_logs_days = 7
max_binlog_size = 100M

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4
```

---

### 2.3 사용자 및 권한 설정

```sql
-- root 로그인
mysql -u root -p

-- 데이터베이스 사용자 생성
CREATE USER 'luminari_user'@'localhost' IDENTIFIED BY 'strong_password_123!';
CREATE USER 'luminari_user'@'%' IDENTIFIED BY 'strong_password_123!';

-- 권한 부여
GRANT ALL PRIVILEGES ON luminari_bookstore.* TO 'luminari_user'@'localhost';
GRANT ALL PRIVILEGES ON luminari_bookstore.* TO 'luminari_user'@'%';

-- 권한 적용
FLUSH PRIVILEGES;

-- 읽기 전용 사용자 (리포트용)
CREATE USER 'luminari_readonly'@'localhost' IDENTIFIED BY 'readonly_password';
GRANT SELECT ON luminari_bookstore.* TO 'luminari_readonly'@'localhost';
FLUSH PRIVILEGES;
```

---

## 3. 데이터베이스 생성

### 3.1 데이터베이스 생성 스크립트

```sql
-- 기존 데이터베이스 삭제 (개발 환경에서만)
-- DROP DATABASE IF EXISTS luminari_bookstore;

-- 데이터베이스 생성
CREATE DATABASE IF NOT EXISTS luminari_bookstore
    CHARACTER SET utf8mb4
    COLLATE utf8mb4_unicode_ci;

-- 데이터베이스 선택
USE luminari_bookstore;

-- 데이터베이스 정보 확인
SELECT 
    SCHEMA_NAME,
    DEFAULT_CHARACTER_SET_NAME,
    DEFAULT_COLLATION_NAME
FROM information_schema.SCHEMATA
WHERE SCHEMA_NAME = 'luminari_bookstore';
```

---

## 4. DDL 스크립트

### 4.1 회원 도메인

#### 4.1.1 member (회원)

```sql
CREATE TABLE member (
    member_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '회원 ID',
    email VARCHAR(100) NOT NULL COMMENT '이메일 (로그인 ID)',
    password VARCHAR(255) NOT NULL COMMENT '암호화된 비밀번호',
    name VARCHAR(50) NOT NULL COMMENT '이름',
    nickname VARCHAR(20) NOT NULL COMMENT '닉네임',
    phone VARCHAR(20) NOT NULL COMMENT '휴대폰 번호',
    profile_image VARCHAR(500) NULL COMMENT '프로필 사진 URL',
    bio VARCHAR(500) NULL COMMENT '자기소개',
    birth_date DATE NULL COMMENT '생년월일',
    gender ENUM('M', 'F', 'OTHER') NULL COMMENT '성별',
    level INT NOT NULL DEFAULT 1 COMMENT '레벨',
    rxp INT NOT NULL DEFAULT 0 COMMENT '경험치 (Reading XP)',
    point INT NOT NULL DEFAULT 0 COMMENT '보유 포인트',
    join_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '가입일시',
    last_login DATETIME NULL COMMENT '최근 로그인 일시',
    status ENUM('ACTIVE', 'INACTIVE', 'SUSPENDED', 'WITHDRAWN') NOT NULL DEFAULT 'ACTIVE' COMMENT '계정 상태',
    
    PRIMARY KEY (member_id),
    UNIQUE KEY uk_member_email (email),
    UNIQUE KEY uk_member_nickname (nickname),
    KEY idx_member_phone (phone),
    KEY idx_member_status (status),
    
    CONSTRAINT chk_member_level CHECK (level >= 1),
    CONSTRAINT chk_member_rxp CHECK (rxp >= 0),
    CONSTRAINT chk_member_point CHECK (point >= 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='회원';
```

---

#### 4.1.2 address (배송지)

```sql
CREATE TABLE address (
    address_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '배송지 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    alias VARCHAR(50) NULL COMMENT '배송지 별칭',
    recipient VARCHAR(50) NOT NULL COMMENT '수령인',
    postal_code VARCHAR(10) NOT NULL COMMENT '우편번호',
    address VARCHAR(200) NOT NULL COMMENT '기본 주소',
    detail_address VARCHAR(100) NULL COMMENT '상세 주소',
    phone VARCHAR(20) NOT NULL COMMENT '연락처',
    is_default BOOLEAN NOT NULL DEFAULT FALSE COMMENT '기본 배송지 여부',
    
    PRIMARY KEY (address_id),
    KEY idx_address_member (member_id),
    
    CONSTRAINT fk_address_member FOREIGN KEY (member_id) 
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='배송지';
```

---

#### 4.1.3 authority (권한)

```sql
CREATE TABLE authority (
    authority_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '권한 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    role VARCHAR(20) NOT NULL COMMENT '역할 (ROLE_MEMBER, ROLE_ADMIN)',
    
    PRIMARY KEY (authority_id),
    KEY idx_authority_member (member_id),
    
    CONSTRAINT fk_authority_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='권한';
```

---

### 4.2 상품 도메인

#### 4.2.1 author (저자)

```sql
CREATE TABLE author (
    author_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '저자 ID',
    name VARCHAR(100) NOT NULL COMMENT '저자명',
    bio TEXT NULL COMMENT '약력',
    photo VARCHAR(500) NULL COMMENT '사진 URL',
    nationality VARCHAR(50) NULL COMMENT '국적',
    
    PRIMARY KEY (author_id),
    KEY idx_author_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='저자';
```

---

#### 4.2.2 publisher (출판사)

```sql
CREATE TABLE publisher (
    publisher_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '출판사 ID',
    name VARCHAR(100) NOT NULL COMMENT '출판사명',
    description TEXT NULL COMMENT '소개',
    website VARCHAR(200) NULL COMMENT '웹사이트',
    contact VARCHAR(100) NULL COMMENT '연락처',
    
    PRIMARY KEY (publisher_id),
    KEY idx_publisher_name (name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='출판사';
```

---

#### 4.2.3 category (카테고리)

```sql
CREATE TABLE category (
    category_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '카테고리 ID',
    name VARCHAR(50) NOT NULL COMMENT '카테고리명',
    parent_category_id BIGINT NULL COMMENT '부모 카테고리 ID',
    depth TINYINT NOT NULL DEFAULT 1 COMMENT '계층 깊이 (1~3)',
    display_order INT NOT NULL DEFAULT 0 COMMENT '표시 순서',
    description VARCHAR(200) NULL COMMENT '설명',
    
    PRIMARY KEY (category_id),
    KEY idx_category_parent (parent_category_id),
    KEY idx_category_depth (depth),
    
    CONSTRAINT chk_category_depth CHECK (depth >= 1 AND depth <= 3),
    CONSTRAINT fk_category_parent FOREIGN KEY (parent_category_id)
        REFERENCES category(category_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='카테고리';
```

---

#### 4.2.4 book (책)

```sql
CREATE TABLE book (
    book_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '책 ID',
    isbn VARCHAR(13) NOT NULL COMMENT 'ISBN-13',
    isbn10 VARCHAR(10) NULL COMMENT 'ISBN-10',
    title VARCHAR(200) NOT NULL COMMENT '제목',
    subtitle VARCHAR(200) NULL COMMENT '부제',
    author_id BIGINT NOT NULL COMMENT '저자 ID',
    publisher_id BIGINT NOT NULL COMMENT '출판사 ID',
    publish_date DATE NOT NULL COMMENT '출간일',
    pages INT NULL COMMENT '페이지 수',
    dimensions VARCHAR(50) NULL COMMENT '크기',
    weight INT NULL COMMENT '무게 (g)',
    price DECIMAL(10,2) NOT NULL COMMENT '정가',
    discount_rate DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT '할인율 (%)',
    final_price DECIMAL(10,2) NOT NULL COMMENT '최종 가격',
    cover_image VARCHAR(500) NOT NULL COMMENT '표지 이미지 URL',
    detail_images JSON NULL COMMENT '상세 이미지 URL (JSON)',
    description TEXT NULL COMMENT '책 소개',
    table_of_contents TEXT NULL COMMENT '목차',
    preview_pages JSON NULL COMMENT '미리보기 페이지 (JSON)',
    stock INT NOT NULL DEFAULT 0 COMMENT '재고 수량',
    sales_count INT NOT NULL DEFAULT 0 COMMENT '판매 수량',
    rating_avg DECIMAL(3,2) NULL COMMENT '평균 평점',
    review_count INT NOT NULL DEFAULT 0 COMMENT '리뷰 수',
    status ENUM('AVAILABLE', 'OUT_OF_STOCK', 'DISCONTINUED') NOT NULL DEFAULT 'AVAILABLE' COMMENT '상태',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '등록일시',
    updated_date DATETIME NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    
    PRIMARY KEY (book_id),
    UNIQUE KEY uk_book_isbn (isbn),
    KEY idx_book_title (title),
    KEY idx_book_author (author_id),
    KEY idx_book_publisher (publisher_id),
    KEY idx_book_status (status),
    KEY idx_book_publish_date (publish_date),
    KEY idx_book_sales (sales_count DESC),
    KEY idx_book_rating (rating_avg DESC),
    FULLTEXT KEY ft_book_search (title, description),
    
    CONSTRAINT chk_book_price CHECK (price > 0),
    CONSTRAINT chk_book_discount_rate CHECK (discount_rate >= 0 AND discount_rate <= 100),
    CONSTRAINT chk_book_final_price CHECK (final_price >= 0),
    CONSTRAINT chk_book_pages CHECK (pages IS NULL OR pages > 0),
    CONSTRAINT chk_book_weight CHECK (weight IS NULL OR weight > 0),
    CONSTRAINT chk_book_stock CHECK (stock >= 0),
    CONSTRAINT chk_book_sales_count CHECK (sales_count >= 0),
    CONSTRAINT chk_book_review_count CHECK (review_count >= 0),
    CONSTRAINT chk_book_rating_avg CHECK (rating_avg IS NULL OR (rating_avg >= 0 AND rating_avg <= 5.0)),
    
    CONSTRAINT fk_book_author FOREIGN KEY (author_id)
        REFERENCES author(author_id) ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT fk_book_publisher FOREIGN KEY (publisher_id)
        REFERENCES publisher(publisher_id) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='책';
```

---

#### 4.2.5 book_category (책-카테고리 연결)

```sql
CREATE TABLE book_category (
    book_category_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '연결 ID',
    book_id BIGINT NOT NULL COMMENT '책 ID',
    category_id BIGINT NOT NULL COMMENT '카테고리 ID',
    is_main BOOLEAN NOT NULL DEFAULT FALSE COMMENT '주 카테고리 여부',
    
    PRIMARY KEY (book_category_id),
    UNIQUE KEY uk_book_category (book_id, category_id),
    KEY idx_book_category_book (book_id),
    KEY idx_book_category_category (category_id),
    
    CONSTRAINT fk_book_category_book FOREIGN KEY (book_id)
        REFERENCES book(book_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_book_category_category FOREIGN KEY (category_id)
        REFERENCES category(category_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='책-카테고리 연결';
```

---

### 4.3 주문 도메인

#### 4.3.1 cart (장바구니)

```sql
CREATE TABLE cart (
    cart_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '장바구니 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '생성일시',
    updated_date DATETIME NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '최종 수정일시',
    
    PRIMARY KEY (cart_id),
    UNIQUE KEY uk_cart_member (member_id),
    
    CONSTRAINT fk_cart_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='장바구니';
```

---

#### 4.3.2 cart_item (장바구니 항목)

```sql
CREATE TABLE cart_item (
    cart_item_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '장바구니 항목 ID',
    cart_id BIGINT NOT NULL COMMENT '장바구니 ID',
    book_id BIGINT NOT NULL COMMENT '책 ID',
    quantity INT NOT NULL DEFAULT 1 COMMENT '수량',
    added_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '담은 날짜',
    
    PRIMARY KEY (cart_item_id),
    UNIQUE KEY uk_cart_item (cart_id, book_id),
    KEY idx_cart_item_cart (cart_id),
    KEY idx_cart_item_book (book_id),
    
    CONSTRAINT chk_cart_item_quantity CHECK (quantity >= 1 AND quantity <= 99),
    
    CONSTRAINT fk_cart_item_cart FOREIGN KEY (cart_id)
        REFERENCES cart(cart_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_cart_item_book FOREIGN KEY (book_id)
        REFERENCES book(book_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='장바구니 항목';
```

---

#### 4.3.3 orders (주문)

```sql
CREATE TABLE orders (
    order_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '주문 ID',
    order_number VARCHAR(20) NOT NULL COMMENT '주문번호',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    order_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '주문일시',
    status ENUM('PENDING', 'PAYMENT_COMPLETED', 'PREPARING', 'SHIPPING', 'DELIVERED', 'CONFIRMED', 'CANCELLED', 'REFUNDED') 
        NOT NULL DEFAULT 'PENDING' COMMENT '주문 상태',
    total_product_price DECIMAL(10,2) NOT NULL COMMENT '총 상품 금액',
    shipping_fee DECIMAL(10,2) NOT NULL COMMENT '배송비',
    discount_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '할인 금액',
    point_used INT NOT NULL DEFAULT 0 COMMENT '사용 포인트',
    final_price DECIMAL(10,2) NOT NULL COMMENT '최종 결제 금액',
    recipient VARCHAR(50) NOT NULL COMMENT '수령인',
    postal_code VARCHAR(10) NOT NULL COMMENT '우편번호',
    address VARCHAR(200) NOT NULL COMMENT '주소',
    detail_address VARCHAR(100) NULL COMMENT '상세 주소',
    phone VARCHAR(20) NOT NULL COMMENT '연락처',
    delivery_request VARCHAR(200) NULL COMMENT '배송 요청사항',
    
    PRIMARY KEY (order_id),
    UNIQUE KEY uk_order_number (order_number),
    KEY idx_order_member (member_id),
    KEY idx_order_date (order_date DESC),
    KEY idx_order_status (status),
    KEY idx_order_member_date (member_id, order_date DESC),
    KEY idx_order_member_status (member_id, status),
    
    CONSTRAINT chk_order_total_product_price CHECK (total_product_price >= 0),
    CONSTRAINT chk_order_shipping_fee CHECK (shipping_fee >= 0),
    CONSTRAINT chk_order_discount_amount CHECK (discount_amount >= 0),
    CONSTRAINT chk_order_point_used CHECK (point_used >= 0),
    CONSTRAINT chk_order_final_price CHECK (final_price >= 0),
    
    CONSTRAINT fk_order_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='주문';
```

---

#### 4.3.4 order_item (주문 항목)

```sql
CREATE TABLE order_item (
    order_item_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '주문 항목 ID',
    order_id BIGINT NOT NULL COMMENT '주문 ID',
    book_id BIGINT NOT NULL COMMENT '책 ID',
    quantity INT NOT NULL COMMENT '수량',
    price DECIMAL(10,2) NOT NULL COMMENT '주문 당시 가격',
    discount_rate DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT '주문 당시 할인율',
    subtotal DECIMAL(10,2) NOT NULL COMMENT '소계',
    
    PRIMARY KEY (order_item_id),
    KEY idx_order_item_order (order_id),
    KEY idx_order_item_book (book_id),
    
    CONSTRAINT chk_order_item_quantity CHECK (quantity >= 1),
    CONSTRAINT chk_order_item_price CHECK (price > 0),
    CONSTRAINT chk_order_item_discount_rate CHECK (discount_rate >= 0 AND discount_rate <= 100),
    CONSTRAINT chk_order_item_subtotal CHECK (subtotal >= 0),
    
    CONSTRAINT fk_order_item_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_order_item_book FOREIGN KEY (book_id)
        REFERENCES book(book_id) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='주문 항목';
```

---

#### 4.3.5 payment (결제)

```sql
CREATE TABLE payment (
    payment_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '결제 ID',
    order_id BIGINT NOT NULL COMMENT '주문 ID',
    payment_method ENUM('CARD', 'BANK_TRANSFER', 'KAKAO_PAY', 'NAVER_PAY', 'TOSS') NOT NULL COMMENT '결제 수단',
    payment_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '결제일시',
    amount DECIMAL(10,2) NOT NULL COMMENT '결제 금액',
    pg_provider VARCHAR(50) NULL COMMENT 'PG사',
    pg_transaction_id VARCHAR(100) NULL COMMENT 'PG 거래 ID',
    status ENUM('PENDING', 'COMPLETED', 'FAILED', 'CANCELLED', 'REFUNDED') NOT NULL DEFAULT 'PENDING' COMMENT '결제 상태',
    
    PRIMARY KEY (payment_id),
    UNIQUE KEY uk_payment_order (order_id),
    KEY idx_payment_pg_transaction (pg_transaction_id),
    
    CONSTRAINT chk_payment_amount CHECK (amount > 0),
    
    CONSTRAINT fk_payment_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='결제';
```

---

#### 4.3.6 shipment (배송)

```sql
CREATE TABLE shipment (
    shipment_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '배송 ID',
    order_id BIGINT NOT NULL COMMENT '주문 ID',
    courier VARCHAR(50) NULL COMMENT '택배사',
    tracking_number VARCHAR(50) NULL COMMENT '송장번호',
    shipped_date DATETIME NULL COMMENT '발송일시',
    delivered_date DATETIME NULL COMMENT '배송 완료일시',
    status ENUM('PREPARING', 'SHIPPED', 'IN_TRANSIT', 'OUT_FOR_DELIVERY', 'DELIVERED', 'RETURNED') 
        NOT NULL DEFAULT 'PREPARING' COMMENT '배송 상태',
    
    PRIMARY KEY (shipment_id),
    UNIQUE KEY uk_shipment_order (order_id),
    KEY idx_shipment_tracking (tracking_number),
    
    CONSTRAINT fk_shipment_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='배송';
```

---

### 4.4 프로모션 도메인

#### 4.4.1 coupon (쿠폰)

```sql
CREATE TABLE coupon (
    coupon_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '쿠폰 ID',
    code VARCHAR(50) NOT NULL COMMENT '쿠폰 코드',
    name VARCHAR(100) NOT NULL COMMENT '쿠폰명',
    type ENUM('FIXED', 'PERCENT', 'FREE_SHIPPING') NOT NULL COMMENT '쿠폰 유형',
    discount_value DECIMAL(10,2) NOT NULL COMMENT '할인 값',
    min_order_amount DECIMAL(10,2) NOT NULL DEFAULT 0.00 COMMENT '최소 주문 금액',
    max_discount_amount DECIMAL(10,2) NULL COMMENT '최대 할인 금액',
    start_date DATE NOT NULL COMMENT '사용 시작일',
    end_date DATE NOT NULL COMMENT '사용 종료일',
    total_quantity INT NULL COMMENT '총 발행 수량',
    issued_quantity INT NOT NULL DEFAULT 0 COMMENT '발급된 수량',
    target_category_id BIGINT NULL COMMENT '대상 카테고리',
    target_book_id BIGINT NULL COMMENT '대상 도서',
    
    PRIMARY KEY (coupon_id),
    UNIQUE KEY uk_coupon_code (code),
    KEY idx_coupon_date (start_date, end_date),
    
    CONSTRAINT chk_coupon_discount_value CHECK (discount_value > 0),
    CONSTRAINT chk_coupon_min_order_amount CHECK (min_order_amount >= 0),
    CONSTRAINT chk_coupon_max_discount_amount CHECK (max_discount_amount IS NULL OR max_discount_amount > 0),
    CONSTRAINT chk_coupon_total_quantity CHECK (total_quantity IS NULL OR total_quantity > 0),
    CONSTRAINT chk_coupon_issued_quantity CHECK (issued_quantity >= 0),
    
    CONSTRAINT fk_coupon_category FOREIGN KEY (target_category_id)
        REFERENCES category(category_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_coupon_book FOREIGN KEY (target_book_id)
        REFERENCES book(book_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='쿠폰';
```

---

#### 4.4.2 user_coupon (사용자 보유 쿠폰)

```sql
CREATE TABLE user_coupon (
    user_coupon_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '사용자 쿠폰 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    coupon_id BIGINT NOT NULL COMMENT '쿠폰 ID',
    issued_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '발급일시',
    used_date DATETIME NULL COMMENT '사용일시',
    order_id BIGINT NULL COMMENT '사용한 주문 ID',
    status ENUM('AVAILABLE', 'USED', 'EXPIRED') NOT NULL DEFAULT 'AVAILABLE' COMMENT '상태',
    
    PRIMARY KEY (user_coupon_id),
    KEY idx_user_coupon_member (member_id),
    KEY idx_user_coupon_status (status),
    KEY idx_user_coupon_member_status (member_id, status),
    
    CONSTRAINT fk_user_coupon_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_user_coupon_coupon FOREIGN KEY (coupon_id)
        REFERENCES coupon(coupon_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_user_coupon_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='사용자 보유 쿠폰';
```

---

#### 4.4.3 point_history (포인트 내역)

```sql
CREATE TABLE point_history (
    point_history_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '포인트 내역 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    type ENUM('EARN', 'USE', 'CANCEL', 'EXPIRE') NOT NULL COMMENT '유형',
    amount INT NOT NULL COMMENT '금액',
    reason VARCHAR(200) NOT NULL COMMENT '사유',
    order_id BIGINT NULL COMMENT '관련 주문 ID',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '발생일시',
    balance INT NOT NULL COMMENT '거래 후 잔액',
    expires_date DATE NULL COMMENT '만료일',
    
    PRIMARY KEY (point_history_id),
    KEY idx_point_history_member (member_id),
    KEY idx_point_history_created (created_date DESC),
    KEY idx_point_history_member_created (member_id, created_date DESC),
    
    CONSTRAINT chk_point_history_balance CHECK (balance >= 0),
    
    CONSTRAINT fk_point_history_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_point_history_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='포인트 내역';
```

---

### 4.5 커뮤니티 도메인

#### 4.5.1 review (리뷰)

```sql
CREATE TABLE review (
    review_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '리뷰 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    book_id BIGINT NOT NULL COMMENT '책 ID',
    order_id BIGINT NULL COMMENT '구매 확인용 주문 ID',
    rating DECIMAL(2,1) NOT NULL COMMENT '별점 (1.0~5.0)',
    content TEXT NOT NULL COMMENT '리뷰 내용',
    photos JSON NULL COMMENT '사진 URL 목록',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '작성일시',
    updated_date DATETIME NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '수정일시',
    like_count INT NOT NULL DEFAULT 0 COMMENT '좋아요 수',
    status ENUM('ACTIVE', 'HIDDEN', 'DELETED') NOT NULL DEFAULT 'ACTIVE' COMMENT '상태',
    
    PRIMARY KEY (review_id),
    UNIQUE KEY uk_review_member_book (member_id, book_id),
    KEY idx_review_book (book_id),
    KEY idx_review_member (member_id),
    KEY idx_review_created (created_date DESC),
    KEY idx_review_rating (rating DESC),
    KEY idx_review_like (like_count DESC),
    KEY idx_review_status (status),
    
    CONSTRAINT chk_review_rating CHECK (rating >= 1.0 AND rating <= 5.0),
    CONSTRAINT chk_review_like_count CHECK (like_count >= 0),
    
    CONSTRAINT fk_review_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_review_book FOREIGN KEY (book_id)
        REFERENCES book(book_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_review_order FOREIGN KEY (order_id)
        REFERENCES orders(order_id) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='리뷰';
```

---

#### 4.5.2 review_like (리뷰 좋아요)

```sql
CREATE TABLE review_like (
    review_like_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '리뷰 좋아요 ID',
    review_id BIGINT NOT NULL COMMENT '리뷰 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '좋아요 누른 날짜',
    
    PRIMARY KEY (review_like_id),
    UNIQUE KEY uk_review_like (review_id, member_id),
    KEY idx_review_like_review (review_id),
    KEY idx_review_like_member (member_id),
    
    CONSTRAINT fk_review_like_review FOREIGN KEY (review_id)
        REFERENCES review(review_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_review_like_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='리뷰 좋아요';
```

---

#### 4.5.3 book_club (독서 모임)

```sql
CREATE TABLE book_club (
    club_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '모임 ID',
    title VARCHAR(100) NOT NULL COMMENT '모임명',
    book_id BIGINT NOT NULL COMMENT '대상 도서 ID',
    creator_id BIGINT NOT NULL COMMENT '생성자 ID',
    description TEXT NULL COMMENT '모임 소개',
    start_date DATE NOT NULL COMMENT '시작일',
    end_date DATE NOT NULL COMMENT '종료일',
    max_members INT NOT NULL COMMENT '최대 인원',
    current_members INT NOT NULL DEFAULT 1 COMMENT '현재 인원',
    status ENUM('RECRUITING', 'IN_PROGRESS', 'COMPLETED', 'CANCELLED') NOT NULL DEFAULT 'RECRUITING' COMMENT '상태',
    
    PRIMARY KEY (club_id),
    KEY idx_book_club_book (book_id),
    KEY idx_book_club_status (status),
    KEY idx_book_club_status_date (status, start_date),
    
    CONSTRAINT chk_book_club_max_members CHECK (max_members > 0),
    CONSTRAINT chk_book_club_current_members CHECK (current_members >= 0),
    
    CONSTRAINT fk_book_club_book FOREIGN KEY (book_id)
        REFERENCES book(book_id) ON DELETE RESTRICT ON UPDATE CASCADE,
    CONSTRAINT fk_book_club_creator FOREIGN KEY (creator_id)
        REFERENCES member(member_id) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='독서 모임';
```

---

#### 4.5.4 club_member (모임 멤버)

```sql
CREATE TABLE club_member (
    club_member_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '모임 멤버 ID',
    club_id BIGINT NOT NULL COMMENT '모임 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    joined_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '가입일시',
    role ENUM('LEADER', 'MEMBER') NOT NULL DEFAULT 'MEMBER' COMMENT '역할',
    status ENUM('ACTIVE', 'WITHDRAWN') NOT NULL DEFAULT 'ACTIVE' COMMENT '상태',
    
    PRIMARY KEY (club_member_id),
    UNIQUE KEY uk_club_member (club_id, member_id),
    KEY idx_club_member_club (club_id),
    KEY idx_club_member_member (member_id),
    
    CONSTRAINT fk_club_member_club FOREIGN KEY (club_id)
        REFERENCES book_club(club_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_club_member_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='모임 멤버';
```

---

#### 4.5.5 achievement (업적)

```sql
CREATE TABLE achievement (
    achievement_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '업적 ID',
    type ENUM('BADGE', 'TITLE') NOT NULL COMMENT '유형',
    name VARCHAR(50) NOT NULL COMMENT '업적명',
    description VARCHAR(200) NOT NULL COMMENT '설명',
    `condition` JSON NOT NULL COMMENT '달성 조건',
    icon VARCHAR(500) NULL COMMENT '아이콘 이미지 URL',
    reward_rxp INT NOT NULL DEFAULT 0 COMMENT '보상 RXP',
    reward_item JSON NULL COMMENT '보상 아이템',
    
    PRIMARY KEY (achievement_id),
    UNIQUE KEY uk_achievement_name (name),
    KEY idx_achievement_type (type),
    
    CONSTRAINT chk_achievement_reward_rxp CHECK (reward_rxp >= 0)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='업적';
```

---

#### 4.5.6 user_achievement (사용자 획득 업적)

```sql
CREATE TABLE user_achievement (
    user_achievement_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '사용자 업적 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    achievement_id BIGINT NOT NULL COMMENT '업적 ID',
    acquired_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '획득일시',
    is_displayed BOOLEAN NOT NULL DEFAULT FALSE COMMENT '프로필 표시 여부',
    
    PRIMARY KEY (user_achievement_id),
    UNIQUE KEY uk_user_achievement (member_id, achievement_id),
    KEY idx_user_achievement_member (member_id),
    KEY idx_user_achievement_achievement (achievement_id),
    
    CONSTRAINT fk_user_achievement_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_user_achievement_achievement FOREIGN KEY (achievement_id)
        REFERENCES achievement(achievement_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='사용자 획득 업적';
```

---

#### 4.5.7 bookshelf (가상 서재)

```sql
CREATE TABLE bookshelf (
    bookshelf_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '서재 ID',
    member_id BIGINT NOT NULL COMMENT '회원 ID',
    theme VARCHAR(50) NULL DEFAULT 'DEFAULT' COMMENT '테마',
    background VARCHAR(500) NULL COMMENT '배경 이미지 URL',
    is_public BOOLEAN NOT NULL DEFAULT TRUE COMMENT '공개 여부',
    visit_count INT NOT NULL DEFAULT 0 COMMENT '방문자 수',
    like_count INT NOT NULL DEFAULT 0 COMMENT '좋아요 수',
    
    PRIMARY KEY (bookshelf_id),
    UNIQUE KEY uk_bookshelf_member (member_id),
    
    CONSTRAINT chk_bookshelf_visit_count CHECK (visit_count >= 0),
    CONSTRAINT chk_bookshelf_like_count CHECK (like_count >= 0),
    
    CONSTRAINT fk_bookshelf_member FOREIGN KEY (member_id)
        REFERENCES member(member_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='가상 서재';
```

---

#### 4.5.8 bookshelf_item (서재 아이템)

```sql
CREATE TABLE bookshelf_item (
    item_id BIGINT NOT NULL AUTO_INCREMENT COMMENT '아이템 ID',
    bookshelf_id BIGINT NOT NULL COMMENT '서재 ID',
    item_type ENUM('BOOK', 'FURNITURE', 'DECORATION', 'BACKGROUND') NOT NULL COMMENT '아이템 유형',
    item_code VARCHAR(100) NOT NULL COMMENT '아이템 코드',
    position_x INT NOT NULL DEFAULT 0 COMMENT 'X 좌표',
    position_y INT NOT NULL DEFAULT 0 COMMENT 'Y 좌표',
    rotation INT NOT NULL DEFAULT 0 COMMENT '회전 각도',
    scale DECIMAL(3,2) NOT NULL DEFAULT 1.00 COMMENT '크기 배율',
    
    PRIMARY KEY (item_id),
    KEY idx_bookshelf_item_bookshelf (bookshelf_id),
    
    CONSTRAINT chk_bookshelf_item_rotation CHECK (rotation >= 0 AND rotation <= 360),
    CONSTRAINT chk_bookshelf_item_scale CHECK (scale > 0),
    
    CONSTRAINT fk_bookshelf_item_bookshelf FOREIGN KEY (bookshelf_id)
        REFERENCES bookshelf(bookshelf_id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='서재 아이템';
```

---

## 5. 인덱스 생성 스크립트

인덱스는 테이블 생성 시 함께 정의되었으나, 추가 최적화가 필요한 경우 아래 스크립트를 사용할 수 있습니다.

### 5.1 복합 인덱스 추가 (선택적)

```sql
-- 회원별 최근 주문 조회 최적화
CREATE INDEX idx_order_member_date_status 
ON orders(member_id, order_date DESC, status);

-- 도서별 활성 리뷰 조회 최적화
CREATE INDEX idx_review_book_status_created 
ON review(book_id, status, created_date DESC);

-- 카테고리별 판매 중인 도서 조회 최적화
CREATE INDEX idx_book_category_status 
ON book_category(category_id, book_id) 
WHERE status = 'AVAILABLE'; -- 부분 인덱스 (MySQL 8.0.13+)
```

---

### 5.2 전문 검색 인덱스 최적화

```sql
-- 도서 검색 최적화 (이미 생성됨, 참고용)
-- ALTER TABLE book ADD FULLTEXT INDEX ft_book_search (title, description);

-- 전문 검색 쿼리 예시
-- SELECT * FROM book 
-- WHERE MATCH(title, description) AGAINST('해리포터' IN NATURAL LANGUAGE MODE);
```

---

## 6. 제약조건 추가 스크립트

제약조건도 테이블 생성 시 정의되었으나, 추가 비즈니스 규칙이 필요한 경우 아래 스크립트를 사용합니다.

### 6.1 추가 체크 제약조건

```sql
-- 주문 금액 검증: final_price = total_product_price + shipping_fee - discount_amount - point_used
-- (복잡한 계산식은 트리거나 애플리케이션 레벨에서 처리 권장)

-- 쿠폰 발행 수량 검증
ALTER TABLE coupon 
ADD CONSTRAINT chk_coupon_issued_quantity_limit 
CHECK (total_quantity IS NULL OR issued_quantity <= total_quantity);

-- 독서 모임 현재 인원 검증
ALTER TABLE book_club 
ADD CONSTRAINT chk_book_club_current_members_limit 
CHECK (current_members <= max_members);
```

---

## 7. 트리거 및 프로시저

### 7.1 트리거 (Trigger)

#### 7.1.1 리뷰 작성 시 도서 통계 업데이트

```sql
DELIMITER $$

CREATE TRIGGER trg_review_after_insert
AFTER INSERT ON review
FOR EACH ROW
BEGIN
    -- 리뷰 수 증가 및 평균 평점 갱신
    UPDATE book
    SET review_count = review_count + 1,
        rating_avg = (
            SELECT AVG(rating) 
            FROM review 
            WHERE book_id = NEW.book_id AND status = 'ACTIVE'
        )
    WHERE book_id = NEW.book_id;
    
    -- 회원 RXP 증가
    UPDATE member
    SET rxp = rxp + 100
    WHERE member_id = NEW.member_id;
END$$

DELIMITER ;
```

---

#### 7.1.2 리뷰 삭제 시 도서 통계 업데이트

```sql
DELIMITER $$

CREATE TRIGGER trg_review_after_delete
AFTER DELETE ON review
FOR EACH ROW
BEGIN
    UPDATE book
    SET review_count = GREATEST(review_count - 1, 0),
        rating_avg = (
            SELECT AVG(rating) 
            FROM review 
            WHERE book_id = OLD.book_id AND status = 'ACTIVE'
        )
    WHERE book_id = OLD.book_id;
END$$

DELIMITER ;
```

---

#### 7.1.3 리뷰 좋아요 추가 시 리뷰 좋아요 수 증가

```sql
DELIMITER $$

CREATE TRIGGER trg_review_like_after_insert
AFTER INSERT ON review_like
FOR EACH ROW
BEGIN
    UPDATE review
    SET like_count = like_count + 1
    WHERE review_id = NEW.review_id;
END$$

DELIMITER ;
```

---

#### 7.1.4 리뷰 좋아요 삭제 시 리뷰 좋아요 수 감소

```sql
DELIMITER $$

CREATE TRIGGER trg_review_like_after_delete
AFTER DELETE ON review_like
FOR EACH ROW
BEGIN
    UPDATE review
    SET like_count = GREATEST(like_count - 1, 0)
    WHERE review_id = OLD.review_id;
END$$

DELIMITER ;
```

---

#### 7.1.5 주문 완료 시 도서 판매 수량 증가 및 재고 감소

```sql
DELIMITER $$

CREATE TRIGGER trg_order_after_update
AFTER UPDATE ON orders
FOR EACH ROW
BEGIN
    -- 결제 완료 시 재고 감소 및 판매 수량 증가
    IF NEW.status = 'PAYMENT_COMPLETED' AND OLD.status != 'PAYMENT_COMPLETED' THEN
        -- 주문 항목별 처리
        UPDATE book b
        INNER JOIN order_item oi ON b.book_id = oi.book_id
        SET b.stock = GREATEST(b.stock - oi.quantity, 0),
            b.sales_count = b.sales_count + oi.quantity,
            b.status = CASE 
                WHEN b.stock - oi.quantity <= 0 THEN 'OUT_OF_STOCK' 
                ELSE b.status 
            END
        WHERE oi.order_id = NEW.order_id;
    END IF;
    
    -- 주문 취소 시 재고 복구
    IF NEW.status = 'CANCELLED' AND OLD.status != 'CANCELLED' THEN
        UPDATE book b
        INNER JOIN order_item oi ON b.book_id = oi.book_id
        SET b.stock = b.stock + oi.quantity,
            b.sales_count = GREATEST(b.sales_count - oi.quantity, 0),
            b.status = 'AVAILABLE'
        WHERE oi.order_id = NEW.order_id;
    END IF;
END$$

DELIMITER ;
```

---

#### 7.1.6 포인트 변동 시 회원 포인트 잔액 갱신

```sql
DELIMITER $$

CREATE TRIGGER trg_point_history_after_insert
AFTER INSERT ON point_history
FOR EACH ROW
BEGIN
    UPDATE member
    SET point = NEW.balance
    WHERE member_id = NEW.member_id;
END$$

DELIMITER ;
```

---

### 7.2 스토어드 프로시저 (Stored Procedure)

#### 7.2.1 회원 가입 프로시저

```sql
DELIMITER $$

CREATE PROCEDURE sp_register_member(
    IN p_email VARCHAR(100),
    IN p_password VARCHAR(255),
    IN p_name VARCHAR(50),
    IN p_nickname VARCHAR(20),
    IN p_phone VARCHAR(20),
    OUT p_member_id BIGINT
)
BEGIN
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '회원 가입 실패';
    END;
    
    START TRANSACTION;
    
    -- 회원 정보 삽입
    INSERT INTO member (email, password, name, nickname, phone)
    VALUES (p_email, p_password, p_name, p_nickname, p_phone);
    
    SET p_member_id = LAST_INSERT_ID();
    
    -- 기본 권한 부여
    INSERT INTO authority (member_id, role)
    VALUES (p_member_id, 'ROLE_MEMBER');
    
    -- 장바구니 생성
    INSERT INTO cart (member_id)
    VALUES (p_member_id);
    
    -- 서재 생성
    INSERT INTO bookshelf (member_id)
    VALUES (p_member_id);
    
    -- 웰컴 포인트 지급
    INSERT INTO point_history (member_id, type, amount, reason, balance, expires_date)
    VALUES (p_member_id, 'EARN', 1000, '회원 가입 축하', 1000, DATE_ADD(CURDATE(), INTERVAL 1 YEAR));
    
    COMMIT;
END$$

DELIMITER ;
```

**사용 예시**:
```sql
CALL sp_register_member(
    'user@example.com', 
    '$2a$10$...', -- BCrypt 해시
    '홍길동', 
    'hong123', 
    '010-1234-5678', 
    @new_member_id
);

SELECT @new_member_id;
```

---

#### 7.2.2 주문 생성 프로시저

```sql
DELIMITER $$

CREATE PROCEDURE sp_create_order(
    IN p_member_id BIGINT,
    IN p_cart_id BIGINT,
    IN p_recipient VARCHAR(50),
    IN p_postal_code VARCHAR(10),
    IN p_address VARCHAR(200),
    IN p_detail_address VARCHAR(100),
    IN p_phone VARCHAR(20),
    IN p_delivery_request VARCHAR(200),
    IN p_coupon_id BIGINT,
    IN p_point_used INT,
    OUT p_order_id BIGINT,
    OUT p_order_number VARCHAR(20)
)
BEGIN
    DECLARE v_total_product_price DECIMAL(10,2);
    DECLARE v_shipping_fee DECIMAL(10,2);
    DECLARE v_discount_amount DECIMAL(10,2) DEFAULT 0.00;
    DECLARE v_final_price DECIMAL(10,2);
    
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '주문 생성 실패';
    END;
    
    START TRANSACTION;
    
    -- 장바구니 총액 계산
    SELECT SUM(b.final_price * ci.quantity)
    INTO v_total_product_price
    FROM cart_item ci
    INNER JOIN book b ON ci.book_id = b.book_id
    WHERE ci.cart_id = p_cart_id;
    
    -- 배송비 계산
    IF v_total_product_price >= 30000 THEN
        SET v_shipping_fee = 0;
    ELSE
        SET v_shipping_fee = 3000;
    END IF;
    
    -- 쿠폰 할인 계산 (간단 버전)
    IF p_coupon_id IS NOT NULL THEN
        SELECT 
            CASE 
                WHEN c.type = 'FIXED' THEN c.discount_value
                WHEN c.type = 'PERCENT' THEN LEAST(v_total_product_price * c.discount_value / 100, IFNULL(c.max_discount_amount, 999999))
                WHEN c.type = 'FREE_SHIPPING' THEN v_shipping_fee
                ELSE 0
            END
        INTO v_discount_amount
        FROM coupon c
        WHERE c.coupon_id = p_coupon_id;
    END IF;
    
    -- 최종 금액 계산
    SET v_final_price = v_total_product_price + v_shipping_fee - v_discount_amount - p_point_used;
    
    -- 주문번호 생성
    SET p_order_number = CONCAT('ORD', DATE_FORMAT(NOW(), '%Y%m%d%H%i%s'));
    
    -- 주문 생성
    INSERT INTO orders (
        order_number, member_id, total_product_price, shipping_fee, 
        discount_amount, point_used, final_price,
        recipient, postal_code, address, detail_address, phone, delivery_request
    ) VALUES (
        p_order_number, p_member_id, v_total_product_price, v_shipping_fee,
        v_discount_amount, p_point_used, v_final_price,
        p_recipient, p_postal_code, p_address, p_detail_address, p_phone, p_delivery_request
    );
    
    SET p_order_id = LAST_INSERT_ID();
    
    -- 주문 항목 생성
    INSERT INTO order_item (order_id, book_id, quantity, price, discount_rate, subtotal)
    SELECT 
        p_order_id,
        ci.book_id,
        ci.quantity,
        b.price,
        b.discount_rate,
        b.final_price * ci.quantity
    FROM cart_item ci
    INNER JOIN book b ON ci.book_id = b.book_id
    WHERE ci.cart_id = p_cart_id;
    
    -- 배송 정보 생성
    INSERT INTO shipment (order_id)
    VALUES (p_order_id);
    
    -- 장바구니 비우기
    DELETE FROM cart_item WHERE cart_id = p_cart_id;
    
    -- 쿠폰 사용 처리
    IF p_coupon_id IS NOT NULL THEN
        UPDATE user_coupon
        SET status = 'USED', used_date = NOW(), order_id = p_order_id
        WHERE coupon_id = p_coupon_id AND member_id = p_member_id AND status = 'AVAILABLE'
        LIMIT 1;
    END IF;
    
    -- 포인트 사용 처리
    IF p_point_used > 0 THEN
        INSERT INTO point_history (member_id, type, amount, reason, order_id, balance)
        SELECT p_member_id, 'USE', -p_point_used, '주문 시 포인트 사용', p_order_id, m.point - p_point_used
        FROM member m
        WHERE m.member_id = p_member_id;
    END IF;
    
    COMMIT;
END$$

DELIMITER ;
```

---

## 8. 초기 데이터 삽입

### 8.1 카테고리 초기 데이터

```sql
-- 대분류 (depth=1)
INSERT INTO category (name, parent_category_id, depth, display_order) VALUES
('소설', NULL, 1, 1),
('인문', NULL, 1, 2),
('경제경영', NULL, 1, 3),
('자기계발', NULL, 1, 4),
('IT/프로그래밍', NULL, 1, 5),
('과학', NULL, 1, 6),
('예술/대중문화', NULL, 1, 7),
('여행', NULL, 1, 8),
('취미/실용', NULL, 1, 9),
('아동/청소년', NULL, 1, 10);

-- 중분류 (depth=2) - 소설 하위
INSERT INTO category (name, parent_category_id, depth, display_order) VALUES
('한국소설', 1, 2, 1),
('외국소설', 1, 2, 2),
('SF/판타지', 1, 2, 3),
('추리/스릴러', 1, 2, 4),
('로맨스', 1, 2, 5);

-- 소분류 (depth=3) - 외국소설 하위
INSERT INTO category (name, parent_category_id, depth, display_order) VALUES
('영미소설', 12, 3, 1),
('일본소설', 12, 3, 2),
('프랑스소설', 12, 3, 3),
('독일소설', 12, 3, 4);

-- 중분류 (depth=2) - IT/프로그래밍 하위
INSERT INTO category (name, parent_category_id, depth, display_order) VALUES
('프로그래밍 언어', 5, 2, 1),
('웹 개발', 5, 2, 2),
('데이터베이스', 5, 2, 3),
('알고리즘/자료구조', 5, 2, 4),
('AI/머신러닝', 5, 2, 5);
```

---

### 8.2 저자 및 출판사 샘플 데이터

```sql
-- 저자
INSERT INTO author (name, bio, nationality) VALUES
('J.K. 롤링', '해리포터 시리즈 작가', '영국'),
('무라카미 하루키', '일본 현대 문학의 거장', '일본'),
('김영하', '한국의 대표 소설가', '한국'),
('조지 오웰', '1984, 동물농장 작가', '영국'),
('마틴 클레프만', '데이터 중심 애플리케이션 설계 저자', '영국');

-- 출판사
INSERT INTO publisher (name, website) VALUES
('문학동네', 'http://www.munhak.com'),
('민음사', 'http://www.minumsa.com'),
('위즈덤하우스', 'http://www.wisdomhouse.co.kr'),
('한빛미디어', 'http://www.hanbit.co.kr'),
('인사이트', 'http://www.insightbook.co.kr');
```

---

### 8.3 도서 샘플 데이터

```sql
INSERT INTO book (
    isbn, title, author_id, publisher_id, publish_date, pages, 
    price, discount_rate, final_price, cover_image, description, stock
) VALUES
('9788932917245', '해리포터와 마법사의 돌', 1, 1, '1999-06-26', 392, 
 15000, 10, 13500, '/images/harry-potter-1.jpg', 
 '영국의 평범한 소년 해리포터가 마법 세계로 들어가며 시작되는 모험 이야기', 50),
 
('9788937460883', '노르웨이의 숲', 2, 2, '1989-07-04', 456,
 14000, 10, 12600, '/images/norwegian-wood.jpg',
 '상실의 시대를 살아가는 젊은이들의 사랑과 방황', 30),
 
('9788954682084', '살인자의 기억법', 3, 1, '2013-07-16', 252,
 13000, 10, 11700, '/images/memory-of-murderer.jpg',
 '알츠하이머에 걸린 전직 연쇄살인마의 기억', 40),
 
('9788937462795', '1984', 4, 2, '1949-06-08', 408,
 12000, 15, 10200, '/images/1984.jpg',
 '전체주의 디스토피아를 그린 고전', 60),
 
('9788966262335', '데이터 중심 애플리케이션 설계', 5, 5, '2018-04-09', 680,
 36000, 0, 36000, '/images/designing-data-intensive.jpg',
 '신뢰할 수 있고 확장 가능하며 유지보수하기 쉬운 시스템을 지탱하는 핵심 아이디어', 20);

-- 도서-카테고리 연결
INSERT INTO book_category (book_id, category_id, is_main) VALUES
(1, 13, TRUE),  -- 해리포터 - 외국소설
(1, 3, FALSE),  -- 해리포터 - SF/판타지
(2, 12, TRUE),  -- 노르웨이의 숲 - 일본소설
(3, 11, TRUE),  -- 살인자의 기억법 - 한국소설
(3, 4, FALSE),  -- 살인자의 기억법 - 추리/스릴러
(4, 12, TRUE),  -- 1984 - 외국소설
(4, 3, FALSE),  -- 1984 - SF/판타지
(5, 5, TRUE),   -- 데이터 중심 애플리케이션 설계 - IT/프로그래밍
(5, 23, FALSE); -- 데이터 중심 애플리케이션 설계 - 데이터베이스
```

---

### 8.4 업적 초기 데이터

```sql
INSERT INTO achievement (type, name, description, `condition`, reward_rxp) VALUES
('BADGE', '첫 발걸음', '첫 번째 도서 구매', '{"purchase_count": 1}', 100),
('BADGE', '책벌레', '도서 10권 구매', '{"purchase_count": 10}', 500),
('BADGE', '독서광', '도서 50권 구매', '{"purchase_count": 50}', 2000),
('TITLE', '베스트 리뷰어', '리뷰 10개 이상 작성', '{"review_count": 10}', 300),
('TITLE', '사진 작가', '사진 포함 리뷰 5개 이상', '{"photo_review_count": 5}', 200),
('TITLE', '토론의 달인', '독서 모임 10회 이상 참여', '{"club_participation": 10}', 500),
('BADGE', '백만 원의 독서', '누적 구매 금액 100만 원', '{"total_purchase_amount": 1000000}', 1000);
```

---

### 8.5 관리자 계정 생성

```sql
-- 관리자 계정 (비밀번호: admin123! - BCrypt 해시 예시)
INSERT INTO member (email, password, name, nickname, phone, level, status)
VALUES ('admin@luminari.com', '$2a$10$N.zmdr9A1y8oB0kqNSxLHu7TJpPJXDIjuVIpZ9rJYGb3J1eqK3H8q', 
        '관리자', 'admin', '010-0000-0000', 99, 'ACTIVE');

SET @admin_id = LAST_INSERT_ID();

-- 관리자 권한 부여
INSERT INTO authority (member_id, role) VALUES 
(@admin_id, 'ROLE_MEMBER'),
(@admin_id, 'ROLE_ADMIN');

-- 관리자 장바구니 및 서재 생성
INSERT INTO cart (member_id) VALUES (@admin_id);
INSERT INTO bookshelf (member_id) VALUES (@admin_id);
```

---

## 9. 데이터베이스 검증

### 9.1 테이블 생성 확인

```sql
-- 모든 테이블 목록 조회
SHOW TABLES;

-- 테이블 구조 확인 (예: member)
DESCRIBE member;

-- 테이블 생성 DDL 확인
SHOW CREATE TABLE member;
```

---

### 9.2 인덱스 확인

```sql
-- 특정 테이블의 인덱스 조회
SHOW INDEX FROM book;

-- 모든 테이블의 인덱스 조회
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    COLUMN_NAME,
    SEQ_IN_INDEX,
    NON_UNIQUE
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = 'luminari_bookstore'
ORDER BY TABLE_NAME, INDEX_NAME, SEQ_IN_INDEX;
```

---

### 9.3 외래키 제약조건 확인

```sql
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    CONSTRAINT_NAME,
    REFERENCED_TABLE_NAME,
    REFERENCED_COLUMN_NAME
FROM information_schema.KEY_COLUMN_USAGE
WHERE TABLE_SCHEMA = 'luminari_bookstore'
  AND REFERENCED_TABLE_NAME IS NOT NULL
ORDER BY TABLE_NAME, COLUMN_NAME;
```

---

### 9.4 트리거 확인

```sql
SHOW TRIGGERS FROM luminari_bookstore;

-- 특정 트리거 상세 정보
SHOW CREATE TRIGGER trg_review_after_insert;
```

---

### 9.5 스토어드 프로시저 확인

```sql
SHOW PROCEDURE STATUS WHERE Db = 'luminari_bookstore';

-- 특정 프로시저 상세 정보
SHOW CREATE PROCEDURE sp_register_member;
```

---

### 9.6 데이터 무결성 테스트

```sql
-- 1. UNIQUE 제약 테스트
-- (중복 이메일 삽입 시도 - 실패해야 함)
INSERT INTO member (email, password, name, nickname, phone)
VALUES ('admin@luminari.com', 'test', 'test', 'test123', '010-1111-1111');
-- Error: Duplicate entry

-- 2. CHECK 제약 테스트
-- (잘못된 레벨 삽입 시도 - 실패해야 함)
INSERT INTO member (email, password, name, nickname, phone, level)
VALUES ('test@test.com', 'test', 'test', 'test456', '010-2222-2222', 0);
-- Error: Check constraint violated

-- 3. 외래키 제약 테스트
-- (존재하지 않는 member_id 참조 - 실패해야 함)
INSERT INTO address (member_id, recipient, postal_code, address, phone)
VALUES (999999, 'test', '12345', 'test address', '010-3333-3333');
-- Error: Cannot add or update a child row
```

---

## 10. 백업 및 복구 전략

### 10.1 전체 데이터베이스 백업

```bash
# 명령행에서 실행
mysqldump -u luminari_user -p --databases luminari_bookstore \
    --routines --triggers --events \
    --single-transaction \
    --quick \
    --lock-tables=false \
    > luminari_backup_$(date +%Y%m%d_%H%M%S).sql
```

---

### 10.2 테이블별 백업

```bash
# 특정 테이블만 백업
mysqldump -u luminari_user -p luminari_bookstore member orders order_item \
    > member_orders_backup_$(date +%Y%m%d).sql
```

---

### 10.3 데이터베이스 복구

```bash
# 백업 파일로부터 복구
mysql -u luminari_user -p luminari_bookstore < luminari_backup_20250119_120000.sql
```

---

### 10.4 자동 백업 스크립트 (Linux Cron)

```bash
# 백업 스크립트 작성 (backup_db.sh)
#!/bin/bash
BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="luminari_bookstore"
DB_USER="luminari_user"
DB_PASS="strong_password_123!"

mkdir -p $BACKUP_DIR

mysqldump -u $DB_USER -p$DB_PASS --databases $DB_NAME \
    --routines --triggers --events \
    --single-transaction \
    --quick \
    --lock-tables=false \
    | gzip > $BACKUP_DIR/${DB_NAME}_${DATE}.sql.gz

# 7일 이상 된 백업 파일 삭제
find $BACKUP_DIR -name "${DB_NAME}_*.sql.gz" -mtime +7 -delete

# Cron 등록 (매일 새벽 3시)
# crontab -e
# 0 3 * * * /path/to/backup_db.sh
```

---

## 11. 성능 튜닝

### 11.1 슬로우 쿼리 분석

```sql
-- 슬로우 쿼리 로그 활성화 확인
SHOW VARIABLES LIKE 'slow_query%';
SHOW VARIABLES LIKE 'long_query_time';

-- 슬로우 쿼리 로그 확인 (MySQL 로그 파일)
-- Linux: /var/log/mysql/slow.log
-- Windows: C:\ProgramData\MySQL\MySQL Server 8.0\Data\slow.log
```

---

### 11.2 쿼리 실행 계획 분석

```sql
-- EXPLAIN을 사용한 쿼리 분석
EXPLAIN SELECT 
    b.book_id, b.title, b.price, b.cover_image, a.name AS author_name
FROM book b
INNER JOIN author a ON b.author_id = a.author_id
WHERE b.status = 'AVAILABLE'
ORDER BY b.sales_count DESC
LIMIT 20;

-- EXPLAIN ANALYZE (MySQL 8.0.18+)
EXPLAIN ANALYZE
SELECT * FROM review
WHERE book_id = 1 AND status = 'ACTIVE'
ORDER BY created_date DESC;
```

---

### 11.3 인덱스 사용률 확인

```sql
-- 인덱스 통계 조회
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    SEQ_IN_INDEX,
    COLUMN_NAME,
    CARDINALITY
FROM information_schema.STATISTICS
WHERE TABLE_SCHEMA = 'luminari_bookstore'
  AND TABLE_NAME = 'book'
ORDER BY TABLE_NAME, INDEX_NAME, SEQ_IN_INDEX;
```

---

### 11.4 InnoDB 버퍼 풀 모니터링

```sql
-- InnoDB 버퍼 풀 상태 확인
SHOW ENGINE INNODB STATUS;

-- InnoDB 버퍼 풀 사용률
SELECT 
    (SELECT SUM(data_length + index_length) FROM information_schema.TABLES 
     WHERE TABLE_SCHEMA = 'luminari_bookstore') / 1024 / 1024 AS total_size_mb,
    @@innodb_buffer_pool_size / 1024 / 1024 AS buffer_pool_size_mb;
```

---

## 12. 배포 가이드

### 12.1 배포 체크리스트

- [ ] MySQL 8.0 설치 및 설정 완료
- [ ] 데이터베이스 생성 완료
- [ ] 모든 테이블 생성 완료 (28개)
- [ ] 인덱스 생성 완료
- [ ] 외래키 제약조건 적용 완료
- [ ] 트리거 생성 완료
- [ ] 스토어드 프로시저 생성 완료
- [ ] 초기 데이터 삽입 완료 (카테고리, 샘플 도서, 업적 등)
- [ ] 관리자 계정 생성 완료
- [ ] 데이터베이스 사용자 및 권한 설정 완료
- [ ] 백업 전략 수립 및 자동화 설정
- [ ] 슬로우 쿼리 로그 활성화
- [ ] 모니터링 도구 설정 (선택)

---

### 12.2 배포 스크립트 (전체 실행)

```bash
#!/bin/bash
# deploy_db.sh

DB_NAME="luminari_bookstore"
DB_USER="root"
DB_PASS="your_root_password"

echo "====== Luminari Bookstore DB 배포 시작 ======"

# 1. 데이터베이스 생성
echo "1. 데이터베이스 생성..."
mysql -u $DB_USER -p$DB_PASS < 01_create_database.sql

# 2. 테이블 생성
echo "2. 테이블 생성..."
mysql -u $DB_USER -p$DB_PASS $DB_NAME < 02_create_tables.sql

# 3. 트리거 생성
echo "3. 트리거 생성..."
mysql -u $DB_USER -p$DB_PASS $DB_NAME < 03_create_triggers.sql

# 4. 스토어드 프로시저 생성
echo "4. 스토어드 프로시저 생성..."
mysql -u $DB_USER -p$DB_PASS $DB_NAME < 04_create_procedures.sql

# 5. 초기 데이터 삽입
echo "5. 초기 데이터 삽입..."
mysql -u $DB_USER -p$DB_PASS $DB_NAME < 05_insert_initial_data.sql

# 6. 사용자 생성 및 권한 부여
echo "6. 사용자 및 권한 설정..."
mysql -u $DB_USER -p$DB_PASS < 06_create_users.sql

echo "====== 배포 완료 ======"
echo "데이터베이스: $DB_NAME"
echo "테이블 수: 28개"
```

---

### 12.3 롤백 스크립트

```sql
-- rollback.sql
-- 주의: 모든 데이터가 삭제됩니다!

DROP DATABASE IF EXISTS luminari_bookstore;

-- 사용자 삭제
DROP USER IF EXISTS 'luminari_user'@'localhost';
DROP USER IF EXISTS 'luminari_user'@'%';
DROP USER IF EXISTS 'luminari_readonly'@'localhost';
```

---

## 13. 결론

이 문서는 **Luminari Bookstore 프로젝트**의 **4단계 물리적 데이터 모델링**을 상세히 다루었습니다.

### 주요 성과:
1. **MySQL 8.0 환경 설정**: 최적의 설정값 제시
2. **DDL 스크립트**: 28개 테이블의 완전한 CREATE TABLE 문
3. **인덱스 설계**: 60개 이상의 인덱스 생성
4. **트리거 구현**: 6개의 자동화 트리거
5. **스토어드 프로시저**: 2개의 핵심 비즈니스 로직
6. **초기 데이터**: 카테고리, 저자, 출판사, 샘플 도서, 업적, 관리자 계정
7. **검증 스크립트**: 데이터베이스 무결성 확인
8. **백업 전략**: 자동 백업 스크립트
9. **성능 튜닝 가이드**: 슬로우 쿼리 분석 및 최적화
10. **배포 가이드**: 전체 배포 자동화 스크립트

### 핵심 성과물:
- ✅ 완전한 MySQL DDL 스크립트 (28개 테이블)
- ✅ 트리거 및 스토어드 프로시저
- ✅ 초기 데이터 삽입 스크립트
- ✅ 백업 및 복구 전략
- ✅ 성능 튜닝 가이드
- ✅ 배포 자동화 스크립트

이제 이 물리적 모델을 실제 MySQL 데이터베이스에 적용하고, Spring Boot 애플리케이션과 연동하여 온라인 서점 시스템을 구현할 수 있습니다.

---

**작성 정보**:
- **문서명**: 4단계: 물리적 데이터 모델링
- **프로젝트**: Luminari Bookstore
- **작성일**: 2025-11-19
- **버전**: 1.0
- **DBMS**: MySQL 8.0
- **이전 단계**: 3단계 - 논리적 데이터 모델링
- **다음 단계**: Spring Boot 애플리케이션 개발 (JPA/Hibernate 연동)
