# 1단계: 핵심 데이터 모델링 상세 가이드

이 문서는 '책(Book)' 데이터 모델을 생성하고, 이를 관리하기 위한 API를 만드는 과정을 상세하게 안내합니다. 아래 단계를 순서대로 따라 진행해주세요.

## 1. 패키지(디렉토리) 생성

먼저, 코드를 체계적으로 관리하기 위해 필요한 패키지(디렉토리)를 생성합니다.

*   `domain`: 데이터베이스 테이블과 매핑될 엔티티 클래스를 모아두는 곳입니다.
*   `repository`: 데이터베이스에 접근하는 인터페이스를 모아두는 곳입니다.
*   `controller`: 클라이언트의 요청을 처리하는 컨트롤러 클래스를 모아두는 곳입니다.

아래 명령어를 터미널에 입력하여 디렉토리를 생성하세요.

```bash
mkdir -p src/main/java/com/ezlevup/luminari/domain
mkdir -p src/main/java/com/ezlevup/luminari/repository
```
(`controller` 패키지는 이전에 이미 생성했습니다.)

## 2. `Book` 엔티티 생성

`domain` 패키지 안에 `Book.java` 파일을 생성하고 아래 코드를 작성합니다.

**경로**: `src/main/java/com/ezlevup/luminari/domain/Book.java`

```java
package com.ezlevup.luminari.domain;

import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import lombok.Getter;
import lombok.Setter;

@Entity // 이 클래스가 데이터베이스 테이블과 매핑되는 엔티티임을 나타냅니다.
@Getter // Lombok: 모든 필드에 대한 getter 메소드를 자동으로 생성합니다.
@Setter // Lombok: 모든 필드에 대한 setter 메소드를 자동으로 생성합니다.
public class Book {

    @Id // 이 필드가 테이블의 기본 키(Primary Key)임을 나타냅니다.
    @GeneratedValue(strategy = GenerationType.IDENTITY) // 기본 키 값을 데이터베이스가 자동으로 생성하도록 합니다.
    private Long id;

    private String title;
    private String author;
    private double price;
}
```

## 3. `BookRepository` 생성

`repository` 패키지 안에 `BookRepository.java` 파일을 생성하고 아래 코드를 작성합니다.

**경로**: `src/main/java/com/ezlevup/luminari/repository/BookRepository.java`

```java
package com.ezlevup.luminari.repository;

import com.ezlevup.luminari.domain.Book;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

@Repository // 이 인터페이스가 데이터베이스와 통신하는 리포지토리임을 나타냅니다.
public interface BookRepository extends JpaRepository<Book, Long> {
    // JpaRepository를 상속받는 것만으로도 기본적인 CRUD(Save, Find, Delete 등) 메소드가 자동으로 제공됩니다.
}
```

## 4. `BookController` 생성

`controller` 패키지 안에 `BookController.java` 파일을 생성하고 아래 코드를 작성합니다.

**경로**: `src/main/java/com/ezlevup/luminari/controller/BookController.java`

```java
package com.ezlevup.luminari.controller;

import com.ezlevup.luminari.domain.Book;
import com.ezlevup.luminari.repository.BookRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;
import java.util.Optional;

@RestController
@RequestMapping("/api/books")
public class BookController {

    @Autowired // Spring이 BookRepository의 인스턴스를 자동으로 주입해줍니다.
    private BookRepository bookRepository;

    // 새 책 등록
    @PostMapping
    public Book createBook(@RequestBody Book book) {
        return bookRepository.save(book);
    }

    // 모든 책 조회
    @GetMapping
    public List<Book> getAllBooks() {
        return bookRepository.findAll();
    }

    // ID로 특정 책 조회
    @GetMapping("/{id}")
    public ResponseEntity<Book> getBookById(@PathVariable Long id) {
        Optional<Book> book = bookRepository.findById(id);
        return book.map(ResponseEntity::ok).orElseGet(() -> ResponseEntity.notFound().build());
    }

    // 책 정보 수정
    @PutMapping("/{id}")
    public ResponseEntity<Book> updateBook(@PathVariable Long id, @RequestBody Book bookDetails) {
        Optional<Book> optionalBook = bookRepository.findById(id);
        if (optionalBook.isPresent()) {
            Book book = optionalBook.get();
            book.setTitle(bookDetails.getTitle());
            book.setAuthor(bookDetails.getAuthor());
            book.setPrice(bookDetails.getPrice());
            return ResponseEntity.ok(bookRepository.save(book));
        } else {
            return ResponseEntity.notFound().build();
        }
    }

    // 책 삭제
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteBook(@PathVariable Long id) {
        if (bookRepository.existsById(id)) {
            bookRepository.deleteById(id);
            return ResponseEntity.noContent().build();
        } else {
            return ResponseEntity.notFound().build();
        }
    }
}
```

## 5. 실행 및 테스트

모든 파일을 작성했으면, 애플리케이션을 실행합니다.

```bash
./mvnw spring-boot:run
```

애플리케이션이 실행되면, 새 터미널을 열고 아래 `curl` 명령어를 사용하여 API를 테스트할 수 있습니다.

**1. 새 책 등록**
```bash
curl -X POST http://localhost:8080/api/books -H "Content-Type: application/json" -d "{\"title\":\"스프링 부트의 정석\", \"author\":\"남궁성\", \"price\":35000}"
```

**2. 모든 책 조회**
```bash
curl http://localhost:8080/api/books
```

**3. 특정 책 조회 (ID가 1인 책)**
```bash
curl http://localhost:8080/api/books/1
```

**4. 책 정보 수정 (ID가 1인 책)**
```bash
curl -X PUT http://localhost:8080/api/books/1 -H "Content-Type: application/json" -d "{\"title\":\"이것이 자바다\", \"author\":\"신용권\", \"price\":40000}"
```

**5. 책 삭제 (ID가 1인 책)**
```bash
curl -X DELETE http://localhost:8080/api/books/1
```

---

이 가이드에 따라 코드를 작성하고 테스트까지 완료하면, 서점 쇼핑몰의 가장 기본적인 백엔드 기능이 완성됩니다.
