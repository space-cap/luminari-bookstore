# 3단계: 논리적 데이터 모델링 (Logical Data Modeling)

## 목차
1. [논리적 데이터 모델링 개요](#1-논리적-데이터-모델링-개요)
2. [정규화 분석](#2-정규화-분석)
3. [테이블 설계](#3-테이블-설계)
4. [컬럼 정의](#4-컬럼-정의)
5. [키 설계](#5-키-설계)
6. [관계 및 외래키 설계](#6-관계-및-외래키-설계)
7. [제약조건 정의](#7-제약조건-정의)
8. [인덱스 전략](#8-인덱스-전략)
9. [논리적 ERD](#9-논리적-erd)
10. [테이블 명세서](#10-테이블-명세서)
11. [정규화 검증](#11-정규화-검증)
12. [성능 최적화 고려사항](#12-성능-최적화-고려사항)

---

## 1. 논리적 데이터 모델링 개요

### 1.1 논리적 데이터 모델링이란?

논리적 데이터 모델링은 **개념적 모델을 관계형 데이터베이스의 테이블 구조로 변환**하는 단계입니다. 이 단계에서는 정규화를 통해 데이터 중복을 최소화하고, 각 테이블의 구조를 상세히 정의합니다.

### 1.2 목표
- 개념적 모델을 관계형 스키마로 변환
- 정규화를 통한 데이터 무결성 보장
- 모든 속성의 데이터 타입 정의
- 제약조건 및 인덱스 전략 수립
- 논리적 ERD 완성

### 1.3 주요 활동
1. **엔티티 → 테이블 변환**
2. **속성 → 컬럼 변환**
3. **관계 → 외래키 변환**
4. **정규화 수행 (최소 3NF)**
5. **제약조건 정의**
6. **인덱스 설계**

### 1.4 산출물
- 논리적 ERD
- 테이블 명세서
- 컬럼 정의서
- 인덱스 설계서
- 제약조건 정의서

---

## 2. 정규화 분석

### 2.1 정규화 개요

**정규화(Normalization)**는 데이터 중복을 최소화하고 데이터 무결성을 보장하기 위해 테이블을 분해하는 과정입니다.

### 2.2 정규화 단계

#### 2.2.1 제1정규형 (1NF - First Normal Form)

**규칙**: 모든 속성은 **원자값(Atomic Value)**을 가져야 함. 즉, 다중값 속성이나 반복 그룹이 없어야 함.

**적용 사례**:

**❌ 1NF 위반 예시**:
```
Book 테이블
┌─────────┬───────────┬────────────────────┐
│ book_id │ title     │ categories         │
├─────────┼───────────┼────────────────────┤
│ 1       │ 해리포터  │ 소설, 판타지, 청소년│
└─────────┴───────────┴────────────────────┘
```

**✅ 1NF 충족**:
```
Book 테이블
┌─────────┬───────────┐
│ book_id │ title     │
├─────────┼───────────┤
│ 1       │ 해리포터  │
└─────────┴───────────┘

Book_Category 테이블
┌─────────┬─────────────┐
│ book_id │ category_id │
├─────────┼─────────────┤
│ 1       │ 1           │ (소설)
│ 1       │ 2           │ (판타지)
│ 1       │ 3           │ (청소년)
└─────────┴─────────────┘
```

**프로젝트 적용**:
- `Book.photos` → JSON 타입 사용 (원자값으로 간주)
- `Review.photos` → JSON 배열로 저장
- `Book - Category` 다대다 관계 → `Book_Category` 연결 테이블

---

#### 2.2.2 제2정규형 (2NF - Second Normal Form)

**규칙**: 1NF를 만족하고, **부분 함수 종속이 없어야 함**. 즉, 모든 비주요 속성은 기본키 전체에 완전 함수 종속되어야 함.

**적용 사례**:

**❌ 2NF 위반 예시**:
```
OrderItem 테이블 (복합키: order_id + book_id)
┌──────────┬─────────┬──────────┬────────────┬───────────┐
│ order_id │ book_id │ quantity │ book_title │ book_price│
├──────────┼─────────┼──────────┼────────────┼───────────┤
│ 1        │ 101     │ 2        │ 해리포터   │ 15000     │
└──────────┴─────────┴──────────┴────────────┴───────────┘
```
- `book_title`, `book_price`는 `book_id`에만 종속 (부분 함수 종속)

**✅ 2NF 충족**:
```
OrderItem 테이블
┌──────────┬─────────┬──────────┐
│ order_id │ book_id │ quantity │
├──────────┼─────────┼──────────┤
│ 1        │ 101     │ 2        │
└──────────┴─────────┴──────────┘

Book 테이블
┌─────────┬────────────┬───────────┐
│ book_id │ book_title │ book_price│
├─────────┼────────────┼───────────┤
│ 101     │ 해리포터   │ 15000     │
└─────────┴────────────┴───────────┘
```

**프로젝트 적용**:
- `OrderItem`은 `order_id`를 단일 PK로 사용하지 않고 `order_item_id`를 별도 PK로 사용
- 모든 비주요 속성은 PK에 완전 함수 종속

---

#### 2.2.3 제3정규형 (3NF - Third Normal Form)

**규칙**: 2NF를 만족하고, **이행 함수 종속이 없어야 함**. 즉, 비주요 속성은 기본키에만 종속되어야 하며, 다른 비주요 속성에 종속되지 않아야 함.

**적용 사례**:

**❌ 3NF 위반 예시**:
```
Book 테이블
┌─────────┬───────────┬─────────────┬────────────────┐
│ book_id │ title     │ publisher_id│ publisher_name │
├─────────┼───────────┼─────────────┼────────────────┤
│ 1       │ 해리포터  │ 1           │ 문학수첩       │
└─────────┴───────────┴─────────────┴────────────────┘
```
- `publisher_name`은 `publisher_id`에 종속 (이행 함수 종속: book_id → publisher_id → publisher_name)

**✅ 3NF 충족**:
```
Book 테이블
┌─────────┬───────────┬─────────────┐
│ book_id │ title     │ publisher_id│
├─────────┼───────────┼─────────────┤
│ 1       │ 해리포터  │ 1           │
└─────────┴───────────┴─────────────┘

Publisher 테이블
┌─────────────┬────────────────┐
│ publisher_id│ publisher_name │
├─────────────┼────────────────┤
│ 1           │ 문학수첩       │
└─────────────┴────────────────┘
```

**프로젝트 적용**:
- `Book` 테이블에서 `Author`, `Publisher` 분리
- `Member` 테이블에서 `Authority` 분리

---

#### 2.2.4 BCNF (Boyce-Codd Normal Form)

**규칙**: 3NF를 만족하고, **모든 결정자는 후보키**여야 함.

**프로젝트 적용**:
- 대부분의 테이블이 BCNF를 만족
- 복잡한 함수 종속성은 없음

---

### 2.3 역정규화 (Denormalization) 전략

성능 최적화를 위해 **의도적으로 중복을 허용**하는 역정규화를 일부 적용합니다.

#### 2.3.1 집계값 저장

**Case 1: Book 테이블**
- `rating_avg` (평균 평점): Review 테이블의 rating 평균
- `review_count` (리뷰 수): Review 테이블의 레코드 수
- **이유**: 도서 목록 조회 시 매번 집계하면 성능 저하

**Case 2: Member 테이블**
- `point` (보유 포인트): PointHistory 테이블의 balance 최신값
- `level`, `rxp` (레벨, 경험치): 게이미피케이션 정보
- **이유**: 회원 정보는 자주 조회되므로 별도 저장

**Case 3: Review 테이블**
- `like_count` (좋아요 수): ReviewLike 테이블의 레코드 수
- **이유**: 리뷰 목록 정렬 시 성능 향상

#### 2.3.2 중복 데이터 저장

**Case 1: OrderItem 테이블**
- `price`, `discount_rate` 저장
- **이유**: 주문 당시 가격 보존 (Book 테이블 가격 변동 영향 없음)

**Case 2: Order 테이블**
- 배송지 정보 (recipient, address 등) 저장
- **이유**: Address 테이블 변경/삭제 시에도 주문 내역 유지

---

### 2.4 정규화 결과 요약

| 테이블 | 정규화 수준 | 비고 |
|:------|:-----------|:-----|
| Member | 3NF | Authority 분리 |
| Address | 3NF | 정규화 충족 |
| Authority | 3NF | 정규화 충족 |
| Book | 3NF + 역정규화 | Author, Publisher 분리 / rating_avg, review_count 역정규화 |
| Author | 3NF | 정규화 충족 |
| Publisher | 3NF | 정규화 충족 |
| Category | 3NF | Self-referencing |
| Book_Category | 3NF | 연결 테이블 |
| Cart | 3NF | 정규화 충족 |
| CartItem | 3NF | 정규화 충족 |
| Order | 3NF + 역정규화 | 배송지 정보 중복 저장 |
| OrderItem | 3NF + 역정규화 | 가격 정보 중복 저장 |
| Payment | 3NF | 정규화 충족 |
| Shipment | 3NF | 정규화 충족 |
| Coupon | 3NF | 정규화 충족 |
| UserCoupon | 3NF | 연결 테이블 |
| PointHistory | 3NF | 트랜잭션 로그 |
| Review | 3NF + 역정규화 | like_count 역정규화 |
| ReviewLike | 3NF | 연결 테이블 |
| BookClub | 3NF | 정규화 충족 |
| ClubMember | 3NF | 연결 테이블 |
| Achievement | 3NF | 정규화 충족 |
| UserAchievement | 3NF | 연결 테이블 |
| Bookshelf | 3NF | 정규화 충족 |
| BookshelfItem | 3NF | 정규화 충족 |

---

## 3. 테이블 설계

### 3.1 테이블 명명 규칙

1. **단수형 명사 사용**: `Member`, `Book` (복수형 X)
2. **PascalCase 또는 snake_case**: 
   - PascalCase: `Member`, `OrderItem` (Java/JPA 엔티티명)
   - snake_case: `member`, `order_item` (실제 테이블명)
3. **연결 테이블**: `Entity1_Entity2` 형식
   - 예: `Book_Category`, `ReviewLike`
4. **명확하고 간결한 이름**

### 3.2 테이블 목록

#### 3.2.1 회원 도메인 (Member Domain)

| 테이블명 | 영문명 | 설명 | PK |
|:--------|:-------|:-----|:---|
| 회원 | member | 회원 정보 | member_id |
| 배송지 | address | 회원 배송지 | address_id |
| 권한 | authority | 회원 권한 | authority_id |

---

#### 3.2.2 상품 도메인 (Product Domain)

| 테이블명 | 영문명 | 설명 | PK |
|:--------|:-------|:-----|:---|
| 책 | book | 도서 정보 | book_id |
| 저자 | author | 저자 정보 | author_id |
| 출판사 | publisher | 출판사 정보 | publisher_id |
| 카테고리 | category | 도서 카테고리 | category_id |
| 책-카테고리 | book_category | 책과 카테고리 연결 | book_category_id |

---

#### 3.2.3 주문 도메인 (Order Domain)

| 테이블명 | 영문명 | 설명 | PK |
|:--------|:-------|:-----|:---|
| 장바구니 | cart | 회원 장바구니 | cart_id |
| 장바구니 항목 | cart_item | 장바구니 상품 | cart_item_id |
| 주문 | orders | 주문 마스터 | order_id |
| 주문 항목 | order_item | 주문 상품 상세 | order_item_id |
| 결제 | payment | 결제 정보 | payment_id |
| 배송 | shipment | 배송 정보 | shipment_id |

---

#### 3.2.4 프로모션 도메인 (Promotion Domain)

| 테이블명 | 영문명 | 설명 | PK |
|:--------|:-------|:-----|:---|
| 쿠폰 | coupon | 쿠폰 마스터 | coupon_id |
| 사용자 쿠폰 | user_coupon | 회원 보유 쿠폰 | user_coupon_id |
| 포인트 내역 | point_history | 포인트 트랜잭션 | point_history_id |

---

#### 3.2.5 커뮤니티 도메인 (Community Domain)

| 테이블명 | 영문명 | 설명 | PK |
|:--------|:-------|:-----|:---|
| 리뷰 | review | 도서 리뷰 | review_id |
| 리뷰 좋아요 | review_like | 리뷰 좋아요 | review_like_id |
| 독서 모임 | book_club | 독서 모임 | club_id |
| 모임 멤버 | club_member | 모임 참여 회원 | club_member_id |
| 업적 | achievement | 업적/배지/칭호 | achievement_id |
| 사용자 업적 | user_achievement | 회원 획득 업적 | user_achievement_id |
| 서재 | bookshelf | 가상 서재 | bookshelf_id |
| 서재 아이템 | bookshelf_item | 서재 아이템 | item_id |

---

## 4. 컬럼 정의

### 4.1 컬럼 명명 규칙

1. **소문자 snake_case 사용**: `member_id`, `created_date`
2. **명확하고 간결한 이름**
3. **약어 최소화**: `desc` (X) → `description` (O)
4. **외래키**: `참조테이블_id` 형식 (예: `member_id`, `book_id`)
5. **날짜/시간**: `~_date`, `~_datetime` 접미사
6. **상태**: `status` 컬럼 사용
7. **불린**: `is_~`, `has_~` 접두사

### 4.2 데이터 타입 정의 원칙

#### 4.2.1 정수형
- `TINYINT`: 1바이트, -128 ~ 127 (또는 0 ~ 255)
  - 용도: 작은 범위의 숫자 (예: 성별, 상태 코드)
- `SMALLINT`: 2바이트, -32,768 ~ 32,767
- `INT`: 4바이트, -2,147,483,648 ~ 2,147,483,647
  - 용도: 일반적인 정수 (수량, 레벨 등)
- `BIGINT`: 8바이트, 매우 큰 범위
  - 용도: ID(Primary Key), 큰 숫자

#### 4.2.2 실수형
- `DECIMAL(M, D)`: 고정 소수점
  - 용도: 금액, 가격 (예: `DECIMAL(10, 2)` - 최대 99,999,999.99)
  - **중요**: 금액은 반드시 DECIMAL 사용 (FLOAT/DOUBLE은 부정확)
- `FLOAT`, `DOUBLE`: 부동 소수점 (과학 계산용, 금액 사용 금지)

#### 4.2.3 문자형
- `CHAR(N)`: 고정 길이 (예: `CHAR(2)` - 국가 코드)
- `VARCHAR(N)`: 가변 길이
  - 일반 텍스트: `VARCHAR(50)`, `VARCHAR(100)`, `VARCHAR(255)`
  - 이메일: `VARCHAR(100)`
  - URL: `VARCHAR(500)`
- `TEXT`: 긴 텍스트 (최대 65,535자)
  - 용도: 본문, 설명 등
- `MEDIUMTEXT`: 중간 크기 텍스트 (최대 16MB)
- `LONGTEXT`: 큰 텍스트 (최대 4GB)

#### 4.2.4 날짜/시간형
- `DATE`: 날짜만 (YYYY-MM-DD)
  - 용도: 생년월일, 출간일
- `DATETIME`: 날짜+시간 (YYYY-MM-DD HH:MM:SS)
  - 용도: 생성일시, 수정일시
- `TIMESTAMP`: 타임스탬프 (자동 갱신 가능)
  - 용도: 시스템 로그

#### 4.2.5 기타
- `ENUM('값1', '값2', ...)`: 열거형
  - 용도: 고정된 선택지 (성별, 상태 등)
- `JSON`: JSON 데이터
  - 용도: 복잡한 구조 데이터 (사진 목록, 설정 정보 등)
- `BOOLEAN` (= `TINYINT(1)`): 참/거짓

---

### 4.3 공통 컬럼

대부분의 테이블에 공통적으로 사용되는 컬럼:

| 컬럼명 | 데이터 타입 | 설명 | 제약조건 |
|:------|:-----------|:-----|:---------|
| created_date | DATETIME | 생성일시 | NOT NULL, DEFAULT CURRENT_TIMESTAMP |
| updated_date | DATETIME | 수정일시 | NULL, ON UPDATE CURRENT_TIMESTAMP |
| created_by | BIGINT | 생성자 ID | NULL |
| updated_by | BIGINT | 수정자 ID | NULL |

**적용 테이블**: Book, Order, Review, BookClub 등 (비즈니스 데이터)

---

## 5. 키 설계

### 5.1 기본키 (Primary Key) 설계

#### 5.1.1 기본키 선택 기준
1. **유일성(Uniqueness)**: 중복 없이 각 행을 고유하게 식별
2. **불변성(Immutability)**: 값이 변경되지 않음
3. **간결성(Simplicity)**: 가능한 단일 컬럼 사용
4. **의미 없음(Non-meaningful)**: 비즈니스 의미를 갖지 않는 대리키 권장

#### 5.1.2 기본키 전략

**전략 1: 대리키 (Surrogate Key)**
- **타입**: `BIGINT AUTO_INCREMENT`
- **장점**: 고유성 보장, 관리 용이, 조인 성능 우수
- **적용**: 대부분의 테이블
- **예시**: `member_id`, `book_id`, `order_id`

**전략 2: 자연키 (Natural Key)**
- **타입**: 비즈니스 속성을 PK로 사용
- **장점**: 의미 명확
- **단점**: 변경 가능성, 복잡도
- **적용**: 거의 사용 안 함 (UNIQUE 제약으로 대체)
- **예시**: `Book.isbn` (PK 아님, UNIQUE INDEX로 관리)

**전략 3: 복합키 (Composite Key)**
- **타입**: 2개 이상 컬럼 조합
- **장점**: N:M 연결 테이블에서 중복 방지
- **단점**: 관리 복잡, 조인 성능 저하
- **적용**: 가급적 피하고 대리키 사용
- **예시**: 사용 안 함 (연결 테이블도 별도 ID 사용)

#### 5.1.3 기본키 목록

| 테이블 | PK 컬럼 | 타입 | 전략 |
|:------|:--------|:-----|:-----|
| member | member_id | BIGINT | 대리키 |
| address | address_id | BIGINT | 대리키 |
| authority | authority_id | BIGINT | 대리키 |
| book | book_id | BIGINT | 대리키 |
| author | author_id | BIGINT | 대리키 |
| publisher | publisher_id | BIGINT | 대리키 |
| category | category_id | BIGINT | 대리키 |
| book_category | book_category_id | BIGINT | 대리키 |
| cart | cart_id | BIGINT | 대리키 |
| cart_item | cart_item_id | BIGINT | 대리키 |
| orders | order_id | BIGINT | 대리키 |
| order_item | order_item_id | BIGINT | 대리키 |
| payment | payment_id | BIGINT | 대리키 |
| shipment | shipment_id | BIGINT | 대리키 |
| coupon | coupon_id | BIGINT | 대리키 |
| user_coupon | user_coupon_id | BIGINT | 대리키 |
| point_history | point_history_id | BIGINT | 대리키 |
| review | review_id | BIGINT | 대리키 |
| review_like | review_like_id | BIGINT | 대리키 |
| book_club | club_id | BIGINT | 대리키 |
| club_member | club_member_id | BIGINT | 대리키 |
| achievement | achievement_id | BIGINT | 대리키 |
| user_achievement | user_achievement_id | BIGINT | 대리키 |
| bookshelf | bookshelf_id | BIGINT | 대리키 |
| bookshelf_item | item_id | BIGINT | 대리키 |

---

### 5.2 후보키 (Candidate Key)

기본키가 될 수 있는 다른 컬럼들 (UNIQUE 제약으로 관리)

| 테이블 | 후보키 | 용도 |
|:------|:-------|:-----|
| member | email | 로그인 ID, 중복 불가 |
| member | nickname | 닉네임 중복 불가 |
| book | isbn | 국제 표준 도서 번호 |
| orders | order_number | 주문번호 (업무용 식별자) |
| coupon | code | 쿠폰 코드 |
| cart | member_id | 회원당 1개 장바구니 |
| bookshelf | member_id | 회원당 1개 서재 |

---

### 5.3 외래키 (Foreign Key) 설계

#### 5.3.1 외래키 명명 규칙
- **컬럼명**: `참조테이블_id` (예: `member_id`, `book_id`)
- **제약조건명**: `fk_테이블명_참조테이블명` (예: `fk_order_member`)

#### 5.3.2 외래키 액션

| 액션 | 설명 | 적용 사례 |
|:-----|:-----|:----------|
| **RESTRICT** | 자식이 있으면 부모 삭제 불가 | Member ← Order (주문 있으면 회원 삭제 불가) |
| **CASCADE** | 부모 삭제 시 자식도 삭제 | Order → OrderItem (주문 삭제 시 항목도 삭제) |
| **SET NULL** | 부모 삭제 시 자식 FK를 NULL로 | 거의 사용 안 함 |
| **NO ACTION** | RESTRICT와 유사 | 기본값 |

#### 5.3.3 외래키 목록

| 테이블 | FK 컬럼 | 참조 테이블 | ON DELETE | ON UPDATE | 비고 |
|:------|:--------|:-----------|:----------|:----------|:-----|
| address | member_id | member | CASCADE | CASCADE | 회원 삭제 시 주소도 삭제 |
| authority | member_id | member | CASCADE | CASCADE | 회원 삭제 시 권한도 삭제 |
| book | author_id | author | RESTRICT | CASCADE | 저자 삭제 방지 |
| book | publisher_id | publisher | RESTRICT | CASCADE | 출판사 삭제 방지 |
| book_category | book_id | book | CASCADE | CASCADE | 책 삭제 시 카테고리 연결도 삭제 |
| book_category | category_id | category | CASCADE | CASCADE | 카테고리 삭제 시 연결도 삭제 |
| category | parent_category_id | category | CASCADE | CASCADE | 부모 카테고리 삭제 시 자식도 삭제 |
| cart | member_id | member | CASCADE | CASCADE | 회원 삭제 시 장바구니도 삭제 |
| cart_item | cart_id | cart | CASCADE | CASCADE | 장바구니 삭제 시 항목도 삭제 |
| cart_item | book_id | book | CASCADE | CASCADE | 책 삭제 시 장바구니 항목도 삭제 |
| orders | member_id | member | RESTRICT | CASCADE | 주문 있으면 회원 삭제 불가 |
| order_item | order_id | orders | CASCADE | CASCADE | 주문 삭제 시 항목도 삭제 |
| order_item | book_id | book | RESTRICT | CASCADE | 책 삭제 방지 (주문 이력 보존) |
| payment | order_id | orders | CASCADE | CASCADE | 주문 삭제 시 결제도 삭제 |
| shipment | order_id | orders | CASCADE | CASCADE | 주문 삭제 시 배송도 삭제 |
| user_coupon | member_id | member | CASCADE | CASCADE | 회원 삭제 시 보유 쿠폰도 삭제 |
| user_coupon | coupon_id | coupon | CASCADE | CASCADE | 쿠폰 삭제 시 보유 쿠폰도 삭제 |
| user_coupon | order_id | orders | SET NULL | CASCADE | 주문 삭제 시 쿠폰 사용 이력은 유지 |
| point_history | member_id | member | CASCADE | CASCADE | 회원 삭제 시 포인트 내역도 삭제 |
| point_history | order_id | orders | SET NULL | CASCADE | 주문 삭제 시 포인트 내역은 유지 |
| review | member_id | member | CASCADE | CASCADE | 회원 삭제 시 리뷰도 삭제 |
| review | book_id | book | CASCADE | CASCADE | 책 삭제 시 리뷰도 삭제 |
| review | order_id | orders | SET NULL | CASCADE | 주문 삭제 시 리뷰는 유지 |
| review_like | review_id | review | CASCADE | CASCADE | 리뷰 삭제 시 좋아요도 삭제 |
| review_like | member_id | member | CASCADE | CASCADE | 회원 삭제 시 좋아요도 삭제 |
| book_club | book_id | book | RESTRICT | CASCADE | 책 삭제 방지 (모임이 있으면) |
| book_club | creator_id | member | RESTRICT | CASCADE | 생성자 삭제 방지 |
| club_member | club_id | book_club | CASCADE | CASCADE | 모임 삭제 시 멤버도 삭제 |
| club_member | member_id | member | CASCADE | CASCADE | 회원 삭제 시 모임 참여도 삭제 |
| user_achievement | member_id | member | CASCADE | CASCADE | 회원 삭제 시 업적도 삭제 |
| user_achievement | achievement_id | achievement | CASCADE | CASCADE | 업적 삭제 시 획득 정보도 삭제 |
| bookshelf | member_id | member | CASCADE | CASCADE | 회원 삭제 시 서재도 삭제 |
| bookshelf_item | bookshelf_id | bookshelf | CASCADE | CASCADE | 서재 삭제 시 아이템도 삭제 |

---

## 6. 관계 및 외래키 설계

### 6.1 관계 매핑 규칙

#### 6.1.1 일대다 (1:N) 관계
- **구현**: 다(N)쪽 테이블에 외래키 추가
- **예시**: Member (1) ↔ (N) Order
  - `orders.member_id` FK 추가

#### 6.1.2 일대일 (1:1) 관계
- **구현**: 한쪽 테이블에 외래키 추가 (보통 종속적인 쪽)
- **예시**: Order (1) ↔ (1) Payment
  - `payment.order_id` FK 추가 (UNIQUE 제약)

#### 6.1.3 다대다 (N:M) 관계
- **구현**: 연결 테이블(Junction Table) 생성
- **예시**: Book (N) ↔ (M) Category
  - `book_category` 테이블 생성
  - `book_category.book_id`, `book_category.category_id` FK 추가

---

### 6.2 관계 목록

| 관계 | 좌측 테이블 | 관계 | 우측 테이블 | 구현 방식 |
|:-----|:-----------|:-----|:-----------|:----------|
| R1 | member | 1:N | address | address.member_id |
| R2 | member | 1:N | authority | authority.member_id |
| R3 | member | 1:1 | cart | cart.member_id (UNIQUE) |
| R4 | member | 1:N | orders | orders.member_id |
| R5 | member | 1:N | review | review.member_id |
| R6 | member | N:M | review | review_like 테이블 |
| R7 | member | N:M | book_club | club_member 테이블 |
| R8 | member | N:M | achievement | user_achievement 테이블 |
| R9 | member | N:M | coupon | user_coupon 테이블 |
| R10 | member | 1:N | point_history | point_history.member_id |
| R11 | member | 1:1 | bookshelf | bookshelf.member_id (UNIQUE) |
| R12 | author | 1:N | book | book.author_id |
| R13 | publisher | 1:N | book | book.publisher_id |
| R14 | book | N:M | category | book_category 테이블 |
| R15 | category | 1:N | category | category.parent_category_id (Self) |
| R16 | book | 1:N | review | review.book_id |
| R17 | book | 1:N | cart_item | cart_item.book_id |
| R18 | book | 1:N | order_item | order_item.book_id |
| R19 | book | 1:N | book_club | book_club.book_id |
| R20 | cart | 1:N | cart_item | cart_item.cart_id |
| R21 | orders | 1:N | order_item | order_item.order_id |
| R22 | orders | 1:1 | payment | payment.order_id (UNIQUE) |
| R23 | orders | 1:1 | shipment | shipment.order_id (UNIQUE) |
| R24 | orders | 1:N | review | review.order_id |
| R25 | review | 1:N | review_like | review_like.review_id |
| R26 | book_club | 1:N | club_member | club_member.club_id |
| R27 | bookshelf | 1:N | bookshelf_item | bookshelf_item.bookshelf_id |

---

## 7. 제약조건 정의

### 7.1 제약조건 유형

#### 7.1.1 NOT NULL
**의미**: 필수 입력 컬럼

**적용**:
- 모든 PK, FK (필수)
- 핵심 비즈니스 속성 (예: `member.email`, `book.title`, `order.order_date`)

#### 7.1.2 UNIQUE
**의미**: 중복 불가

**적용**:
- 후보키 컬럼 (예: `member.email`, `member.nickname`, `book.isbn`)
- 업무 식별자 (예: `order.order_number`, `coupon.code`)
- 1:1 관계의 FK (예: `cart.member_id`, `bookshelf.member_id`)

#### 7.1.3 CHECK
**의미**: 값의 범위/조건 제약

**적용 사례**:
```sql
-- 가격은 0보다 커야 함
CHECK (price > 0)

-- 할인율은 0~100 범위
CHECK (discount_rate >= 0 AND discount_rate <= 100)

-- 평점은 1.0~5.0 범위
CHECK (rating >= 1.0 AND rating <= 5.0)

-- 수량은 1 이상
CHECK (quantity >= 1)

-- 레벨은 1 이상
CHECK (level >= 1)
```

#### 7.1.4 DEFAULT
**의미**: 기본값 설정

**적용 사례**:
```sql
-- 생성일시 자동 입력
created_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP

-- 상태 기본값
status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE'

-- 레벨 초기값
level INT NOT NULL DEFAULT 1

-- RXP 초기값
rxp INT NOT NULL DEFAULT 0

-- 포인트 초기값
point INT NOT NULL DEFAULT 0

-- 재고 초기값
stock INT NOT NULL DEFAULT 0

-- 할인율 초기값
discount_rate DECIMAL(5,2) NOT NULL DEFAULT 0.00

-- 좋아요 수 초기값
like_count INT NOT NULL DEFAULT 0

-- 공개 여부 기본값
is_public BOOLEAN NOT NULL DEFAULT TRUE
```

---

### 7.2 제약조건 목록

#### 7.2.1 Member 테이블

| 제약조건 유형 | 컬럼 | 조건 |
|:------------|:-----|:-----|
| PRIMARY KEY | member_id | |
| UNIQUE | email | 중복 불가 |
| UNIQUE | nickname | 중복 불가 |
| NOT NULL | email, password, name, nickname, phone, level, rxp, point, join_date, status | |
| CHECK | level | level >= 1 |
| CHECK | rxp | rxp >= 0 |
| CHECK | point | point >= 0 |
| DEFAULT | level | 1 |
| DEFAULT | rxp | 0 |
| DEFAULT | point | 0 |
| DEFAULT | status | 'ACTIVE' |
| DEFAULT | join_date | CURRENT_TIMESTAMP |

---

#### 7.2.2 Book 테이블

| 제약조건 유형 | 컬럼 | 조건 |
|:------------|:-----|:-----|
| PRIMARY KEY | book_id | |
| UNIQUE | isbn | 중복 불가 |
| NOT NULL | isbn, title, author_id, publisher_id, publish_date, price, discount_rate, final_price, cover_image, stock, sales_count, review_count, status, created_date | |
| FOREIGN KEY | author_id | → author.author_id |
| FOREIGN KEY | publisher_id | → publisher.publisher_id |
| CHECK | price | price > 0 |
| CHECK | discount_rate | discount_rate >= 0 AND discount_rate <= 100 |
| CHECK | final_price | final_price >= 0 |
| CHECK | stock | stock >= 0 |
| CHECK | sales_count | sales_count >= 0 |
| CHECK | review_count | review_count >= 0 |
| CHECK | rating_avg | rating_avg IS NULL OR (rating_avg >= 0 AND rating_avg <= 5.0) |
| DEFAULT | discount_rate | 0.00 |
| DEFAULT | stock | 0 |
| DEFAULT | sales_count | 0 |
| DEFAULT | review_count | 0 |
| DEFAULT | status | 'AVAILABLE' |
| DEFAULT | created_date | CURRENT_TIMESTAMP |

---

#### 7.2.3 Order 테이블

| 제약조건 유형 | 컬럼 | 조건 |
|:------------|:-----|:-----|
| PRIMARY KEY | order_id | |
| UNIQUE | order_number | 중복 불가 |
| NOT NULL | order_number, member_id, order_date, status, total_product_price, shipping_fee, discount_amount, point_used, final_price, recipient, postal_code, address, phone | |
| FOREIGN KEY | member_id | → member.member_id |
| CHECK | total_product_price | total_product_price >= 0 |
| CHECK | shipping_fee | shipping_fee >= 0 |
| CHECK | discount_amount | discount_amount >= 0 |
| CHECK | point_used | point_used >= 0 |
| CHECK | final_price | final_price >= 0 |
| DEFAULT | discount_amount | 0 |
| DEFAULT | point_used | 0 |
| DEFAULT | status | 'PENDING' |
| DEFAULT | order_date | CURRENT_TIMESTAMP |

---

#### 7.2.4 Review 테이블

| 제약조건 유형 | 컬럼 | 조건 |
|:------------|:-----|:-----|
| PRIMARY KEY | review_id | |
| UNIQUE | (member_id, book_id) | 회원당 책당 1개 리뷰 |
| NOT NULL | member_id, book_id, rating, content, like_count, created_date, status | |
| FOREIGN KEY | member_id | → member.member_id |
| FOREIGN KEY | book_id | → book.book_id |
| FOREIGN KEY | order_id | → orders.order_id |
| CHECK | rating | rating >= 1.0 AND rating <= 5.0 |
| CHECK | like_count | like_count >= 0 |
| DEFAULT | like_count | 0 |
| DEFAULT | status | 'ACTIVE' |
| DEFAULT | created_date | CURRENT_TIMESTAMP |

---

## 8. 인덱스 전략

### 8.1 인덱스 개요

**인덱스(Index)**는 테이블의 검색 속도를 향상시키기 위한 자료구조입니다.

**장점**:
- SELECT 쿼리 성능 향상
- 정렬(ORDER BY) 성능 향상
- 조인(JOIN) 성능 향상

**단점**:
- 저장 공간 추가 필요
- INSERT, UPDATE, DELETE 성능 저하
- 인덱스 유지보수 비용

---

### 8.2 인덱스 생성 원칙

#### 8.2.1 인덱스가 필요한 경우
1. **WHERE 절에 자주 사용되는 컬럼**
   - 예: `book.isbn`, `member.email`, `order.order_number`
2. **JOIN 조건으로 사용되는 컬럼**
   - 예: FK 컬럼들 (`order.member_id`, `order_item.book_id`)
3. **ORDER BY 절에 자주 사용되는 컬럼**
   - 예: `order.order_date`, `book.sales_count`, `review.created_date`
4. **GROUP BY 절에 사용되는 컬럼**
5. **UNIQUE 제약이 있는 컬럼**
   - 자동으로 UNIQUE INDEX 생성

#### 8.2.2 인덱스를 피해야 하는 경우
1. **카디널리티가 낮은 컬럼** (중복 값이 많은 경우)
   - 예: 성별, 불린 컬럼 (단, 조건이 복잡하면 복합 인덱스 고려)
2. **데이터 변경이 빈번한 컬럼**
3. **테이블 크기가 작은 경우** (수천 건 이하)

---

### 8.3 인덱스 유형

#### 8.3.1 단일 컬럼 인덱스 (Single-Column Index)
하나의 컬럼에 대한 인덱스

```sql
CREATE INDEX idx_book_title ON book(title);
```

#### 8.3.2 복합 인덱스 (Composite Index)
여러 컬럼을 조합한 인덱스

```sql
CREATE INDEX idx_order_member_date ON orders(member_id, order_date);
```

**복합 인덱스 순서 규칙**:
1. **선택도가 높은 컬럼 우선** (카디널리티가 높은 컬럼)
2. **WHERE 절에 자주 사용되는 컬럼 우선**
3. **등호(=) 조건 컬럼을 범위(>, <) 조건 컬럼보다 앞에**

#### 8.3.3 유니크 인덱스 (Unique Index)
중복을 허용하지 않는 인덱스

```sql
CREATE UNIQUE INDEX idx_member_email ON member(email);
```

#### 8.3.4 전문 검색 인덱스 (Full-Text Index)
텍스트 검색용 인덱스

```sql
CREATE FULLTEXT INDEX idx_book_title_fulltext ON book(title, description);
```

---

### 8.4 인덱스 설계

#### 8.4.1 Member 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | member_id | PK |
| idx_member_email | UNIQUE | email | 로그인, 중복 체크 |
| idx_member_nickname | UNIQUE | nickname | 중복 체크 |
| idx_member_phone | INDEX | phone | 회원 검색 |
| idx_member_status | INDEX | status | 상태별 조회 |

---

#### 8.4.2 Book 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | book_id | PK |
| idx_book_isbn | UNIQUE | isbn | ISBN 검색, 중복 체크 |
| idx_book_title | INDEX | title | 도서명 검색 |
| idx_book_author | INDEX | author_id | 저자별 도서 조회 |
| idx_book_publisher | INDEX | publisher_id | 출판사별 도서 조회 |
| idx_book_status | INDEX | status | 상태별 조회 (품절 제외 등) |
| idx_book_publish_date | INDEX | publish_date | 신간 조회 |
| idx_book_sales | INDEX | sales_count DESC | 베스트셀러 조회 |
| idx_book_rating | INDEX | rating_avg DESC | 평점순 정렬 |
| idx_book_title_fulltext | FULLTEXT | title, description | 전문 검색 |

---

#### 8.4.3 Order 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | order_id | PK |
| idx_order_number | UNIQUE | order_number | 주문번호 검색 |
| idx_order_member | INDEX | member_id | 회원별 주문 조회 |
| idx_order_date | INDEX | order_date DESC | 최근 주문 조회 |
| idx_order_status | INDEX | status | 상태별 주문 조회 |
| idx_order_member_date | INDEX | (member_id, order_date DESC) | 회원별 최근 주문 |
| idx_order_member_status | INDEX | (member_id, status) | 회원별 주문 상태 조회 |

---

#### 8.4.4 OrderItem 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | order_item_id | PK |
| idx_orderitem_order | INDEX | order_id | 주문별 항목 조회 |
| idx_orderitem_book | INDEX | book_id | 도서별 주문 이력 |

---

#### 8.4.5 Review 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | review_id | PK |
| idx_review_member_book | UNIQUE | (member_id, book_id) | 중복 리뷰 방지 |
| idx_review_book | INDEX | book_id | 도서별 리뷰 조회 |
| idx_review_member | INDEX | member_id | 회원별 리뷰 조회 |
| idx_review_created | INDEX | created_date DESC | 최신 리뷰 조회 |
| idx_review_rating | INDEX | rating DESC | 평점순 조회 |
| idx_review_like | INDEX | like_count DESC | 좋아요순 조회 |
| idx_review_status | INDEX | status | 상태별 조회 |

---

#### 8.4.6 ReviewLike 테이블

| 인덱스명 | 유형 | 컬럼 | 용도 |
|:--------|:-----|:-----|:-----|
| PRIMARY | PRIMARY | review_like_id | PK |
| idx_reviewlike_review_member | UNIQUE | (review_id, member_id) | 중복 좋아요 방지 |
| idx_reviewlike_review | INDEX | review_id | 리뷰별 좋아요 조회 |
| idx_reviewlike_member | INDEX | member_id | 회원별 좋아요 조회 |

---

#### 8.4.7 기타 주요 테이블

| 테이블 | 인덱스 | 컬럼 | 용도 |
|:------|:-------|:-----|:-----|
| cart | idx_cart_member | member_id (UNIQUE) | 회원별 장바구니 |
| cart_item | idx_cartitem_cart | cart_id | 장바구니별 항목 |
| cart_item | idx_cartitem_book | book_id | 도서별 장바구니 |
| payment | idx_payment_order | order_id (UNIQUE) | 주문별 결제 |
| shipment | idx_shipment_order | order_id (UNIQUE) | 주문별 배송 |
| shipment | idx_shipment_tracking | tracking_number | 송장번호 조회 |
| coupon | idx_coupon_code | code (UNIQUE) | 쿠폰 코드 검색 |
| user_coupon | idx_usercoupon_member | member_id | 회원별 쿠폰 |
| user_coupon | idx_usercoupon_status | status | 사용 가능 쿠폰 조회 |
| point_history | idx_pointhistory_member | member_id | 회원별 포인트 내역 |
| point_history | idx_pointhistory_created | created_date DESC | 최근 내역 조회 |
| book_club | idx_bookclub_book | book_id | 도서별 모임 |
| book_club | idx_bookclub_status | status | 모집 중 모임 조회 |
| club_member | idx_clubmember_club | club_id | 모임별 멤버 |
| club_member | idx_clubmember_member | member_id | 회원별 참여 모임 |
| bookshelf | idx_bookshelf_member | member_id (UNIQUE) | 회원별 서재 |

---

## 9. 논리적 ERD

### 9.1 전체 논리적 ERD

```
┌─────────────────────────────────────────────────────────────────┐
│                    Luminari Bookstore                            │
│                   논리적 ERD (Logical ERD)                       │
└─────────────────────────────────────────────────────────────────┘

[회원 도메인]
┌────────────────┐        ┌─────────────────┐        ┌─────────────────┐
│    member      │1      N│    address      │        │   authority     │
├────────────────┤────────├─────────────────┤        ├─────────────────┤
│PK member_id    │        │PK address_id    │        │PK authority_id  │
│UK email        │        │FK member_id     │        │FK member_id     │
│UK nickname     │        │   recipient     │        │   role          │
│   password     │        │   postal_code   │        └─────────────────┘
│   name         │        │   address       │
│   phone        │        │   detail_address│
│   profile_image│        │   phone         │
│   bio          │        │   is_default    │
│   birth_date   │        └─────────────────┘
│   gender       │
│   level        │        ┌─────────────────┐
│   rxp          │1      1│     cart        │
│   point        │────────├─────────────────┤
│   join_date    │        │PK cart_id       │
│   last_login   │        │UK member_id     │
│   status       │        │   created_date  │
└────────┬───────┘        │   updated_date  │
         │                └────────┬────────┘
         │1                        │1
         │                         │
         │N                        │N
┌────────┴───────┐        ┌────────┴────────┐        ┌─────────────────┐
│    orders      │        │   cart_item     │       N│      book       │
├────────────────┤        ├─────────────────┤────────├─────────────────┤
│PK order_id     │        │PK cart_item_id  │        │PK book_id       │
│UK order_number │        │FK cart_id       │        │UK isbn          │
│FK member_id    │        │FK book_id       │        │   title         │
│   order_date   │        │   quantity      │        │FK author_id     │
│   status       │        │   added_date    │        │FK publisher_id  │
│   total_price  │        └─────────────────┘        │   publish_date  │
│   shipping_fee │                                   │   price         │
│   discount_amt │                                   │   discount_rate │
│   point_used   │                                   │   final_price   │
│   final_price  │                                   │   cover_image   │
│   recipient    │                                   │   description   │
│   address      │                                   │   stock         │
│   phone        │                                   │   sales_count   │
└────────┬───────┘                                   │   rating_avg    │
         │1                                          │   review_count  │
         ├──────────┬──────────┐                     │   status        │
         │1         │1         │1                    └────────┬────────┘
         │          │          │                              │1
┌────────┴────────┐ │ ┌────────┴────────┐                    │
│   order_item    │ │ │    payment      │                    │N
├─────────────────┤ │ ├─────────────────┤            ┌───────┴────────┐
│PK order_item_id │ │ │PK payment_id    │            │book_category   │
│FK order_id      │ │ │UK order_id      │            ├────────────────┤
│FK book_id       │ │ │   method        │            │PK bc_id        │
│   quantity      │ │ │   amount        │            │FK book_id      │
│   price         │ │ │   pg_provider   │            │FK category_id  │
│   discount_rate │ │ │   pg_trans_id   │            │   is_main      │
│   subtotal      │ │ │   payment_date  │            └────────┬───────┘
└─────────────────┘ │ │   status        │                     │N
                    │ └─────────────────┘                     │
                    │                                         │1
                    │1                                 ┌──────┴────────┐
            ┌───────┴────────┐                        │   category    │
            │    shipment    │                        ├───────────────┤
            ├────────────────┤                        │PK category_id │
            │PK shipment_id  │                        │   name        │
            │UK order_id     │                        │FK parent_id   │◄─┐
            │   courier      │                        │   depth       │  │
            │   tracking_num │                        │   display_ord │  │
            │   shipped_date │                        └───────────────┘  │
            │   delivered_dt │                               │           │
            │   status       │                               └───────────┘
            └────────────────┘                           (Self-Reference)

[커뮤니티 도메인]
┌────────────────┐        ┌─────────────────┐
│     review     │1      N│  review_like    │
├────────────────┤────────├─────────────────┤
│PK review_id    │        │PK review_like_id│
│FK member_id    │        │FK review_id     │
│FK book_id      │        │FK member_id     │
│FK order_id     │        │   created_date  │
│   rating       │        └─────────────────┘
│   content      │
│   photos       │
│   like_count   │
│   created_date │
│   updated_date │
│   status       │
└────────────────┘

┌────────────────┐        ┌─────────────────┐
│   book_club    │1      N│  club_member    │
├────────────────┤────────├─────────────────┤
│PK club_id      │        │PK club_member_id│
│   title        │        │FK club_id       │
│FK book_id      │        │FK member_id     │
│FK creator_id   │        │   joined_date   │
│   description  │        │   role          │
│   start_date   │        │   status        │
│   end_date     │        └─────────────────┘
│   max_members  │
│   current_mbrs │
│   status       │
└────────────────┘

┌────────────────┐        ┌──────────────────┐
│  achievement   │1      N│user_achievement  │
├────────────────┤────────├──────────────────┤
│PK achiev_id    │        │PK user_achiev_id │
│   type         │        │FK member_id      │
│   name         │        │FK achievement_id │
│   description  │        │   acquired_date  │
│   condition    │        │   is_displayed   │
│   icon         │        └──────────────────┘
│   reward_rxp   │
│   reward_item  │
└────────────────┘

┌────────────────┐        ┌─────────────────┐
│   bookshelf    │1      N│bookshelf_item   │
├────────────────┤────────├─────────────────┤
│PK bookshelf_id │        │PK item_id       │
│UK member_id    │        │FK bookshelf_id  │
│   theme        │        │   item_type     │
│   background   │        │   item_code     │
│   is_public    │        │   position_x    │
│   visit_count  │        │   position_y    │
│   like_count   │        │   rotation      │
└────────────────┘        │   scale         │
                          └─────────────────┘

[프로모션 도메인]
┌────────────────┐        ┌─────────────────┐
│     coupon     │1      N│  user_coupon    │
├────────────────┤────────├─────────────────┤
│PK coupon_id    │        │PK user_coupon_id│
│UK code         │        │FK member_id     │
│   name         │        │FK coupon_id     │
│   type         │        │FK order_id      │
│   discount_val │        │   issued_date   │
│   min_order_amt│        │   used_date     │
│   max_disc_amt │        │   status        │
│   start_date   │        └─────────────────┘
│   end_date     │
│   total_qty    │
│   issued_qty   │
└────────────────┘

┌────────────────┐
│ point_history  │
├────────────────┤
│PK point_hist_id│
│FK member_id    │
│FK order_id     │
│   type         │
│   amount       │
│   reason       │
│   created_date │
│   balance      │
│   expires_date │
└────────────────┘
```

---

## 10. 테이블 명세서

### 10.1 회원 도메인

#### 10.1.1 member (회원)

**테이블 설명**: 플랫폼 회원 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| member_id | BIGINT | NO | AUTO_INCREMENT | PK | 회원 ID |
| email | VARCHAR(100) | NO | | UK | 이메일 (로그인 ID) |
| password | VARCHAR(255) | NO | | | 암호화된 비밀번호 (BCrypt) |
| name | VARCHAR(50) | NO | | | 이름 |
| nickname | VARCHAR(20) | NO | | UK | 닉네임 |
| phone | VARCHAR(20) | NO | | | 휴대폰 번호 |
| profile_image | VARCHAR(500) | YES | NULL | | 프로필 사진 URL |
| bio | VARCHAR(500) | YES | NULL | | 자기소개 |
| birth_date | DATE | YES | NULL | | 생년월일 |
| gender | ENUM('M','F','OTHER') | YES | NULL | | 성별 |
| level | INT | NO | 1 | CHECK(level>=1) | 레벨 |
| rxp | INT | NO | 0 | CHECK(rxp>=0) | 경험치 (Reading XP) |
| point | INT | NO | 0 | CHECK(point>=0) | 보유 포인트 |
| join_date | DATETIME | NO | CURRENT_TIMESTAMP | | 가입일시 |
| last_login | DATETIME | YES | NULL | | 최근 로그인 일시 |
| status | ENUM('ACTIVE','INACTIVE','SUSPENDED','WITHDRAWN') | NO | 'ACTIVE' | | 계정 상태 |

**인덱스**:
- PRIMARY KEY: member_id
- UNIQUE INDEX: email
- UNIQUE INDEX: nickname
- INDEX: phone
- INDEX: status

---

#### 10.1.2 address (배송지)

**테이블 설명**: 회원 배송지 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| address_id | BIGINT | NO | AUTO_INCREMENT | PK | 배송지 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| alias | VARCHAR(50) | YES | NULL | | 배송지 별칭 (예: 집, 회사) |
| recipient | VARCHAR(50) | NO | | | 수령인 |
| postal_code | VARCHAR(10) | NO | | | 우편번호 |
| address | VARCHAR(200) | NO | | | 기본 주소 |
| detail_address | VARCHAR(100) | YES | NULL | | 상세 주소 |
| phone | VARCHAR(20) | NO | | | 연락처 |
| is_default | BOOLEAN | NO | FALSE | | 기본 배송지 여부 |

**인덱스**:
- PRIMARY KEY: address_id
- INDEX: member_id

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE

---

#### 10.1.3 authority (권한)

**테이블 설명**: 회원 권한 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| authority_id | BIGINT | NO | AUTO_INCREMENT | PK | 권한 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| role | VARCHAR(20) | NO | | | 역할 (ROLE_MEMBER, ROLE_ADMIN) |

**인덱스**:
- PRIMARY KEY: authority_id
- INDEX: member_id

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE

---

### 10.2 상품 도메인

#### 10.2.1 book (책)

**테이블 설명**: 도서 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| book_id | BIGINT | NO | AUTO_INCREMENT | PK | 책 ID |
| isbn | VARCHAR(13) | NO | | UK | ISBN-13 |
| isbn10 | VARCHAR(10) | YES | NULL | | ISBN-10 |
| title | VARCHAR(200) | NO | | | 제목 |
| subtitle | VARCHAR(200) | YES | NULL | | 부제 |
| author_id | BIGINT | NO | | FK | 저자 ID |
| publisher_id | BIGINT | NO | | FK | 출판사 ID |
| publish_date | DATE | NO | | | 출간일 |
| pages | INT | YES | NULL | CHECK(pages>0) | 페이지 수 |
| dimensions | VARCHAR(50) | YES | NULL | | 크기 (예: 150x220mm) |
| weight | INT | YES | NULL | CHECK(weight>0) | 무게 (g) |
| price | DECIMAL(10,2) | NO | | CHECK(price>0) | 정가 |
| discount_rate | DECIMAL(5,2) | NO | 0.00 | CHECK(0<=discount_rate<=100) | 할인율 (%) |
| final_price | DECIMAL(10,2) | NO | | CHECK(final_price>=0) | 최종 가격 |
| cover_image | VARCHAR(500) | NO | | | 표지 이미지 URL |
| detail_images | TEXT | YES | NULL | | 상세 이미지 URL (JSON) |
| description | TEXT | YES | NULL | | 책 소개 |
| table_of_contents | TEXT | YES | NULL | | 목차 |
| preview_pages | TEXT | YES | NULL | | 미리보기 페이지 (JSON) |
| stock | INT | NO | 0 | CHECK(stock>=0) | 재고 수량 |
| sales_count | INT | NO | 0 | CHECK(sales_count>=0) | 판매 수량 |
| rating_avg | DECIMAL(3,2) | YES | NULL | CHECK(rating_avg>=0 AND rating_avg<=5) | 평균 평점 |
| review_count | INT | NO | 0 | CHECK(review_count>=0) | 리뷰 수 |
| status | ENUM('AVAILABLE','OUT_OF_STOCK','DISCONTINUED') | NO | 'AVAILABLE' | | 상태 |
| created_date | DATETIME | NO | CURRENT_TIMESTAMP | | 등록일시 |
| updated_date | DATETIME | YES | NULL | ON UPDATE CURRENT_TIMESTAMP | 수정일시 |

**인덱스**:
- PRIMARY KEY: book_id
- UNIQUE INDEX: isbn
- INDEX: title
- INDEX: author_id
- INDEX: publisher_id
- INDEX: status
- INDEX: publish_date
- INDEX: sales_count DESC
- INDEX: rating_avg DESC
- FULLTEXT INDEX: (title, description)

**외래키**:
- author_id → author(author_id) ON DELETE RESTRICT
- publisher_id → publisher(publisher_id) ON DELETE RESTRICT

---

#### 10.2.2 author (저자)

**테이블 설명**: 저자 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| author_id | BIGINT | NO | AUTO_INCREMENT | PK | 저자 ID |
| name | VARCHAR(100) | NO | | | 저자명 |
| bio | TEXT | YES | NULL | | 약력 |
| photo | VARCHAR(500) | YES | NULL | | 사진 URL |
| nationality | VARCHAR(50) | YES | NULL | | 국적 |

**인덱스**:
- PRIMARY KEY: author_id
- INDEX: name

---

#### 10.2.3 publisher (출판사)

**테이블 설명**: 출판사 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| publisher_id | BIGINT | NO | AUTO_INCREMENT | PK | 출판사 ID |
| name | VARCHAR(100) | NO | | | 출판사명 |
| description | TEXT | YES | NULL | | 소개 |
| website | VARCHAR(200) | YES | NULL | | 웹사이트 |
| contact | VARCHAR(100) | YES | NULL | | 연락처 |

**인덱스**:
- PRIMARY KEY: publisher_id
- INDEX: name

---

#### 10.2.4 category (카테고리)

**테이블 설명**: 도서 카테고리 (계층 구조)

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| category_id | BIGINT | NO | AUTO_INCREMENT | PK | 카테고리 ID |
| name | VARCHAR(50) | NO | | | 카테고리명 |
| parent_category_id | BIGINT | YES | NULL | FK (Self) | 부모 카테고리 ID |
| depth | TINYINT | NO | 1 | CHECK(depth>=1 AND depth<=3) | 계층 깊이 (1~3) |
| display_order | INT | NO | 0 | | 표시 순서 |
| description | VARCHAR(200) | YES | NULL | | 설명 |

**인덱스**:
- PRIMARY KEY: category_id
- INDEX: parent_category_id
- INDEX: depth

**외래키**:
- parent_category_id → category(category_id) ON DELETE CASCADE

---

#### 10.2.5 book_category (책-카테고리 연결)

**테이블 설명**: 책과 카테고리의 N:M 관계

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| book_category_id | BIGINT | NO | AUTO_INCREMENT | PK | 연결 ID |
| book_id | BIGINT | NO | | FK | 책 ID |
| category_id | BIGINT | NO | | FK | 카테고리 ID |
| is_main | BOOLEAN | NO | FALSE | | 주 카테고리 여부 |

**인덱스**:
- PRIMARY KEY: book_category_id
- UNIQUE INDEX: (book_id, category_id)
- INDEX: book_id
- INDEX: category_id

**외래키**:
- book_id → book(book_id) ON DELETE CASCADE
- category_id → category(category_id) ON DELETE CASCADE

---

### 10.3 주문 도메인

#### 10.3.1 cart (장바구니)

**테이블 설명**: 회원 장바구니

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| cart_id | BIGINT | NO | AUTO_INCREMENT | PK | 장바구니 ID |
| member_id | BIGINT | NO | | UK, FK | 회원 ID |
| created_date | DATETIME | NO | CURRENT_TIMESTAMP | | 생성일시 |
| updated_date | DATETIME | YES | NULL | ON UPDATE CURRENT_TIMESTAMP | 최종 수정일시 |

**인덱스**:
- PRIMARY KEY: cart_id
- UNIQUE INDEX: member_id

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE

---

#### 10.3.2 cart_item (장바구니 항목)

**테이블 설명**: 장바구니에 담긴 도서

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| cart_item_id | BIGINT | NO | AUTO_INCREMENT | PK | 장바구니 항목 ID |
| cart_id | BIGINT | NO | | FK | 장바구니 ID |
| book_id | BIGINT | NO | | FK | 책 ID |
| quantity | INT | NO | 1 | CHECK(quantity>=1 AND quantity<=99) | 수량 |
| added_date | DATETIME | NO | CURRENT_TIMESTAMP | | 담은 날짜 |

**인덱스**:
- PRIMARY KEY: cart_item_id
- UNIQUE INDEX: (cart_id, book_id)
- INDEX: cart_id
- INDEX: book_id

**외래키**:
- cart_id → cart(cart_id) ON DELETE CASCADE
- book_id → book(book_id) ON DELETE CASCADE

---

#### 10.3.3 orders (주문)

**테이블 설명**: 주문 마스터 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| order_id | BIGINT | NO | AUTO_INCREMENT | PK | 주문 ID |
| order_number | VARCHAR(20) | NO | | UK | 주문번호 (예: ORD20250119123456) |
| member_id | BIGINT | NO | | FK | 회원 ID |
| order_date | DATETIME | NO | CURRENT_TIMESTAMP | | 주문일시 |
| status | ENUM('PENDING','PAYMENT_COMPLETED','PREPARING','SHIPPING','DELIVERED','CONFIRMED','CANCELLED','REFUNDED') | NO | 'PENDING' | | 주문 상태 |
| total_product_price | DECIMAL(10,2) | NO | | CHECK(>=0) | 총 상품 금액 |
| shipping_fee | DECIMAL(10,2) | NO | | CHECK(>=0) | 배송비 |
| discount_amount | DECIMAL(10,2) | NO | 0.00 | CHECK(>=0) | 할인 금액 |
| point_used | INT | NO | 0 | CHECK(>=0) | 사용 포인트 |
| final_price | DECIMAL(10,2) | NO | | CHECK(>=0) | 최종 결제 금액 |
| recipient | VARCHAR(50) | NO | | | 수령인 |
| postal_code | VARCHAR(10) | NO | | | 우편번호 |
| address | VARCHAR(200) | NO | | | 주소 |
| detail_address | VARCHAR(100) | YES | NULL | | 상세 주소 |
| phone | VARCHAR(20) | NO | | | 연락처 |
| delivery_request | VARCHAR(200) | YES | NULL | | 배송 요청사항 |

**인덱스**:
- PRIMARY KEY: order_id
- UNIQUE INDEX: order_number
- INDEX: member_id
- INDEX: order_date DESC
- INDEX: status
- INDEX: (member_id, order_date DESC)
- INDEX: (member_id, status)

**외래키**:
- member_id → member(member_id) ON DELETE RESTRICT

---

#### 10.3.4 order_item (주문 항목)

**테이블 설명**: 주문에 포함된 도서 상세

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| order_item_id | BIGINT | NO | AUTO_INCREMENT | PK | 주문 항목 ID |
| order_id | BIGINT | NO | | FK | 주문 ID |
| book_id | BIGINT | NO | | FK | 책 ID |
| quantity | INT | NO | | CHECK(>=1) | 수량 |
| price | DECIMAL(10,2) | NO | | CHECK(>0) | 주문 당시 가격 |
| discount_rate | DECIMAL(5,2) | NO | 0.00 | CHECK(0<=discount_rate<=100) | 주문 당시 할인율 |
| subtotal | DECIMAL(10,2) | NO | | CHECK(>=0) | 소계 |

**인덱스**:
- PRIMARY KEY: order_item_id
- INDEX: order_id
- INDEX: book_id

**외래키**:
- order_id → orders(order_id) ON DELETE CASCADE
- book_id → book(book_id) ON DELETE RESTRICT

---

#### 10.3.5 payment (결제)

**테이블 설명**: 결제 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| payment_id | BIGINT | NO | AUTO_INCREMENT | PK | 결제 ID |
| order_id | BIGINT | NO | | UK, FK | 주문 ID |
| payment_method | ENUM('CARD','BANK_TRANSFER','KAKAO_PAY','NAVER_PAY','TOSS') | NO | | | 결제 수단 |
| payment_date | DATETIME | NO | CURRENT_TIMESTAMP | | 결제일시 |
| amount | DECIMAL(10,2) | NO | | CHECK(>0) | 결제 금액 |
| pg_provider | VARCHAR(50) | YES | NULL | | PG사 (TOSS, IAMPORT 등) |
| pg_transaction_id | VARCHAR(100) | YES | NULL | | PG 거래 ID |
| status | ENUM('PENDING','COMPLETED','FAILED','CANCELLED','REFUNDED') | NO | 'PENDING' | | 결제 상태 |

**인덱스**:
- PRIMARY KEY: payment_id
- UNIQUE INDEX: order_id
- INDEX: pg_transaction_id

**외래키**:
- order_id → orders(order_id) ON DELETE CASCADE

---

#### 10.3.6 shipment (배송)

**테이블 설명**: 배송 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| shipment_id | BIGINT | NO | AUTO_INCREMENT | PK | 배송 ID |
| order_id | BIGINT | NO | | UK, FK | 주문 ID |
| courier | VARCHAR(50) | YES | NULL | | 택배사 |
| tracking_number | VARCHAR(50) | YES | NULL | | 송장번호 |
| shipped_date | DATETIME | YES | NULL | | 발송일시 |
| delivered_date | DATETIME | YES | NULL | | 배송 완료일시 |
| status | ENUM('PREPARING','SHIPPED','IN_TRANSIT','OUT_FOR_DELIVERY','DELIVERED','RETURNED') | NO | 'PREPARING' | | 배송 상태 |

**인덱스**:
- PRIMARY KEY: shipment_id
- UNIQUE INDEX: order_id
- INDEX: tracking_number

**외래키**:
- order_id → orders(order_id) ON DELETE CASCADE

---

### 10.4 프로모션 도메인

#### 10.4.1 coupon (쿠폰)

**테이블 설명**: 쿠폰 마스터 정보

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| coupon_id | BIGINT | NO | AUTO_INCREMENT | PK | 쿠폰 ID |
| code | VARCHAR(50) | NO | | UK | 쿠폰 코드 |
| name | VARCHAR(100) | NO | | | 쿠폰명 |
| type | ENUM('FIXED','PERCENT','FREE_SHIPPING') | NO | | | 쿠폰 유형 |
| discount_value | DECIMAL(10,2) | NO | | CHECK(>0) | 할인 값 (금액 or 비율) |
| min_order_amount | DECIMAL(10,2) | NO | 0.00 | CHECK(>=0) | 최소 주문 금액 |
| max_discount_amount | DECIMAL(10,2) | YES | NULL | CHECK(>0) | 최대 할인 금액 (정률용) |
| start_date | DATE | NO | | | 사용 시작일 |
| end_date | DATE | NO | | | 사용 종료일 |
| total_quantity | INT | YES | NULL | CHECK(>0) | 총 발행 수량 (NULL=무제한) |
| issued_quantity | INT | NO | 0 | CHECK(>=0) | 발급된 수량 |
| target_category_id | BIGINT | YES | NULL | FK | 대상 카테고리 (NULL=전체) |
| target_book_id | BIGINT | YES | NULL | FK | 대상 도서 (NULL=전체) |

**인덱스**:
- PRIMARY KEY: coupon_id
- UNIQUE INDEX: code
- INDEX: (start_date, end_date)

**외래키**:
- target_category_id → category(category_id) ON DELETE CASCADE
- target_book_id → book(book_id) ON DELETE CASCADE

---

#### 10.4.2 user_coupon (사용자 보유 쿠폰)

**테이블 설명**: 회원이 보유한 쿠폰

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| user_coupon_id | BIGINT | NO | AUTO_INCREMENT | PK | 사용자 쿠폰 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| coupon_id | BIGINT | NO | | FK | 쿠폰 ID |
| issued_date | DATETIME | NO | CURRENT_TIMESTAMP | | 발급일시 |
| used_date | DATETIME | YES | NULL | | 사용일시 |
| order_id | BIGINT | YES | NULL | FK | 사용한 주문 ID |
| status | ENUM('AVAILABLE','USED','EXPIRED') | NO | 'AVAILABLE' | | 상태 |

**인덱스**:
- PRIMARY KEY: user_coupon_id
- INDEX: member_id
- INDEX: status
- INDEX: (member_id, status)

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE
- coupon_id → coupon(coupon_id) ON DELETE CASCADE
- order_id → orders(order_id) ON DELETE SET NULL

---

#### 10.4.3 point_history (포인트 내역)

**테이블 설명**: 포인트 적립/사용 이력

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| point_history_id | BIGINT | NO | AUTO_INCREMENT | PK | 포인트 내역 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| type | ENUM('EARN','USE','CANCEL','EXPIRE') | NO | | | 유형 (적립/사용/취소/만료) |
| amount | INT | NO | | | 금액 (적립은 +, 사용은 -) |
| reason | VARCHAR(200) | NO | | | 사유 |
| order_id | BIGINT | YES | NULL | FK | 관련 주문 ID |
| created_date | DATETIME | NO | CURRENT_TIMESTAMP | | 발생일시 |
| balance | INT | NO | | CHECK(>=0) | 거래 후 잔액 |
| expires_date | DATE | YES | NULL | | 만료일 (적립 시만) |

**인덱스**:
- PRIMARY KEY: point_history_id
- INDEX: member_id
- INDEX: created_date DESC
- INDEX: (member_id, created_date DESC)

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE
- order_id → orders(order_id) ON DELETE SET NULL

---

### 10.5 커뮤니티 도메인

#### 10.5.1 review (리뷰)

**테이블 설명**: 도서 리뷰

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| review_id | BIGINT | NO | AUTO_INCREMENT | PK | 리뷰 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| book_id | BIGINT | NO | | FK | 책 ID |
| order_id | BIGINT | YES | NULL | FK | 구매 확인용 주문 ID |
| rating | DECIMAL(2,1) | NO | | CHECK(rating>=1.0 AND rating<=5.0) | 별점 (1.0~5.0) |
| content | TEXT | NO | | | 리뷰 내용 |
| photos | JSON | YES | NULL | | 사진 URL 목록 |
| created_date | DATETIME | NO | CURRENT_TIMESTAMP | | 작성일시 |
| updated_date | DATETIME | YES | NULL | ON UPDATE CURRENT_TIMESTAMP | 수정일시 |
| like_count | INT | NO | 0 | CHECK(>=0) | 좋아요 수 |
| status | ENUM('ACTIVE','HIDDEN','DELETED') | NO | 'ACTIVE' | | 상태 |

**인덱스**:
- PRIMARY KEY: review_id
- UNIQUE INDEX: (member_id, book_id)
- INDEX: book_id
- INDEX: member_id
- INDEX: created_date DESC
- INDEX: rating DESC
- INDEX: like_count DESC
- INDEX: status

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE
- book_id → book(book_id) ON DELETE CASCADE
- order_id → orders(order_id) ON DELETE SET NULL

---

#### 10.5.2 review_like (리뷰 좋아요)

**테이블 설명**: 리뷰 좋아요

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| review_like_id | BIGINT | NO | AUTO_INCREMENT | PK | 리뷰 좋아요 ID |
| review_id | BIGINT | NO | | FK | 리뷰 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| created_date | DATETIME | NO | CURRENT_TIMESTAMP | | 좋아요 누른 날짜 |

**인덱스**:
- PRIMARY KEY: review_like_id
- UNIQUE INDEX: (review_id, member_id)
- INDEX: review_id
- INDEX: member_id

**외래키**:
- review_id → review(review_id) ON DELETE CASCADE
- member_id → member(member_id) ON DELETE CASCADE

---

#### 10.5.3 book_club (독서 모임)

**테이블 설명**: 독서 모임

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| club_id | BIGINT | NO | AUTO_INCREMENT | PK | 모임 ID |
| title | VARCHAR(100) | NO | | | 모임명 |
| book_id | BIGINT | NO | | FK | 대상 도서 ID |
| creator_id | BIGINT | NO | | FK | 생성자 ID |
| description | TEXT | YES | NULL | | 모임 소개 |
| start_date | DATE | NO | | | 시작일 |
| end_date | DATE | NO | | | 종료일 |
| max_members | INT | NO | | CHECK(>0) | 최대 인원 |
| current_members | INT | NO | 1 | CHECK(>=0) | 현재 인원 |
| status | ENUM('RECRUITING','IN_PROGRESS','COMPLETED','CANCELLED') | NO | 'RECRUITING' | | 상태 |

**인덱스**:
- PRIMARY KEY: club_id
- INDEX: book_id
- INDEX: status
- INDEX: (status, start_date)

**외래키**:
- book_id → book(book_id) ON DELETE RESTRICT
- creator_id → member(member_id) ON DELETE RESTRICT

---

#### 10.5.4 club_member (모임 멤버)

**테이블 설명**: 독서 모임 참여 회원

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| club_member_id | BIGINT | NO | AUTO_INCREMENT | PK | 모임 멤버 ID |
| club_id | BIGINT | NO | | FK | 모임 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| joined_date | DATETIME | NO | CURRENT_TIMESTAMP | | 가입일시 |
| role | ENUM('LEADER','MEMBER') | NO | 'MEMBER' | | 역할 |
| status | ENUM('ACTIVE','WITHDRAWN') | NO | 'ACTIVE' | | 상태 |

**인덱스**:
- PRIMARY KEY: club_member_id
- UNIQUE INDEX: (club_id, member_id)
- INDEX: club_id
- INDEX: member_id

**외래키**:
- club_id → book_club(club_id) ON DELETE CASCADE
- member_id → member(member_id) ON DELETE CASCADE

---

#### 10.5.5 achievement (업적)

**테이블 설명**: 업적/배지/칭호 마스터

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| achievement_id | BIGINT | NO | AUTO_INCREMENT | PK | 업적 ID |
| type | ENUM('BADGE','TITLE') | NO | | | 유형 (배지/칭호) |
| name | VARCHAR(50) | NO | | UK | 업적명 |
| description | VARCHAR(200) | NO | | | 설명 |
| condition | JSON | NO | | | 달성 조건 (JSON) |
| icon | VARCHAR(500) | YES | NULL | | 아이콘 이미지 URL |
| reward_rxp | INT | NO | 0 | CHECK(>=0) | 보상 RXP |
| reward_item | JSON | YES | NULL | | 보상 아이템 (JSON) |

**인덱스**:
- PRIMARY KEY: achievement_id
- UNIQUE INDEX: name
- INDEX: type

---

#### 10.5.6 user_achievement (사용자 획득 업적)

**테이블 설명**: 회원이 획득한 업적

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| user_achievement_id | BIGINT | NO | AUTO_INCREMENT | PK | 사용자 업적 ID |
| member_id | BIGINT | NO | | FK | 회원 ID |
| achievement_id | BIGINT | NO | | FK | 업적 ID |
| acquired_date | DATETIME | NO | CURRENT_TIMESTAMP | | 획득일시 |
| is_displayed | BOOLEAN | NO | FALSE | | 프로필 표시 여부 (칭호용) |

**인덱스**:
- PRIMARY KEY: user_achievement_id
- UNIQUE INDEX: (member_id, achievement_id)
- INDEX: member_id
- INDEX: achievement_id

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE
- achievement_id → achievement(achievement_id) ON DELETE CASCADE

---

#### 10.5.7 bookshelf (가상 서재)

**테이블 설명**: 회원의 가상 서재

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| bookshelf_id | BIGINT | NO | AUTO_INCREMENT | PK | 서재 ID |
| member_id | BIGINT | NO | | UK, FK | 회원 ID |
| theme | VARCHAR(50) | YES | 'DEFAULT' | | 테마 |
| background | VARCHAR(500) | YES | NULL | | 배경 이미지 URL |
| is_public | BOOLEAN | NO | TRUE | | 공개 여부 |
| visit_count | INT | NO | 0 | CHECK(>=0) | 방문자 수 |
| like_count | INT | NO | 0 | CHECK(>=0) | 좋아요 수 |

**인덱스**:
- PRIMARY KEY: bookshelf_id
- UNIQUE INDEX: member_id

**외래키**:
- member_id → member(member_id) ON DELETE CASCADE

---

#### 10.5.8 bookshelf_item (서재 아이템)

**테이블 설명**: 서재에 배치된 아이템

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 제약조건 | 설명 |
|:------|:-----------|:-----|:------|:---------|:-----|
| item_id | BIGINT | NO | AUTO_INCREMENT | PK | 아이템 ID |
| bookshelf_id | BIGINT | NO | | FK | 서재 ID |
| item_type | ENUM('BOOK','FURNITURE','DECORATION','BACKGROUND') | NO | | | 아이템 유형 |
| item_code | VARCHAR(100) | NO | | | 아이템 코드 |
| position_x | INT | NO | 0 | | X 좌표 |
| position_y | INT | NO | 0 | | Y 좌표 |
| rotation | INT | NO | 0 | CHECK(>=0 AND <=360) | 회전 각도 (0~360) |
| scale | DECIMAL(3,2) | NO | 1.00 | CHECK(>0) | 크기 배율 |

**인덱스**:
- PRIMARY KEY: item_id
- INDEX: bookshelf_id

**외래키**:
- bookshelf_id → bookshelf(bookshelf_id) ON DELETE CASCADE

---

## 11. 정규화 검증

### 11.1 제1정규형 (1NF) 검증

**확인사항**: 모든 속성이 원자값인가?

| 테이블 | 검증 결과 | 비고 |
|:------|:---------|:-----|
| member | ✅ 통과 | 모든 속성 원자값 |
| book | ✅ 통과 | photos는 JSON (원자값으로 간주) |
| order | ✅ 통과 | 모든 속성 원자값 |
| review | ✅ 통과 | photos는 JSON (원자값으로 간주) |
| book_category | ✅ 통과 | 다대다 관계 분해 완료 |

**결론**: ✅ 모든 테이블이 1NF 만족

---

### 11.2 제2정규형 (2NF) 검증

**확인사항**: 부분 함수 종속이 없는가?

| 테이블 | PK | 검증 결과 | 비고 |
|:------|:---|:---------|:-----|
| member | member_id (단일) | ✅ 통과 | 단일 PK, 2NF 자동 충족 |
| book | book_id (단일) | ✅ 통과 | 단일 PK, 2NF 자동 충족 |
| order_item | order_item_id (단일) | ✅ 통과 | 단일 PK 사용 (복합키 아님) |
| review_like | review_like_id (단일) | ✅ 통과 | 단일 PK 사용 |

**결론**: ✅ 모든 테이블이 단일 PK 사용으로 2NF 자동 만족

---

### 11.3 제3정규형 (3NF) 검증

**확인사항**: 이행 함수 종속이 없는가?

| 테이블 | 검증 포인트 | 검증 결과 | 비고 |
|:------|:-----------|:---------|:-----|
| book | author_id → author_name? | ✅ 통과 | Author 테이블로 분리 |
| book | publisher_id → publisher_name? | ✅ 통과 | Publisher 테이블로 분리 |
| member | address 정보? | ✅ 통과 | Address 테이블로 분리 |
| order | 배송지 정보? | ⚠️ 역정규화 | 성능 및 데이터 보존 위해 중복 저장 |

**결론**: ✅ 핵심 테이블 3NF 만족, 일부 의도적 역정규화 적용

---

### 11.4 BCNF 검증

**확인사항**: 모든 결정자가 후보키인가?

**결론**: ✅ 복잡한 함수 종속성 없음, BCNF 만족

---

## 12. 성능 최적화 고려사항

### 12.1 역정규화 적용 사례

#### 12.1.1 집계값 저장

**Case 1: Book 테이블**
```sql
-- 역정규화: 평균 평점, 리뷰 수 저장
book.rating_avg     -- Review 테이블의 rating 평균
book.review_count   -- Review 테이블의 레코드 수
book.sales_count    -- OrderItem 테이블의 quantity 합계

-- 이유: 도서 목록 조회 시 성능 향상
-- 갱신: 리뷰 작성/삭제 시 트리거 또는 배치로 업데이트
```

**Case 2: Member 테이블**
```sql
-- 역정규화: 포인트 잔액 저장
member.point        -- PointHistory 테이블의 최신 balance

-- 이유: 회원 정보 조회 시 매번 집계 방지
-- 갱신: 포인트 변동 시 트랜잭션으로 동기화
```

**Case 3: Review 테이블**
```sql
-- 역정규화: 좋아요 수 저장
review.like_count   -- ReviewLike 테이블의 레코드 수

-- 이유: 리뷰 목록 정렬 시 성능 향상
-- 갱신: 좋아요 추가/취소 시 트랜잭션으로 갱신
```

---

#### 12.1.2 중복 데이터 저장

**Case 1: OrderItem 테이블**
```sql
-- 역정규화: 주문 당시 가격 정보 저장
order_item.price          -- 주문 시점의 book.price
order_item.discount_rate  -- 주문 시점의 book.discount_rate

-- 이유: Book 테이블 가격 변경에 영향 받지 않도록
-- 원칙: 주문 이력은 불변 데이터
```

**Case 2: Order 테이블**
```sql
-- 역정규화: 배송지 정보 복사 저장
order.recipient
order.postal_code
order.address
order.detail_address
order.phone

-- 이유: Address 테이블 변경/삭제 시에도 주문 이력 보존
-- 원칙: 주문 시점의 스냅샷 저장
```

---

### 12.2 인덱스 최적화

#### 12.2.1 복합 인덱스 활용

**예시 1: 회원별 최근 주문 조회**
```sql
-- 쿼리
SELECT * FROM orders
WHERE member_id = 1
ORDER BY order_date DESC
LIMIT 10;

-- 최적 인덱스
CREATE INDEX idx_order_member_date ON orders(member_id, order_date DESC);
```

**예시 2: 도서별 최신 리뷰 조회**
```sql
-- 쿼리
SELECT * FROM review
WHERE book_id = 101 AND status = 'ACTIVE'
ORDER BY created_date DESC;

-- 최적 인덱스
CREATE INDEX idx_review_book_status_date ON review(book_id, status, created_date DESC);
```

---

#### 12.2.2 커버링 인덱스 (Covering Index)

**정의**: 쿼리에 필요한 모든 컬럼을 인덱스에 포함하여 테이블 접근 없이 인덱스만으로 결과 반환

**예시: 주문 목록 간단 조회**
```sql
-- 쿼리
SELECT order_id, order_number, order_date, status, final_price
FROM orders
WHERE member_id = 1
ORDER BY order_date DESC;

-- 커버링 인덱스
CREATE INDEX idx_order_covering 
ON orders(member_id, order_date DESC, order_id, order_number, status, final_price);
```

---

### 12.3 파티셔닝 전략 (추후 확장 시)

#### 12.3.1 Range Partitioning

**대상 테이블**: orders, order_item, point_history

**파티셔닝 키**: 날짜 (order_date, created_date)

**예시**:
```sql
-- 연도별 파티셔닝
ALTER TABLE orders
PARTITION BY RANGE (YEAR(order_date)) (
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025),
    PARTITION p2025 VALUES LESS THAN (2026),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

---

#### 12.3.2 Hash Partitioning

**대상 테이블**: member (회원 수 증가 시)

**파티셔닝 키**: member_id

**예시**:
```sql
-- 4개 파티션으로 분산
ALTER TABLE member
PARTITION BY HASH(member_id)
PARTITIONS 4;
```

---

### 12.4 쿼리 최적화 가이드라인

#### 12.4.1 SELECT 최적화
```sql
-- ❌ 나쁜 예: SELECT *
SELECT * FROM book WHERE book_id = 1;

-- ✅ 좋은 예: 필요한 컬럼만 선택
SELECT book_id, title, author_id, price, cover_image 
FROM book WHERE book_id = 1;
```

#### 12.4.2 JOIN 최적화
```sql
-- ❌ 나쁜 예: 서브쿼리 중첩
SELECT b.* FROM book b
WHERE b.author_id IN (SELECT author_id FROM author WHERE name LIKE '%김%');

-- ✅ 좋은 예: JOIN 사용
SELECT b.* FROM book b
INNER JOIN author a ON b.author_id = a.author_id
WHERE a.name LIKE '%김%';
```

#### 12.4.3 페이징 최적화
```sql
-- ❌ 나쁜 예: OFFSET 큰 경우 성능 저하
SELECT * FROM review
ORDER BY created_date DESC
LIMIT 20 OFFSET 10000;

-- ✅ 좋은 예: WHERE + 인덱스 활용
SELECT * FROM review
WHERE review_id < 12345
ORDER BY review_id DESC
LIMIT 20;
```

---

## 13. 다음 단계 안내

3단계 논리적 데이터 모델링이 완료되었습니다. 이제 다음 단계로 진행할 수 있습니다:

### **4단계: 물리적 데이터 모델링**
- 실제 DBMS (MySQL 8.0) DDL 작성
- 스토리지 엔진 선택 (InnoDB)
- 문자셋 및 Collation 설정
- 파티셔닝 적용 (필요 시)
- 초기 데이터 삽입 스크립트 작성
- 데이터베이스 생성 및 테스트
- 트리거 및 스토어드 프로시저 작성

---

## 14. 결론

이 문서는 **Luminari Bookstore 프로젝트**의 **3단계 논리적 데이터 모델링**을 상세히 다루었습니다.

### 주요 성과:
1. **정규화 분석**: 3NF까지 정규화 완료, 일부 의도적 역정규화 적용
2. **테이블 설계**: 28개 테이블 상세 설계
3. **컬럼 정의**: 모든 컬럼의 데이터 타입, 제약조건 정의
4. **키 설계**: 기본키, 외래키, 유니크 키 전략 수립
5. **인덱스 전략**: 60개 이상의 인덱스 설계
6. **제약조건**: NOT NULL, UNIQUE, CHECK, DEFAULT 정의
7. **논리적 ERD**: 도메인별 상세 ERD 완성
8. **테이블 명세서**: 28개 테이블 상세 명세 작성
9. **성능 최적화**: 역정규화, 인덱스, 파티셔닝 전략 수립

### 핵심 성과물:
- ✅ 논리적 ERD (전체 및 도메인별)
- ✅ 테이블 명세서 (28개 테이블)
- ✅ 컬럼 정의서 (300개 이상 컬럼)
- ✅ 인덱스 설계서 (60개 이상 인덱스)
- ✅ 제약조건 정의서
- ✅ 정규화 검증 보고서
- ✅ 성능 최적화 가이드

이 논리적 모델은 다음 단계인 **물리적 데이터 모델링**의 기반이 되며, 실제 MySQL 데이터베이스 DDL 작성으로 이어집니다.

---

**작성 정보**:
- **문서명**: 3단계: 논리적 데이터 모델링
- **프로젝트**: Luminari Bookstore
- **작성일**: 2025-11-19
- **버전**: 1.0
- **이전 단계**: 2단계 - 개념적 데이터 모델링
- **다음 단계**: 4단계 - 물리적 데이터 모델링 (MySQL DDL 작성)
